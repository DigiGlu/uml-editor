(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var saveFiles=require("./Save.js");function Actions(editorUi){this.editorUi=editorUi;this.actions=new Object;this.init()}Actions.prototype.init=function(){var ui=this.editorUi;var editor=ui.editor;var graph=editor.graph;var isGraphEnabled=function(){return Action.prototype.isEnabled.apply(this,arguments)&&graph.isEnabled()};this.addAction("new...",function(){window.open(ui.getUrl())});this.addAction("open...",function(){window.openNew=true;window.openKey="open";window.editorUi=ui;ui.openFile()});this.addAction("import...",function(){window.openNew=false;window.openKey="import";window.openFile=new OpenFile(mxUtils.bind(this,function(){ui.hideDialog()}));window.openFile.setConsumer(mxUtils.bind(this,function(xml,filename){try{var doc=mxUtils.parseXml(xml);var model=new mxGraphModel;var codec=new mxCodec(doc);codec.decode(doc.documentElement,model);var children=model.getChildren(model.getChildAt(model.getRoot(),0));editor.graph.setSelectionCells(editor.graph.importCells(children))}catch(e){mxUtils.alert(mxResources.get("invalidOrMissingFile")+": "+e.message)}}));ui.showDialog(new OpenDialog(this).container,320,220,true,true,function(){window.openFile=null})}).isEnabled=isGraphEnabled;this.addAction("save",function(){saveFile(ui,false)},null,null,"Ctrl+S").isEnabled=isGraphEnabled;this.addAction("saveAs...",function(){saveFile(ui,true)},null,null,"Ctrl+Shift+S").isEnabled=isGraphEnabled;this.addAction("export...",function(){ui.showDialog(new ExportDialog(ui).container,300,230,true,true)});this.addAction("editDiagram...",function(){var dlg=new EditDiagramDialog(ui);ui.showDialog(dlg.container,620,420,true,true);dlg.init()});this.addAction("generateCode...",function(){ui.showDialog(new GenerateCodeDialog(ui).container,300,230,true,true)});this.addAction("pageSetup...",function(){ui.showDialog(new PageSetupDialog(ui).container,320,220,true,true)}).isEnabled=isGraphEnabled;this.addAction("print...",function(){ui.showDialog(new PrintDialog(ui).container,300,180,true,true)},null,"sprite-print","Ctrl+P");this.addAction("preview",function(){mxUtils.show(graph,null,10,10)});this.addAction("undo",function(){ui.undo()},null,"sprite-undo","Ctrl+Z");this.addAction("redo",function(){ui.redo()},null,"sprite-redo",!mxClient.IS_WIN?"Ctrl+Shift+Z":"Ctrl+Y");this.addAction("cut",function(){mxClipboard.cut(graph)},null,"sprite-cut","Ctrl+X");this.addAction("copy",function(){mxClipboard.copy(graph)},null,"sprite-copy","Ctrl+C");this.addAction("paste",function(){if(graph.isEnabled()&&!graph.isCellLocked(graph.getDefaultParent())){mxClipboard.paste(graph)}},false,"sprite-paste","Ctrl+V");this.addAction("pasteHere",function(evt){if(graph.isEnabled()&&!graph.isCellLocked(graph.getDefaultParent())){graph.getModel().beginUpdate();try{var cells=mxClipboard.paste(graph);if(cells!=null){var bb=graph.getBoundingBoxFromGeometry(cells);if(bb!=null){var t=graph.view.translate;var s=graph.view.scale;var dx=t.x;var dy=t.y;var x=Math.round(graph.snap(graph.popupMenuHandler.triggerX/s-dx));var y=Math.round(graph.snap(graph.popupMenuHandler.triggerY/s-dy));graph.cellsMoved(cells,x-bb.x,y-bb.y)}}}finally{graph.getModel().endUpdate()}}});function deleteCells(includeEdges){graph.escape();var cells=graph.getDeletableCells(graph.getSelectionCells());if(cells!=null&&cells.length>0){var parents=graph.model.getParents(cells);graph.removeCells(cells,includeEdges);if(parents!=null){var select=[];for(var i=0;i<parents.length;i++){if(graph.model.isVertex(parents[i])||graph.model.isEdge(parents[i])){select.push(parents[i])}}graph.setSelectionCells(select)}}}this.addAction("delete",function(evt){deleteCells(evt!=null&&mxEvent.isShiftDown(evt))},null,null,"Delete");this.addAction("deleteAll",function(){deleteCells(true)},null,null,"Ctrl+Delete");this.addAction("duplicate",function(){graph.setSelectionCells(graph.duplicateCells())},null,null,"Ctrl+D");this.put("turn",new Action(mxResources.get("turn")+" / "+mxResources.get("reverse"),function(){graph.turnShapes(graph.getSelectionCells())},null,null,"Ctrl+R"));this.addAction("selectVertices",function(){graph.selectVertices()},null,null,"Ctrl+Shift+I");this.addAction("selectEdges",function(){graph.selectEdges()},null,null,"Ctrl+Shift+E");this.addAction("selectAll",function(){graph.selectAll(null,true)},null,null,"Ctrl+A");this.addAction("selectNone",function(){graph.clearSelection()},null,null,"Ctrl+Shift+A");this.addAction("lockUnlock",function(){if(!graph.isSelectionEmpty()){graph.getModel().beginUpdate();try{var defaultValue=graph.isCellMovable(graph.getSelectionCell())?1:0;graph.toggleCellStyles(mxConstants.STYLE_MOVABLE,defaultValue);graph.toggleCellStyles(mxConstants.STYLE_RESIZABLE,defaultValue);graph.toggleCellStyles(mxConstants.STYLE_ROTATABLE,defaultValue);graph.toggleCellStyles(mxConstants.STYLE_DELETABLE,defaultValue);graph.toggleCellStyles(mxConstants.STYLE_EDITABLE,defaultValue);graph.toggleCellStyles("connectable",defaultValue)}finally{graph.getModel().endUpdate()}}},null,null,"Ctrl+L");this.addAction("home",function(){graph.home()},null,null,"Home");this.addAction("exitGroup",function(){graph.exitGroup()},null,null,"Ctrl+Shift+Page Up");this.addAction("enterGroup",function(){graph.enterGroup()},null,null,"Ctrl+Shift+Page Down");this.addAction("expand",function(){graph.foldCells(false)},null,null,"Ctrl+Page Down");this.addAction("collapse",function(){graph.foldCells(true)},null,null,"Ctrl+Page Up");this.addAction("toFront",function(){graph.orderCells(false)},null,null,"Ctrl+Shift+F");this.addAction("toBack",function(){graph.orderCells(true)},null,null,"Ctrl+Shift+B");this.addAction("group",function(){if(graph.getSelectionCount()==1){graph.setCellStyles("container","1")}else{graph.setSelectionCell(graph.groupCells(null,0))}},null,null,"Ctrl+G");this.addAction("ungroup",function(){if(graph.getSelectionCount()==1&&graph.getModel().getChildCount(graph.getSelectionCell())==0){graph.setCellStyles("container","0")}else{graph.setSelectionCells(graph.ungroupCells())}},null,null,"Ctrl+Shift+U");this.addAction("removeFromGroup",function(){graph.removeCellsFromParent()});this.addAction("edit",function(){if(graph.isEnabled()){graph.startEditingAtCell()}},null,null,"F2/Enter");this.addAction("editData...",function(){var cell=graph.getSelectionCell()||graph.getModel().getRoot();if(cell!=null){var dlg=new EditDataDialog(ui,cell);ui.showDialog(dlg.container,320,320,true,false);dlg.init()}},null,null,"Ctrl+M");this.addAction("editTooltip...",function(){var graph=ui.editor.graph;if(graph.isEnabled()&&!graph.isSelectionEmpty()){var cell=graph.getSelectionCell();var tooltip="";if(mxUtils.isNode(cell.value)){var tmp=cell.value.getAttribute("tooltip");if(tmp!=null){tooltip=tmp}}var dlg=new TextareaDialog(ui,mxResources.get("editTooltip")+":",tooltip,function(newValue){graph.setTooltipForCell(cell,newValue)});ui.showDialog(dlg.container,320,200,true,true);dlg.init()}});this.addAction("openLink",function(){var link=graph.getLinkForCell(graph.getSelectionCell());if(link!=null){window.open(link)}});this.addAction("editLink...",function(){var graph=ui.editor.graph;if(graph.isEnabled()&&!graph.isSelectionEmpty()){var cell=graph.getSelectionCell();var value=graph.getLinkForCell(cell)||"";ui.showLinkDialog(value,mxResources.get("apply"),function(link){link=mxUtils.trim(link);graph.setLinkForCell(cell,link.length>0?link:null)})}});this.addAction("insertLink...",function(){if(graph.isEnabled()&&!graph.isCellLocked(graph.getDefaultParent())){var dlg=new LinkDialog(ui,"",mxResources.get("insert"),function(link,docs){link=mxUtils.trim(link);if(link.length>0){var title=link.substring(link.lastIndexOf("/")+1);var icon=null;if(docs!=null&&docs.length>0){icon=docs[0].iconUrl;title=docs[0].name||docs[0].type;title=title.charAt(0).toUpperCase()+title.substring(1);if(title.length>30){title=title.substring(0,30)+"..."}}var pt=graph.getFreeInsertPoint();var linkCell=new mxCell(title,new mxGeometry(pt.x,pt.y,100,40),"fontColor=#0000EE;fontStyle=4;rounded=1;overflow=hidden;"+(icon!=null?"shape=label;imageWidth=16;imageHeight=16;spacingLeft=26;align=left;image="+icon:"spacing=10;"));linkCell.vertex=true;graph.setLinkForCell(linkCell,link);graph.cellSizeUpdated(linkCell,true);graph.setSelectionCell(graph.addCell(linkCell));graph.scrollCellToVisible(graph.getSelectionCell())}});ui.showDialog(dlg.container,420,90,true,true);dlg.init()}}).isEnabled=isGraphEnabled;this.addAction("link...",mxUtils.bind(this,function(){var graph=ui.editor.graph;if(graph.isEnabled()){if(graph.cellEditor.isContentEditing()){var link=graph.getParentByName(graph.getSelectedElement(),"A",graph.cellEditor.textarea);var oldValue="";if(link!=null){oldValue=link.getAttribute("href")||""}var selState=graph.cellEditor.saveSelection();ui.showLinkDialog(oldValue,mxResources.get("apply"),mxUtils.bind(this,function(value){graph.cellEditor.restoreSelection(selState);if(value!=null){graph.insertLink(value)}}))}else if(graph.isSelectionEmpty()){this.get("insertLink").funct()}else{this.get("editLink").funct()}}})).isEnabled=isGraphEnabled;this.addAction("autosize",function(){var cells=graph.getSelectionCells();if(cells!=null){graph.getModel().beginUpdate();try{for(var i=0;i<cells.length;i++){var cell=cells[i];if(graph.getModel().getChildCount(cell)){graph.updateGroupBounds([cell],20)}else{var state=graph.view.getState(cell);var geo=graph.getCellGeometry(cell);if(graph.getModel().isVertex(cell)&&state!=null&&state.text!=null&&geo!=null&&graph.isWrapping(cell)){geo=geo.clone();geo.height=state.text.boundingBox.height/graph.view.scale;graph.getModel().setGeometry(cell,geo)}else{graph.updateCellSize(cell)}}}}finally{graph.getModel().endUpdate()}}},null,null,"Ctrl+Shift+Y");this.addAction("formattedText",function(){var state=graph.getView().getState(graph.getSelectionCell());if(state!=null){var value="1";graph.stopEditing();graph.getModel().beginUpdate();try{if(state.style["html"]=="1"){value=null;var label=graph.convertValueToString(state.cell);if(mxUtils.getValue(state.style,"nl2Br","1")!="0"){label=label.replace(/\n/g,"").replace(/<br\s*.?>/g,"\n")}var temp=document.createElement("div");temp.innerHTML=label;label=mxUtils.extractTextWithWhitespace(temp.childNodes);graph.cellLabelChanged(state.cell,label)}else{var label=mxUtils.htmlEntities(graph.convertValueToString(state.cell),false);if(mxUtils.getValue(state.style,"nl2Br","1")!="0"){label=label.replace(/\n/g,"<br/>")}graph.cellLabelChanged(state.cell,graph.sanitizeHtml(label))}graph.setCellStyles("html",value);ui.fireEvent(new mxEventObject("styleChanged","keys",["html"],"values",[value!=null?value:"0"],"cells",graph.getSelectionCells()))}finally{graph.getModel().endUpdate()}}});this.addAction("wordWrap",function(){var state=graph.getView().getState(graph.getSelectionCell());var value="wrap";graph.stopEditing();if(state!=null&&state.style[mxConstants.STYLE_WHITE_SPACE]=="wrap"){value=null}graph.setCellStyles(mxConstants.STYLE_WHITE_SPACE,value)});this.addAction("rotation",function(){var value="0";var state=graph.getView().getState(graph.getSelectionCell());if(state!=null){value=state.style[mxConstants.STYLE_ROTATION]||value}var dlg=new FilenameDialog(ui,value,mxResources.get("apply"),function(newValue){if(newValue!=null&&newValue.length>0){graph.setCellStyles(mxConstants.STYLE_ROTATION,newValue)}},mxResources.get("enterValue")+" ("+mxResources.get("rotation")+" 0-360)");ui.showDialog(dlg.container,300,80,true,true);dlg.init()});this.addAction("resetView",function(){graph.zoomTo(1);ui.resetScrollbars()},null,null,"Ctrl+H");this.addAction("zoomIn",function(evt){graph.zoomIn()},null,null,"Ctrl + / Alt+Mousewheel");this.addAction("zoomOut",function(evt){graph.zoomOut()},null,null,"Ctrl - / Alt+Mousewheel");this.addAction("fitWindow",function(){graph.fit()},null,null,"Ctrl+Shift+H");this.addAction("fitPage",mxUtils.bind(this,function(){if(!graph.pageVisible){this.get("pageView").funct()}var fmt=graph.pageFormat;var ps=graph.pageScale;var cw=graph.container.clientWidth-10;var ch=graph.container.clientHeight-10;var scale=Math.floor(20*Math.min(cw/fmt.width/ps,ch/fmt.height/ps))/20;graph.zoomTo(scale);if(mxUtils.hasScrollbars(graph.container)){var pad=graph.getPagePadding();graph.container.scrollTop=pad.y*graph.view.scale;graph.container.scrollLeft=Math.min(pad.x*graph.view.scale,(graph.container.scrollWidth-graph.container.clientWidth)/2)}}),null,null,"Ctrl+J");this.addAction("fitTwoPages",mxUtils.bind(this,function(){if(!graph.pageVisible){this.get("pageView").funct()}var fmt=graph.pageFormat;var ps=graph.pageScale;var cw=graph.container.clientWidth-10;var ch=graph.container.clientHeight-10;var scale=Math.floor(20*Math.min(cw/(2*fmt.width)/ps,ch/fmt.height/ps))/20;graph.zoomTo(scale);if(mxUtils.hasScrollbars(graph.container)){var pad=graph.getPagePadding();graph.container.scrollTop=Math.min(pad.y,(graph.container.scrollHeight-graph.container.clientHeight)/2);graph.container.scrollLeft=Math.min(pad.x,(graph.container.scrollWidth-graph.container.clientWidth)/2)}}),null,null,"Ctrl+Shift+J");this.addAction("fitPageWidth",mxUtils.bind(this,function(){if(!graph.pageVisible){this.get("pageView").funct()}var fmt=graph.pageFormat;var ps=graph.pageScale;var cw=graph.container.clientWidth-10;var scale=Math.floor(20*cw/fmt.width/ps)/20;graph.zoomTo(scale);if(mxUtils.hasScrollbars(graph.container)){var pad=graph.getPagePadding();graph.container.scrollLeft=Math.min(pad.x*graph.view.scale,(graph.container.scrollWidth-graph.container.clientWidth)/2)}}));this.put("customZoom",new Action(mxResources.get("custom")+"...",mxUtils.bind(this,function(){var dlg=new FilenameDialog(this.editorUi,parseInt(graph.getView().getScale()*100),mxResources.get("apply"),mxUtils.bind(this,function(newValue){var val=parseInt(newValue);if(!isNaN(val)&&val>0){graph.zoomTo(val/100)}}),mxResources.get("zoom")+" (%)");this.editorUi.showDialog(dlg.container,300,80,true,true);dlg.init()}),null,null,"Ctrl+0"));this.addAction("pageScale...",mxUtils.bind(this,function(){var dlg=new FilenameDialog(this.editorUi,parseInt(graph.pageScale*100),mxResources.get("apply"),mxUtils.bind(this,function(newValue){var val=parseInt(newValue);if(!isNaN(val)&&val>0){ui.setPageScale(val/100)}}),mxResources.get("pageScale")+" (%)");this.editorUi.showDialog(dlg.container,300,80,true,true);dlg.init()}));var action=null;action=this.addAction("grid",function(){graph.setGridEnabled(!graph.isGridEnabled());ui.fireEvent(new mxEventObject("gridEnabledChanged"))},null,null,"Ctrl+Shift+G");action.setToggleAction(true);action.setSelectedCallback(function(){return graph.isGridEnabled()});action.setEnabled(false);action=this.addAction("guides",function(){graph.graphHandler.guidesEnabled=!graph.graphHandler.guidesEnabled;ui.fireEvent(new mxEventObject("guidesEnabledChanged"))});action.setToggleAction(true);action.setSelectedCallback(function(){return graph.graphHandler.guidesEnabled});action.setEnabled(false);action=this.addAction("tooltips",function(){graph.tooltipHandler.setEnabled(!graph.tooltipHandler.isEnabled())});action.setToggleAction(true);action.setSelectedCallback(function(){return graph.tooltipHandler.isEnabled()});action=this.addAction("collapseExpand",function(){ui.setFoldingEnabled(!graph.foldingEnabled)});action.setToggleAction(true);action.setSelectedCallback(function(){return graph.foldingEnabled});action.isEnabled=isGraphEnabled;action=this.addAction("scrollbars",function(){ui.setScrollbars(!ui.hasScrollbars())});action.setToggleAction(true);action.setSelectedCallback(function(){return graph.scrollbars});action=this.addAction("pageView",mxUtils.bind(this,function(){ui.setPageVisible(!graph.pageVisible)}));action.setToggleAction(true);action.setSelectedCallback(function(){return graph.pageVisible});this.put("pageBackgroundColor",new Action(mxResources.get("backgroundColor")+"...",function(){ui.pickColor(graph.background||"none",function(color){ui.setBackgroundColor(color)})}));action=this.addAction("connectionArrows",function(){graph.connectionArrowsEnabled=!graph.connectionArrowsEnabled;ui.fireEvent(new mxEventObject("connectionArrowsChanged"))},null,null,"Ctrl+Q");action.setToggleAction(true);action.setSelectedCallback(function(){return graph.connectionArrowsEnabled});action=this.addAction("connectionPoints",function(){graph.setConnectable(!graph.connectionHandler.isEnabled());ui.fireEvent(new mxEventObject("connectionPointsChanged"))},null,null,"Ctrl+Shift+Q");action.setToggleAction(true);action.setSelectedCallback(function(){return graph.connectionHandler.isEnabled()});action=this.addAction("copyConnect",function(){graph.connectionHandler.setCreateTarget(!graph.connectionHandler.isCreateTarget());ui.fireEvent(new mxEventObject("copyConnectChanged"))});action.setToggleAction(true);action.setSelectedCallback(function(){return graph.connectionHandler.isCreateTarget()});action.isEnabled=isGraphEnabled;action=this.addAction("autosave",function(){ui.editor.setAutosave(!ui.editor.autosave)});action.setToggleAction(true);action.setSelectedCallback(function(){return ui.editor.autosave});action.isEnabled=isGraphEnabled;action.visible=false;this.addAction("help",function(){var ext="";if(mxResources.isLanguageSupported(mxClient.language)){ext="_"+mxClient.language}window.open(RESOURCES_PATH+"/help"+ext+".html")});this.put("about",new Action(mxResources.get("about")+" Graph Editor...",function(){ui.showDialog(new AboutDialog(ui).container,320,280,true,true)},null,null,"F1"));var toggleFontStyle=mxUtils.bind(this,function(key,style,fn,shortcut){return this.addAction(key,function(){if(fn!=null&&graph.cellEditor.isContentEditing()){fn()}else{graph.stopEditing(false);graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,style)}},null,null,shortcut)});toggleFontStyle("bold",mxConstants.FONT_BOLD,function(){document.execCommand("bold",false,null)},"Ctrl+B");toggleFontStyle("italic",mxConstants.FONT_ITALIC,function(){document.execCommand("italic",false,null)},"Ctrl+I");toggleFontStyle("underline",mxConstants.FONT_UNDERLINE,function(){document.execCommand("underline",false,null)},"Ctrl+U");this.addAction("fontColor...",function(){ui.menus.pickColor(mxConstants.STYLE_FONTCOLOR,"forecolor","000000")});this.addAction("strokeColor...",function(){ui.menus.pickColor(mxConstants.STYLE_STROKECOLOR)});this.addAction("fillColor...",function(){ui.menus.pickColor(mxConstants.STYLE_FILLCOLOR)});this.addAction("gradientColor...",function(){ui.menus.pickColor(mxConstants.STYLE_GRADIENTCOLOR)});this.addAction("backgroundColor...",function(){ui.menus.pickColor(mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,"backcolor")});this.addAction("borderColor...",function(){ui.menus.pickColor(mxConstants.STYLE_LABEL_BORDERCOLOR)});this.addAction("vertical",function(){ui.menus.toggleStyle(mxConstants.STYLE_HORIZONTAL,true)});this.addAction("shadow",function(){ui.menus.toggleStyle(mxConstants.STYLE_SHADOW)});this.addAction("solid",function(){graph.getModel().beginUpdate();try{graph.setCellStyles(mxConstants.STYLE_DASHED,null);graph.setCellStyles(mxConstants.STYLE_DASH_PATTERN,null);ui.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],"values",[null,null],"cells",graph.getSelectionCells()))}finally{graph.getModel().endUpdate()}});this.addAction("dashed",function(){graph.getModel().beginUpdate();try{graph.setCellStyles(mxConstants.STYLE_DASHED,"1");graph.setCellStyles(mxConstants.STYLE_DASH_PATTERN,null);ui.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],"values",["1",null],"cells",graph.getSelectionCells()))}finally{graph.getModel().endUpdate()}});this.addAction("dotted",function(){graph.getModel().beginUpdate();try{graph.setCellStyles(mxConstants.STYLE_DASHED,"1");graph.setCellStyles(mxConstants.STYLE_DASH_PATTERN,"1 4");ui.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],"values",["1","1 4"],"cells",graph.getSelectionCells()))}finally{graph.getModel().endUpdate()}});this.addAction("sharp",function(){graph.getModel().beginUpdate();try{graph.setCellStyles(mxConstants.STYLE_ROUNDED,"0");graph.setCellStyles(mxConstants.STYLE_CURVED,"0");ui.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],"values",["0","0"],"cells",graph.getSelectionCells()))}finally{graph.getModel().endUpdate()}});this.addAction("rounded",function(){graph.getModel().beginUpdate();try{graph.setCellStyles(mxConstants.STYLE_ROUNDED,"1");graph.setCellStyles(mxConstants.STYLE_CURVED,"0");ui.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],"values",["1","0"],"cells",graph.getSelectionCells()))}finally{graph.getModel().endUpdate()}});this.addAction("toggleRounded",function(){if(!graph.isSelectionEmpty()&&graph.isEnabled()){graph.getModel().beginUpdate();try{var cells=graph.getSelectionCells();var state=graph.view.getState(cells[0]);var style=state!=null?state.style:graph.getCellStyle(cells[0]);var value=mxUtils.getValue(style,mxConstants.STYLE_ROUNDED,"0")=="1"?"0":"1";graph.setCellStyles(mxConstants.STYLE_ROUNDED,value);graph.setCellStyles(mxConstants.STYLE_CURVED,null);ui.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],"values",[value,"0"],"cells",graph.getSelectionCells()))}finally{graph.getModel().endUpdate()}}});this.addAction("curved",function(){graph.getModel().beginUpdate();try{graph.setCellStyles(mxConstants.STYLE_ROUNDED,"0");graph.setCellStyles(mxConstants.STYLE_CURVED,"1");ui.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],"values",["0","1"],"cells",graph.getSelectionCells()))}finally{graph.getModel().endUpdate()}});this.addAction("collapsible",function(){var state=graph.view.getState(graph.getSelectionCell());var value="1";if(state!=null&&graph.getFoldingImage(state)!=null){value="0"}graph.setCellStyles("collapsible",value);ui.fireEvent(new mxEventObject("styleChanged","keys",["collapsible"],"values",[value],"cells",graph.getSelectionCells()))});this.addAction("editStyle...",mxUtils.bind(this,function(){var cells=graph.getSelectionCells();if(cells!=null&&cells.length>0){var model=graph.getModel();var dlg=new TextareaDialog(this.editorUi,mxResources.get("editStyle")+":",model.getStyle(cells[0])||"",function(newValue){if(newValue!=null){graph.setCellStyle(mxUtils.trim(newValue),cells)}},null,null,400,220);this.editorUi.showDialog(dlg.container,420,300,true,true);dlg.init()}}),null,null,"Ctrl+E");this.addAction("setAsDefaultStyle",function(){if(graph.isEnabled()&&!graph.isSelectionEmpty()){ui.setDefaultStyle(graph.getSelectionCell())}},null,null,"Ctrl+Shift+D");this.addAction("clearDefaultStyle",function(){if(graph.isEnabled()){ui.clearDefaultStyle()}},null,null,"Ctrl+Shift+R");this.addAction("addWaypoint",function(){var cell=graph.getSelectionCell();if(cell!=null&&graph.getModel().isEdge(cell)){var handler=editor.graph.selectionCellsHandler.getHandler(cell);if(handler instanceof mxEdgeHandler){var t=graph.view.translate;var s=graph.view.scale;var dx=t.x;var dy=t.y;var parent=graph.getModel().getParent(cell);var pgeo=graph.getCellGeometry(parent);while(graph.getModel().isVertex(parent)&&pgeo!=null){dx+=pgeo.x;dy+=pgeo.y;parent=graph.getModel().getParent(parent);pgeo=graph.getCellGeometry(parent)}var x=Math.round(graph.snap(graph.popupMenuHandler.triggerX/s-dx));var y=Math.round(graph.snap(graph.popupMenuHandler.triggerY/s-dy));handler.addPointAt(handler.state,x,y)}}});this.addAction("removeWaypoint",function(){var rmWaypointAction=ui.actions.get("removeWaypoint");if(rmWaypointAction.handler!=null){rmWaypointAction.handler.removePoint(rmWaypointAction.handler.state,rmWaypointAction.index)}});this.addAction("clearWaypoints",function(){var cells=graph.getSelectionCells();if(cells!=null){graph.getModel().beginUpdate();try{for(var i=0;i<cells.length;i++){var cell=cells[i];if(graph.getModel().isEdge(cell)){var geo=graph.getCellGeometry(cell);if(geo!=null){geo=geo.clone();geo.points=null;graph.getModel().setGeometry(cell,geo)}}}}finally{graph.getModel().endUpdate()}}});action=this.addAction("subscript",mxUtils.bind(this,function(){if(graph.cellEditor.isContentEditing()){document.execCommand("subscript",false,null)}}),null,null,"Ctrl+,");action=this.addAction("superscript",mxUtils.bind(this,function(){if(graph.cellEditor.isContentEditing()){document.execCommand("superscript",false,null)}}),null,null,"Ctrl+.");this.addAction("image...",function(){if(graph.isEnabled()&&!graph.isCellLocked(graph.getDefaultParent())){var title=mxResources.get("image")+" ("+mxResources.get("url")+"):";var state=graph.getView().getState(graph.getSelectionCell());var value="";if(state!=null){value=state.style[mxConstants.STYLE_IMAGE]||value}var selectionState=graph.cellEditor.saveSelection();ui.showImageDialog(title,value,function(newValue,w,h){if(graph.cellEditor.isContentEditing()){graph.cellEditor.restoreSelection(selectionState);graph.insertImage(newValue,w,h)}else{var cells=graph.getSelectionCells();if(newValue!=null){var select=null;graph.getModel().beginUpdate();try{if(cells.length==0){var pt=graph.getFreeInsertPoint();cells=[graph.insertVertex(graph.getDefaultParent(),null,"",pt.x,pt.y,w,h,"shape=image;imageAspect=0;aspect=fixed;verticalLabelPosition=bottom;verticalAlign=top;")];select=cells}graph.setCellStyles(mxConstants.STYLE_IMAGE,newValue,cells);var state=graph.view.getState(cells[0]);var style=state!=null?state.style:graph.getCellStyle(cells[0]);if(style[mxConstants.STYLE_SHAPE]!="image"&&style[mxConstants.STYLE_SHAPE]!="label"){graph.setCellStyles(mxConstants.STYLE_SHAPE,"image",cells)}if(graph.getSelectionCount()==1){if(w!=null&&h!=null){var cell=cells[0];var geo=graph.getModel().getGeometry(cell);if(geo!=null){geo=geo.clone();geo.width=w;geo.height=h;graph.getModel().setGeometry(cell,geo)}}}}finally{graph.getModel().endUpdate()}if(select!=null){graph.setSelectionCells(select);graph.scrollCellToVisible(select[0])}}}},graph.cellEditor.isContentEditing(),!graph.cellEditor.isContentEditing())}}).isEnabled=isGraphEnabled;this.addAction("insertImage...",function(){if(graph.isEnabled()&&!graph.isCellLocked(graph.getDefaultParent())){graph.clearSelection();ui.actions.get("image").funct()}}).isEnabled=isGraphEnabled;action=this.addAction("layers",mxUtils.bind(this,function(){if(this.layersWindow==null){this.layersWindow=new LayersWindow(ui,document.body.offsetWidth-280,120,220,180);this.layersWindow.window.addListener("show",function(){ui.fireEvent(new mxEventObject("layers"))});this.layersWindow.window.addListener("hide",function(){ui.fireEvent(new mxEventObject("layers"))});this.layersWindow.window.setVisible(true);ui.fireEvent(new mxEventObject("layers"))}else{this.layersWindow.window.setVisible(!this.layersWindow.window.isVisible())}}),null,null,"Ctrl+Shift+L");action.setToggleAction(true);action.setSelectedCallback(mxUtils.bind(this,function(){return this.layersWindow!=null&&this.layersWindow.window.isVisible()}));action=this.addAction("formatPanel",mxUtils.bind(this,function(){ui.toggleFormatPanel()}),null,null,"Ctrl+Shift+P");action.setToggleAction(true);action.setSelectedCallback(mxUtils.bind(this,function(){return ui.formatWidth>0}));action=this.addAction("outline",mxUtils.bind(this,function(){if(this.outlineWindow==null){this.outlineWindow=new OutlineWindow(ui,document.body.offsetWidth-260,100,180,180);this.outlineWindow.window.addListener("show",function(){ui.fireEvent(new mxEventObject("outline"))});this.outlineWindow.window.addListener("hide",function(){ui.fireEvent(new mxEventObject("outline"))});this.outlineWindow.window.setVisible(true);ui.fireEvent(new mxEventObject("outline"))}else{this.outlineWindow.window.setVisible(!this.outlineWindow.window.isVisible())}ui.fireEvent(new mxEventObject("outline"))}),null,null,"Ctrl+Shift+O");action.setToggleAction(true);action.setSelectedCallback(mxUtils.bind(this,function(){return this.outlineWindow!=null&&this.outlineWindow.window.isVisible()}))};Actions.prototype.addAction=function(key,funct,enabled,iconCls,shortcut){var title;if(key.substring(key.length-3)=="..."){key=key.substring(0,key.length-3);title=mxResources.get(key)+"..."}else{title=mxResources.get(key)}return this.put(key,new Action(title,funct,enabled,iconCls,shortcut))};Actions.prototype.put=function(name,action){this.actions[name]=action;return action};Actions.prototype.get=function(name){return this.actions[name]};function Action(label,funct,enabled,iconCls,shortcut){mxEventSource.call(this);this.label=label;this.funct=funct;this.enabled=enabled!=null?enabled:true;this.iconCls=iconCls;this.shortcut=shortcut;this.visible=true}mxUtils.extend(Action,mxEventSource);Action.prototype.setEnabled=function(value){if(this.enabled!=value){this.enabled=value;this.fireEvent(new mxEventObject("stateChanged"))}};Action.prototype.isEnabled=function(){return this.enabled};Action.prototype.setToggleAction=function(value){this.toggleAction=value};Action.prototype.setSelectedCallback=function(funct){this.selectedCallback=funct};Action.prototype.isSelected=function(){return this.selectedCallback()};module.exports=Actions},{"./Save.js":5}],2:[function(require,module,exports){addClassDiagramPalette=function(sb,expand){var field=new mxCell("+ field: type",new mxGeometry(0,0,100,26),"text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;");var attributeField=new mxCell("+ field: type",new mxGeometry(0,0,100,26),"text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;componentName=attribute");var methodField=new mxCell("+ method(type): type",new mxGeometry(0,0,100,26),"text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;componentName=method");field.vertex=true;attributeField.vertex=true;methodField.vertex=true;var divider=new mxCell("",new mxGeometry(0,0,40,8),"line;html=1;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;");divider.vertex=true;var dt="uml static class ";var fns=[sb.addEntry(dt+"object instance",function(){var cell=new mxCell("Classname",new mxGeometry(0,0,160,90),"swimlane;html=1;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeLast=0;collapsible=1;marginBottom=0;swimlaneFillColor=#ffffff;fillColor=#DAE8FC;componentName=class;");cell.vertex=true;cell.insert(attributeField.clone());cell.insert(divider.clone());cell.insert(methodField.clone());return sb.createVertexTemplateFromCells([cell],cell.geometry.width,cell.geometry.height,"Class")}),sb.addEntry(dt+"item member method function variable field attribute label",function(){return sb.createVertexTemplateFromCells([sb.cloneCell(field,"+ item: attribute")],field.geometry.width,field.geometry.height,"Item 1")}),sb.addEntry(dt+"divider hline line separator",function(){return sb.createVertexTemplateFromCells([divider.clone()],divider.geometry.width,divider.geometry.height,"Divider")}),sb.createVertexTemplateEntry("text;html=1;align=center;fontStyle=1;verticalAlign=middle;spacingLeft=3;spacingRight=3;strokeColor=none;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;",80,26,"Title","Title",null,null,dt+"title label"),sb.addEntry(dt+"object instance",function(){var cell=new mxCell("<i>&lt;&lt;Interface&gt;&gt;</i><br/> Interface",new mxGeometry(0,0,190,90),"swimlane;html=1;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeLast=0;collapsible=1;marginBottom=0;swimlaneFillColor=#ffffff;fillColor=#DAE8FC;componentName=interface;");cell.vertex=true;cell.insert(attributeField.clone());cell.insert(divider.clone());cell.insert(methodField.clone());return sb.createVertexTemplateFromCells([cell],cell.geometry.width,cell.geometry.height,"Interface")}),sb.addEntry("uml aggregation",function(){var edge=new mxCell("1",new mxGeometry(0,0,0,0),"endArrow=open;html=1;endSize=12;startArrow=diamondThin;startSize=14;startFill=0;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=bottom;");edge.geometry.setTerminalPoint(new mxPoint(0,0),true);edge.geometry.setTerminalPoint(new mxPoint(160,0),false);edge.geometry.relative=true;edge.geometry.x=-1;edge.geometry.y=3;edge.edge=true;return sb.createEdgeTemplateFromCells([edge],160,0,"Aggregation")}),sb.addEntry("uml composition",function(){var edge=new mxCell("1",new mxGeometry(0,0,0,0),"endArrow=open;html=1;endSize=12;startArrow=diamondThin;startSize=14;startFill=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=bottom;");edge.geometry.setTerminalPoint(new mxPoint(0,0),true);edge.geometry.setTerminalPoint(new mxPoint(160,0),false);edge.geometry.relative=true;edge.geometry.x=-1;edge.geometry.y=3;edge.edge=true;return sb.createEdgeTemplateFromCells([edge],160,0,"Composition")}),sb.createEdgeTemplateEntry("endArrow=block;endSize=16;endFill=0;html=1;componentName=generalization;",160,0,"Extends","Generalization",null,"uml generalization extend")];sb.addPaletteFunctions("classDiagram",mxResources.get("classDiagram"),expand||false,fns)};module.exports=addClassDiagramPalette},{}],3:[function(require,module,exports){var Sidebar=require("./Sidebar");var Menus=require("./Menus");var Actions=require("./Actions");var Toolbar=require("./Toolbar");EditorUi=function(editor,container,lightbox){mxEventSource.call(this);this.destroyFunctions=[];this.editor=editor||new Editor;this.container=container||document.body;var graph=this.editor.graph;graph.lightbox=lightbox;if(mxClient.IS_SVG){mxPopupMenu.prototype.submenuImage="data:image/gif;base64,R0lGODlhCQAJAIAAAP///zMzMyH5BAEAAAAALAAAAAAJAAkAAAIPhI8WebHsHopSOVgb26AAADs="}else{(new Image).src=mxPopupMenu.prototype.submenuImage}if(!mxClient.IS_SVG&&mxConnectionHandler.prototype.connectImage!=null){(new Image).src=mxConnectionHandler.prototype.connectImage.src}if(this.editor.chromeless){this.footerHeight=0;graph.isEnabled=function(){return false};graph.panningHandler.isForcePanningEvent=function(me){return!mxEvent.isPopupTrigger(me.getEvent())}}this.actions=new Actions(this);this.menus=this.createMenus();this.createDivs();this.createUi();this.refresh();var textEditing=mxUtils.bind(this,function(evt){if(evt==null){evt=window.event}return this.isSelectionAllowed(evt)||graph.isEditing()});if(this.container==document.body){this.menubarContainer.onselectstart=textEditing;this.menubarContainer.onmousedown=textEditing;this.toolbarContainer.onselectstart=textEditing;this.toolbarContainer.onmousedown=textEditing;this.diagramContainer.onselectstart=textEditing;this.diagramContainer.onmousedown=textEditing;this.sidebarContainer.onselectstart=textEditing;this.sidebarContainer.onmousedown=textEditing;this.formatContainer.onselectstart=textEditing;this.formatContainer.onmousedown=textEditing;this.footerContainer.onselectstart=textEditing;this.footerContainer.onmousedown=textEditing;if(this.tabContainer!=null){this.tabContainer.onselectstart=textEditing}}if(!this.editor.chromeless){if(mxClient.IS_IE&&(typeof document.documentMode==="undefined"||document.documentMode<9)){mxEvent.addListener(this.diagramContainer,"contextmenu",textEditing)}else{this.diagramContainer.oncontextmenu=textEditing}}else{graph.panningHandler.usePopupTrigger=false}graph.init(this.diagramContainer);this.hoverIcons=this.createHoverIcons();mxEvent.addListener(this.diagramContainer,"mousemove",mxUtils.bind(this,function(evt){var off=mxUtils.getOffset(this.diagramContainer);if(mxEvent.getClientX(evt)-off.x-this.diagramContainer.clientWidth>0||mxEvent.getClientY(evt)-off.y-this.diagramContainer.clientHeight>0){this.diagramContainer.setAttribute("title",mxResources.get("panTooltip"))}else{this.diagramContainer.removeAttribute("title")}}));var spaceKeyPressed=false;var hoverIconsIsResetEvent=this.hoverIcons.isResetEvent;this.hoverIcons.isResetEvent=function(evt,allowShift){return spaceKeyPressed||hoverIconsIsResetEvent.apply(this,arguments)};this.keydownHandler=mxUtils.bind(this,function(evt){if(evt.which==32){spaceKeyPressed=true;this.hoverIcons.reset();graph.container.style.cursor="move";if(!graph.isEditing()&&mxEvent.getSource(evt)==graph.container){mxEvent.consume(evt)}}else if(!mxEvent.isConsumed(evt)&&evt.keyCode==27){this.hideDialog()}});mxEvent.addListener(document,"keydown",this.keydownHandler);this.keyupHandler=mxUtils.bind(this,function(evt){graph.container.style.cursor="";spaceKeyPressed=false});mxEvent.addListener(document,"keyup",this.keyupHandler);var panningHandlerIsForcePanningEvent=graph.panningHandler.isForcePanningEvent;graph.panningHandler.isForcePanningEvent=function(me){return panningHandlerIsForcePanningEvent.apply(this,arguments)||spaceKeyPressed||mxEvent.isMouseEvent(me.getEvent())&&(this.usePopupTrigger||!mxEvent.isPopupTrigger(me.getEvent()))&&(!mxEvent.isControlDown(me.getEvent())&&mxEvent.isRightMouseButton(me.getEvent())||mxEvent.isMiddleMouseButton(me.getEvent()))};var cellEditorIsStopEditingEvent=graph.cellEditor.isStopEditingEvent;graph.cellEditor.isStopEditingEvent=function(evt){return cellEditorIsStopEditingEvent.apply(this,arguments)||evt.keyCode==13&&(!mxClient.IS_SF&&mxEvent.isControlDown(evt)||mxClient.IS_MAC&&mxEvent.isMetaDown(evt)||mxClient.IS_SF&&mxEvent.isShiftDown(evt))};var textMode=false;var fontMenu=null;var sizeMenu=null;var nodes=null;var updateToolbar=mxUtils.bind(this,function(){if(textMode!=graph.cellEditor.isContentEditing()){var node=this.toolbar.container.firstChild;var newNodes=[];while(node!=null){var tmp=node.nextSibling;if(mxUtils.indexOf(this.toolbar.staticElements,node)<0){node.parentNode.removeChild(node);newNodes.push(node)}node=tmp}var tmp1=this.toolbar.fontMenu;var tmp2=this.toolbar.sizeMenu;if(nodes==null){this.toolbar.createTextToolbar()}else{for(var i=0;i<nodes.length;i++){this.toolbar.container.appendChild(nodes[i])}this.toolbar.fontMenu=fontMenu;this.toolbar.sizeMenu=sizeMenu}textMode=graph.cellEditor.isContentEditing();fontMenu=tmp1;sizeMenu=tmp2;nodes=newNodes}});var ui=this;var cellEditorStartEditing=graph.cellEditor.startEditing;graph.cellEditor.startEditing=function(){cellEditorStartEditing.apply(this,arguments);updateToolbar();if(graph.cellEditor.isContentEditing()){var updating=false;var updateCssHandler=function(){if(!updating){updating=true;window.setTimeout(function(){var selectedElement=graph.getSelectedElement();var node=selectedElement;while(node!=null&&node.nodeType!=mxConstants.NODETYPE_ELEMENT){node=node.parentNode}if(node!=null){var css=mxUtils.getCurrentStyle(node);if(css!=null&&ui.toolbar!=null){var ff=css.fontFamily;if(ff.charAt(0)=="'"){ff=ff.substring(1)}if(ff.charAt(ff.length-1)=="'"){ff=ff.substring(0,ff.length-1)}ui.toolbar.setFontName(ff);ui.toolbar.setFontSize(parseInt(css.fontSize))}}updating=false},0)}};mxEvent.addListener(graph.cellEditor.textarea,"input",updateCssHandler);mxEvent.addListener(graph.cellEditor.textarea,"touchend",updateCssHandler);mxEvent.addListener(graph.cellEditor.textarea,"mouseup",updateCssHandler);mxEvent.addListener(graph.cellEditor.textarea,"keyup",updateCssHandler);updateCssHandler()}};var cellEditorStopEditing=graph.cellEditor.stopEditing;graph.cellEditor.stopEditing=function(cell,trigger){cellEditorStopEditing.apply(this,arguments);updateToolbar()};graph.container.setAttribute("tabindex","0");graph.container.style.cursor="default";if(window.self===window.top&&graph.container.parentNode!=null){graph.container.focus()}var graphFireMouseEvent=graph.fireMouseEvent;graph.fireMouseEvent=function(evtName,me,sender){if(evtName==mxEvent.MOUSE_DOWN){this.container.focus()}graphFireMouseEvent.apply(this,arguments)};graph.popupMenuHandler.autoExpand=true;if(this.menus!=null){graph.popupMenuHandler.factoryMethod=mxUtils.bind(this,function(menu,cell,evt){this.menus.createPopupMenu(menu,cell,evt)})}mxEvent.addGestureListeners(document,mxUtils.bind(this,function(evt){graph.popupMenuHandler.hideMenu()}));this.keyHandler=this.createKeyHandler(editor);this.getKeyHandler=function(){return keyHandler};var styles=["rounded","shadow","glass","dashed","dashPattern","comic","labelBackgroundColor"];var connectStyles=["shape","edgeStyle","curved","rounded","elbow","comic"];this.setDefaultStyle=function(cell){var state=graph.view.getState(cell);if(state!=null){var clone=cell.clone();clone.style="";var defaultStyle=graph.getCellStyle(clone);var values=[];var keys=[];for(var key in state.style){if(defaultStyle[key]!=state.style[key]){values.push(state.style[key]);keys.push(key)}}var cellStyle=graph.getModel().getStyle(state.cell);var tokens=cellStyle!=null?cellStyle.split(";"):[];for(var i=0;i<tokens.length;i++){var tmp=tokens[i];var pos=tmp.indexOf("=");if(pos>=0){var key=tmp.substring(0,pos);var value=tmp.substring(pos+1);if(defaultStyle[key]!=null&&value=="none"){values.push(value);keys.push(key)}}}if(graph.getModel().isEdge(state.cell)){graph.currentEdgeStyle={}}else{graph.currentVertexStyle={}}this.fireEvent(new mxEventObject("styleChanged","keys",keys,"values",values,"cells",[state.cell]))}};this.clearDefaultStyle=function(){graph.currentEdgeStyle=graph.defaultEdgeStyle;graph.currentVertexStyle={};this.fireEvent(new mxEventObject("styleChanged","keys",[],"values",[],"cells",[]))};var valueStyles=["fontFamily","fontSize","fontColor"];var alwaysEdgeStyles=["edgeStyle","startArrow","startFill","startSize","endArrow","endFill","endSize","jettySize","orthogonalLoop"];var keyGroups=[["startArrow","startFill","startSize","endArrow","endFill","endSize","jettySize","orthogonalLoop"],["strokeColor","strokeWidth"],["fillColor","gradientColor"],valueStyles,["align"],["html"]];for(var i=0;i<keyGroups.length;i++){for(var j=0;j<keyGroups[i].length;j++){styles.push(keyGroups[i][j])}}for(var i=0;i<connectStyles.length;i++){styles.push(connectStyles[i])}var insertHandler=function(cells,asText){graph.getModel().beginUpdate();try{if(asText){var edge=graph.getModel().isEdge(cell);var current=edge?graph.currentEdgeStyle:graph.currentVertexStyle;var textStyles=["fontSize","fontFamily","fontColor"];for(var j=0;j<textStyles.length;j++){var value=current[textStyles[j]];if(value!=null){graph.setCellStyles(textStyles[j],value,cells)}}}else{for(var i=0;i<cells.length;i++){var cell=cells[i];var cellStyle=graph.getModel().getStyle(cell);var tokens=cellStyle!=null?cellStyle.split(";"):[];var appliedStyles=styles.slice();for(var j=0;j<tokens.length;j++){var tmp=tokens[j];var pos=tmp.indexOf("=");if(pos>=0){var key=tmp.substring(0,pos);var index=mxUtils.indexOf(appliedStyles,key);if(index>=0){appliedStyles.splice(index,1)}for(var k=0;k<keyGroups.length;k++){var group=keyGroups[k];if(mxUtils.indexOf(group,key)>=0){for(var l=0;l<group.length;l++){var index2=mxUtils.indexOf(appliedStyles,group[l]);if(index2>=0){appliedStyles.splice(index2,1)}}}}}}var edge=graph.getModel().isEdge(cell);var current=edge?graph.currentEdgeStyle:graph.currentVertexStyle;for(var j=0;j<appliedStyles.length;j++){var key=appliedStyles[j];var styleValue=current[key];if(styleValue!=null&&(key!="shape"||edge)){if(!edge||mxUtils.indexOf(connectStyles,key)<0){graph.setCellStyles(key,styleValue,[cell])}}}}}}finally{graph.getModel().endUpdate()}};graph.addListener("cellsInserted",function(sender,evt){insertHandler(evt.getProperty("cells"))});graph.addListener("textInserted",function(sender,evt){insertHandler(evt.getProperty("cells"),true)});graph.connectionHandler.addListener(mxEvent.CONNECT,function(sender,evt){var cells=[evt.getProperty("cell")];if(evt.getProperty("terminalInserted")){cells.push(evt.getProperty("terminal"))}insertHandler(cells)});this.addListener("styleChanged",mxUtils.bind(this,function(sender,evt){var cells=evt.getProperty("cells");var vertex=false;var edge=false;if(cells.length>0){for(var i=0;i<cells.length;i++){vertex=graph.getModel().isVertex(cells[i])||vertex;edge=graph.getModel().isEdge(cells[i])||edge;if(edge&&vertex){break}}}else{vertex=true;edge=true}var keys=evt.getProperty("keys");var values=evt.getProperty("values");for(var i=0;i<keys.length;i++){var common=mxUtils.indexOf(valueStyles,keys[i])>=0;if(keys[i]!="strokeColor"||values[i]!=null&&values[i]!="none"){if(mxUtils.indexOf(connectStyles,keys[i])>=0){if(edge||mxUtils.indexOf(alwaysEdgeStyles,keys[i])>=0){if(values[i]==null){delete graph.currentEdgeStyle[keys[i]]}else{graph.currentEdgeStyle[keys[i]]=values[i]}}else if(vertex&&mxUtils.indexOf(styles,keys[i])>=0){if(values[i]==null){delete graph.currentVertexStyle[keys[i]]}else{graph.currentVertexStyle[keys[i]]=values[i]}}}else if(mxUtils.indexOf(styles,keys[i])>=0){if(vertex||common){if(values[i]==null){delete graph.currentVertexStyle[keys[i]]}else{graph.currentVertexStyle[keys[i]]=values[i]}}if(edge||common||mxUtils.indexOf(alwaysEdgeStyles,keys[i])>=0){if(values[i]==null){delete graph.currentEdgeStyle[keys[i]]}else{graph.currentEdgeStyle[keys[i]]=values[i]}}}}}if(this.toolbar!=null){this.toolbar.setFontName(graph.currentVertexStyle["fontFamily"]||Menus.prototype.defaultFont);this.toolbar.setFontSize(graph.currentVertexStyle["fontSize"]||Menus.prototype.defaultFontSize);if(this.toolbar.edgeStyleMenu!=null){var edgeStyleDiv=this.toolbar.edgeStyleMenu.getElementsByTagName("div")[0];if(graph.currentEdgeStyle["edgeStyle"]=="orthogonalEdgeStyle"&&graph.currentEdgeStyle["curved"]=="1"){edgeStyleDiv.className="geSprite geSprite-curved"}else if(graph.currentEdgeStyle["edgeStyle"]=="straight"||graph.currentEdgeStyle["edgeStyle"]=="none"||graph.currentEdgeStyle["edgeStyle"]==null){edgeStyleDiv.className="geSprite geSprite-straight"}else if(graph.currentEdgeStyle["edgeStyle"]=="entityRelationEdgeStyle"){edgeStyleDiv.className="geSprite geSprite-entity"}else if(graph.currentEdgeStyle["edgeStyle"]=="elbowEdgeStyle"){edgeStyleDiv.className="geSprite geSprite-"+(graph.currentEdgeStyle["elbow"]=="vertical"?"verticalelbow":"horizontalelbow")}else if(graph.currentEdgeStyle["edgeStyle"]=="isometricEdgeStyle"){edgeStyleDiv.className="geSprite geSprite-"+(graph.currentEdgeStyle["elbow"]=="vertical"?"verticalisometric":"horizontalisometric")}else{edgeStyleDiv.className="geSprite geSprite-orthogonal"}}if(this.toolbar.edgeShapeMenu!=null){var edgeShapeDiv=this.toolbar.edgeShapeMenu.getElementsByTagName("div")[0];if(graph.currentEdgeStyle["shape"]=="link"){edgeShapeDiv.className="geSprite geSprite-linkedge"}else if(graph.currentEdgeStyle["shape"]=="flexArrow"){edgeShapeDiv.className="geSprite geSprite-arrow"}else if(graph.currentEdgeStyle["shape"]=="arrow"){edgeShapeDiv.className="geSprite geSprite-simplearrow"}else{edgeShapeDiv.className="geSprite geSprite-connection"}}if(this.toolbar.lineStartMenu!=null){var lineStartDiv=this.toolbar.lineStartMenu.getElementsByTagName("div")[0];lineStartDiv.className=this.getCssClassForMarker("start",graph.currentEdgeStyle["shape"],graph.currentEdgeStyle[mxConstants.STYLE_STARTARROW],mxUtils.getValue(graph.currentEdgeStyle,"startFill","1"))}if(this.toolbar.lineEndMenu!=null){var lineEndDiv=this.toolbar.lineEndMenu.getElementsByTagName("div")[0];lineEndDiv.className=this.getCssClassForMarker("end",graph.currentEdgeStyle["shape"],graph.currentEdgeStyle[mxConstants.STYLE_ENDARROW],mxUtils.getValue(graph.currentEdgeStyle,"endFill","1"))}}}));if(this.toolbar!=null){var update=mxUtils.bind(this,function(){var ff=graph.currentVertexStyle["fontFamily"]||"Helvetica";var fs=String(graph.currentVertexStyle["fontSize"]||"12");var state=graph.getView().getState(graph.getSelectionCell());if(state!=null){ff=state.style[mxConstants.STYLE_FONTFAMILY]||ff;fs=state.style[mxConstants.STYLE_FONTSIZE]||fs;if(ff.length>10){ff=ff.substring(0,8)+"..."}}this.toolbar.setFontName(ff);this.toolbar.setFontSize(fs)});graph.getSelectionModel().addListener(mxEvent.CHANGE,update);graph.getModel().addListener(mxEvent.CHANGE,update)}graph.addListener(mxEvent.CELLS_ADDED,function(sender,evt){var cells=evt.getProperty("cells");var parent=evt.getProperty("parent");if(graph.getModel().isLayer(parent)&&!graph.isCellVisible(parent)&&cells!=null&&cells.length>0){graph.getModel().setVisible(parent,true)}});this.gestureHandler=mxUtils.bind(this,function(evt){if(this.currentMenu!=null&&mxEvent.getSource(evt)!=this.currentMenu.div){this.hideCurrentMenu()}});mxEvent.addGestureListeners(document,this.gestureHandler);this.resizeHandler=mxUtils.bind(this,function(){window.setTimeout(mxUtils.bind(this,function(){this.refresh()}),0)});mxEvent.addListener(window,"resize",this.resizeHandler);this.orientationChangeHandler=mxUtils.bind(this,function(){this.refresh()});mxEvent.addListener(window,"orientationchange",this.orientationChangeHandler);if(mxClient.IS_IOS&&!window.navigator.standalone){this.scrollHandler=mxUtils.bind(this,function(){window.scrollTo(0,0)});mxEvent.addListener(window,"scroll",this.scrollHandler)}this.editor.addListener("resetGraphView",mxUtils.bind(this,function(){this.resetScrollbars()}));this.addListener("gridEnabledChanged",mxUtils.bind(this,function(){graph.view.validateBackground()}));this.addListener("backgroundColorChanged",mxUtils.bind(this,function(){graph.view.validateBackground()}));graph.addListener("gridSizeChanged",mxUtils.bind(this,function(){if(graph.isGridEnabled()){graph.view.validateBackground()}}));this.editor.resetGraph();this.init();this.open()};mxUtils.extend(EditorUi,mxEventSource);EditorUi.compactUi=true;EditorUi.prototype.splitSize=mxClient.IS_TOUCH||mxClient.IS_POINTER?12:8;EditorUi.prototype.menubarHeight=30;EditorUi.prototype.formatEnabled=true;EditorUi.prototype.formatWidth=240;EditorUi.prototype.toolbarHeight=34;EditorUi.prototype.footerHeight=28;EditorUi.prototype.sidebarFooterHeight=34;EditorUi.prototype.editButtonLink=null;EditorUi.prototype.hsplitPosition=screen.width<=500?116:208;EditorUi.prototype.allowAnimation=true;EditorUi.prototype.init=function(){var graph=this.editor.graph;mxEvent.addListener(graph.container,"keydown",mxUtils.bind(this,function(evt){if(evt.which==9&&graph.isEnabled()&&!mxEvent.isAltDown(evt)){if(graph.isEditing()){graph.stopEditing(false)}else{graph.selectCell(!mxEvent.isShiftDown(evt))}mxEvent.consume(evt)}}));mxEvent.addListener(graph.container,"keypress",mxUtils.bind(this,function(evt){if(this.isImmediateEditingEvent(evt)&&!graph.isEditing()&&!graph.isSelectionEmpty()&&evt.which!==0&&!mxEvent.isAltDown(evt)&&!mxEvent.isControlDown(evt)&&!mxEvent.isMetaDown(evt)){graph.escape();graph.startEditing();if(mxClient.IS_FF){var ce=graph.cellEditor;ce.textarea.innerHTML=String.fromCharCode(evt.which);var range=document.createRange();range.selectNodeContents(ce.textarea);range.collapse(false);var sel=window.getSelection();sel.removeAllRanges();sel.addRange(range)}}}));this.addUndoListener();this.addBeforeUnloadListener();graph.getSelectionModel().addListener(mxEvent.CHANGE,mxUtils.bind(this,function(){this.updateActionStates()}));graph.getModel().addListener(mxEvent.CHANGE,mxUtils.bind(this,function(){this.updateActionStates()}));var graphSetDefaultParent=graph.setDefaultParent;var ui=this;this.editor.graph.setDefaultParent=function(){graphSetDefaultParent.apply(this,arguments);ui.updateActionStates()};graph.editLink=ui.actions.get("editLink").funct;this.updateActionStates();this.initClipboard();this.initCanvas();if(this.format!=null){this.format.init()}};EditorUi.prototype.isImmediateEditingEvent=function(evt){return true};EditorUi.prototype.getCssClassForMarker=function(prefix,shape,marker,fill){var result="";if(shape=="flexArrow"){result=marker!=null&&marker!=mxConstants.NONE?"geSprite geSprite-"+prefix+"blocktrans":"geSprite geSprite-noarrow"}else{if(marker==mxConstants.ARROW_CLASSIC){result=fill=="1"?"geSprite geSprite-"+prefix+"classic":"geSprite geSprite-"+prefix+"classictrans"}else if(marker==mxConstants.ARROW_CLASSIC_THIN){result=fill=="1"?"geSprite geSprite-"+prefix+"classicthin":"geSprite geSprite-"+prefix+"classicthintrans"}else if(marker==mxConstants.ARROW_OPEN){result="geSprite geSprite-"+prefix+"open"}else if(marker==mxConstants.ARROW_OPEN_THIN){result="geSprite geSprite-"+prefix+"openthin"}else if(marker==mxConstants.ARROW_BLOCK){result=fill=="1"?"geSprite geSprite-"+prefix+"block":"geSprite geSprite-"+prefix+"blocktrans"}else if(marker==mxConstants.ARROW_BLOCK_THIN){result=fill=="1"?"geSprite geSprite-"+prefix+"blockthin":"geSprite geSprite-"+prefix+"blockthintrans"}else if(marker==mxConstants.ARROW_OVAL){result=fill=="1"?"geSprite geSprite-"+prefix+"oval":"geSprite geSprite-"+prefix+"ovaltrans"}else if(marker==mxConstants.ARROW_DIAMOND){result=fill=="1"?"geSprite geSprite-"+prefix+"diamond":"geSprite geSprite-"+prefix+"diamondtrans"}else if(marker==mxConstants.ARROW_DIAMOND_THIN){result=fill=="1"?"geSprite geSprite-"+prefix+"thindiamond":"geSprite geSprite-"+prefix+"thindiamondtrans"}else if(marker=="openAsync"){result="geSprite geSprite-"+prefix+"openasync"}else if(marker=="dash"){result="geSprite geSprite-"+prefix+"dash"}else if(marker=="cross"){result="geSprite geSprite-"+prefix+"cross"}else if(marker=="async"){result=fill=="1"?"geSprite geSprite-"+prefix+"async":"geSprite geSprite-"+prefix+"asynctrans"}else if(marker=="circle"||marker=="circlePlus"){result=fill=="1"||marker=="circle"?"geSprite geSprite-"+prefix+"circle":"geSprite geSprite-"+prefix+"circleplus"}else if(marker=="ERone"){result="geSprite geSprite-"+prefix+"erone"}else if(marker=="ERmandOne"){result="geSprite geSprite-"+prefix+"eronetoone"}else if(marker=="ERmany"){result="geSprite geSprite-"+prefix+"ermany"}else if(marker=="ERoneToMany"){result="geSprite geSprite-"+prefix+"eronetomany"}else if(marker=="ERzeroToOne"){result="geSprite geSprite-"+prefix+"eroneopt"}else if(marker=="ERzeroToMany"){result="geSprite geSprite-"+prefix+"ermanyopt"}else{result="geSprite geSprite-noarrow"}}return result};EditorUi.prototype.createMenus=function(){return new Menus(this)};EditorUi.prototype.updatePasteActionStates=function(){var graph=this.editor.graph;var paste=this.actions.get("paste");var pasteHere=this.actions.get("pasteHere");paste.setEnabled(this.editor.graph.cellEditor.isContentEditing()||!mxClipboard.isEmpty()&&graph.isEnabled()&&!graph.isCellLocked(graph.getDefaultParent()));pasteHere.setEnabled(paste.isEnabled())};EditorUi.prototype.initClipboard=function(){var ui=this;var mxClipboardCut=mxClipboard.cut;mxClipboard.cut=function(graph){if(graph.cellEditor.isContentEditing()){document.execCommand("cut",false,null)}else{mxClipboardCut.apply(this,arguments)}ui.updatePasteActionStates()};var mxClipboardCopy=mxClipboard.copy;mxClipboard.copy=function(graph){if(graph.cellEditor.isContentEditing()){document.execCommand("copy",false,null)}else{mxClipboardCopy.apply(this,arguments)}ui.updatePasteActionStates()};var mxClipboardPaste=mxClipboard.paste;mxClipboard.paste=function(graph){var result=null;if(graph.cellEditor.isContentEditing()){document.execCommand("paste",false,null)}else{result=mxClipboardPaste.apply(this,arguments)}ui.updatePasteActionStates();return result};var cellEditorStartEditing=this.editor.graph.cellEditor.startEditing;this.editor.graph.cellEditor.startEditing=function(){cellEditorStartEditing.apply(this,arguments);ui.updatePasteActionStates()};var cellEditorStopEditing=this.editor.graph.cellEditor.stopEditing;this.editor.graph.cellEditor.stopEditing=function(cell,trigger){cellEditorStopEditing.apply(this,arguments);ui.updatePasteActionStates()};this.updatePasteActionStates()};EditorUi.prototype.initCanvas=function(){var graph=this.editor.graph;var graph=this.editor.graph;graph.timerAutoScroll=true;graph.getPagePadding=function(){return new mxPoint(Math.max(0,Math.round((graph.container.offsetWidth-34)/graph.view.scale)),Math.max(0,Math.round((graph.container.offsetHeight-34)/graph.view.scale)))};graph.view.getBackgroundPageBounds=function(){var layout=this.graph.getPageLayout();var page=this.graph.getPageSize();return new mxRectangle(this.scale*(this.translate.x+layout.x*page.width),this.scale*(this.translate.y+layout.y*page.height),this.scale*layout.width*page.width,this.scale*layout.height*page.height)};graph.getPreferredPageSize=function(bounds,width,height){var pages=this.getPageLayout();var size=this.getPageSize();return new mxRectangle(0,0,pages.width*size.width,pages.height*size.height)};var resize=null;if(this.editor.chromeless){resize=mxUtils.bind(this,function(autoscale){if(graph.container!=null){var b=graph.pageVisible?graph.view.getBackgroundPageBounds():graph.getGraphBounds();var tr=graph.view.translate;var s=graph.view.scale;b=mxRectangle.fromRectangle(b);b.x=b.x/s-tr.x;b.y=b.y/s-tr.y;b.width/=s;b.height/=s;var st=graph.container.scrollTop;var sl=graph.container.scrollLeft;var sb=mxClient.IS_QUIRKS||document.documentMode>=8?20:14;if(document.documentMode==8||document.documentMode==9){sb+=3}var cw=graph.container.offsetWidth-sb;var ch=graph.container.offsetHeight-sb;var ns=autoscale?Math.max(.3,Math.min(1,cw/b.width)):s;var dx=Math.max((cw-ns*b.width)/2,0)/ns;var dy=Math.max((ch-ns*b.height)/4,0)/ns;graph.view.scaleAndTranslate(ns,dx-b.x,dy-b.y);graph.container.scrollTop=st*ns/s;graph.container.scrollLeft=sl*ns/s}});this.chromelessResize=resize;var autoscaleResize=mxUtils.bind(this,function(){resize(false)});mxEvent.addListener(window,"resize",autoscaleResize);this.destroyFunctions.push(function(){mxEvent.removeListener(window,"resize",autoscaleResize)});this.editor.addListener("resetGraphView",mxUtils.bind(this,function(){resize(true)}));this.actions.get("zoomIn").funct=function(evt){graph.zoomIn();resize(false)};this.actions.get("zoomOut").funct=function(evt){graph.zoomOut();resize(false)};this.chromelessToolbar=document.createElement("div");this.chromelessToolbar.style.position="fixed";this.chromelessToolbar.style.overflow="hidden";this.chromelessToolbar.style.boxSizing="border-box";this.chromelessToolbar.style.whiteSpace="nowrap";this.chromelessToolbar.style.backgroundColor="#000000";this.chromelessToolbar.style.padding="10px 10px 8px 10px";this.chromelessToolbar.style.left="50%";mxUtils.setPrefixedStyle(this.chromelessToolbar.style,"borderRadius","20px");mxUtils.setPrefixedStyle(this.chromelessToolbar.style,"transition","opacity 600ms ease-in-out");var updateChromelessToolbarPosition=mxUtils.bind(this,function(){var css=mxUtils.getCurrentStyle(graph.container);this.chromelessToolbar.style.bottom=(css!=null?parseInt(css["margin-bottom"]||0):0)+(this.tabContainer!=null?20+parseInt(this.tabContainer.style.height):20)+"px"});this.editor.addListener("resetGraphView",updateChromelessToolbarPosition);updateChromelessToolbarPosition();var btnCount=0;var addButton=mxUtils.bind(this,function(fn,imgSrc,tip){btnCount++;var a=document.createElement("span");a.style.paddingLeft="8px";a.style.paddingRight="8px";a.style.cursor="pointer";mxEvent.addListener(a,"click",fn);if(tip!=null){a.setAttribute("title",tip)}var img=document.createElement("img");img.setAttribute("border","0");img.setAttribute("src",imgSrc);a.appendChild(img);this.chromelessToolbar.appendChild(a);return a});var prevButton=addButton(mxUtils.bind(this,function(evt){this.actions.get("previousPage").funct();mxEvent.consume(evt)}),Editor.previousLargeImage,mxResources.get("previousPage")||"Previous Page");var pageInfo=document.createElement("div");pageInfo.style.display="inline-block";pageInfo.style.verticalAlign="top";pageInfo.style.fontFamily="Helvetica,Arial";pageInfo.style.marginTop="8px";pageInfo.style.color="#ffffff";this.chromelessToolbar.appendChild(pageInfo);var nextButton=addButton(mxUtils.bind(this,function(evt){this.actions.get("nextPage").funct();mxEvent.consume(evt)}),Editor.nextLargeImage,mxResources.get("nextPage")||"Next Page");var updatePageInfo=mxUtils.bind(this,function(){if(this.pages!=null&&this.pages.length>1&&this.currentPage!=null){pageInfo.innerHTML="";mxUtils.write(pageInfo,mxUtils.indexOf(this.pages,this.currentPage)+1+" / "+this.pages.length)}});prevButton.style.paddingLeft="0px";prevButton.style.paddingRight="4px";nextButton.style.paddingLeft="4px";nextButton.style.paddingRight="0px";var updatePageButtons=mxUtils.bind(this,function(){if(this.pages!=null&&this.pages.length>1&&this.currentPage!=null){nextButton.style.display="";prevButton.style.display="";pageInfo.style.display="inline-block"}else{nextButton.style.display="none";prevButton.style.display="none";pageInfo.style.display="none"}updatePageInfo()});this.editor.addListener("resetGraphView",updatePageButtons);this.editor.addListener("pageSelected",updatePageInfo);addButton(mxUtils.bind(this,function(evt){this.actions.get("zoomOut").funct();mxEvent.consume(evt)}),Editor.zoomOutLargeImage,(mxResources.get("zoomOut")||"Zoom Out")+" (Alt+Mousewheel)");addButton(mxUtils.bind(this,function(evt){this.actions.get("zoomIn").funct();mxEvent.consume(evt)}),Editor.zoomInLargeImage,(mxResources.get("zoomIn")||"Zoom In")+" (Alt+Mousewheel)");addButton(mxUtils.bind(this,function(evt){if(graph.lightbox){if(graph.view.scale==1){this.lightboxFit()}else{graph.zoomTo(1)}resize(false)}else{resize(true)}mxEvent.consume(evt)}),Editor.actualSizeLargeImage,mxResources.get("fit")||"Fit");var fadeThread=null;var fadeThread2=null;var fadeOut=mxUtils.bind(this,function(delay){if(fadeThread!=null){window.clearTimeout(fadeThread);fadeThead=null}if(fadeThread2!=null){window.clearTimeout(fadeThread2);fadeThead2=null}fadeThread=window.setTimeout(mxUtils.bind(this,function(){mxUtils.setOpacity(this.chromelessToolbar,0);fadeThread=null;fadeThread2=window.setTimeout(mxUtils.bind(this,function(){this.chromelessToolbar.style.display="none";fadeThread2=null}),600)}),delay||200)});var fadeIn=mxUtils.bind(this,function(opacity){if(fadeThread!=null){window.clearTimeout(fadeThread);fadeThead=null}if(fadeThread2!=null){window.clearTimeout(fadeThread2);fadeThead2=null}this.chromelessToolbar.style.display="";mxUtils.setOpacity(this.chromelessToolbar,opacity||30)});if(urlParams["layers"]=="1"){this.layersDialog=null;var layersButton=addButton(mxUtils.bind(this,function(evt){if(this.layersDialog!=null){this.layersDialog.parentNode.removeChild(this.layersDialog);this.layersDialog=null}else{this.layersDialog=graph.createLayersDialog();mxEvent.addListener(this.layersDialog,"mouseleave",mxUtils.bind(this,function(){this.layersDialog.parentNode.removeChild(this.layersDialog);this.layersDialog=null}));var r=layersButton.getBoundingClientRect();mxUtils.setPrefixedStyle(this.layersDialog.style,"borderRadius","5px");this.layersDialog.style.position="fixed";this.layersDialog.style.fontFamily="Helvetica,Arial";this.layersDialog.style.backgroundColor="#000000";this.layersDialog.style.width="160px";this.layersDialog.style.padding="4px 2px 4px 2px";this.layersDialog.style.color="#ffffff";mxUtils.setOpacity(this.layersDialog,70);this.layersDialog.style.left=r.left+"px";this.layersDialog.style.bottom=parseInt(this.chromelessToolbar.style.bottom)+this.chromelessToolbar.offsetHeight+4+"px";var style=mxUtils.getCurrentStyle(this.editor.graph.container);this.layersDialog.style.zIndex=style.zIndex;document.body.appendChild(this.layersDialog)}mxEvent.consume(evt)}),Editor.layersLargeImage,mxResources.get("layers")||"Layers");var model=graph.getModel();model.addListener(mxEvent.CHANGE,function(){layersButton.style.display=model.getChildCount(model.root)>1?"":"none"})}if(this.editor.editButtonLink!=null){addButton(mxUtils.bind(this,function(evt){if(this.editor.editButtonLink=="_blank"){this.editor.editAsNew(this.getEditBlankXml(),null,true)}else{window.open(this.editor.editButtonLink,"editWindow")}mxEvent.consume(evt)}),Editor.editLargeImage,mxResources.get("openInNewWindow")||"Open in New Window")}if(graph.lightbox&&this.container!=document.body){addButton(mxUtils.bind(this,function(evt){if(urlParams["close"]=="1"){window.close()}else{this.destroy();mxEvent.consume(evt)}}),Editor.closeLargeImage,(mxResources.get("close")||"Close")+" (Escape)")}this.chromelessToolbar.style.display="none";graph.container.appendChild(this.chromelessToolbar);this.chromelessToolbar.style.marginLeft=-(btnCount*24+10)+"px";this.addChromelessClickHandler();mxEvent.addListener(graph.container,mxClient.IS_POINTER?"pointermove":"mousemove",mxUtils.bind(this,function(evt){if(!mxEvent.isTouchEvent(evt)){if(!mxEvent.isShiftDown(evt)){fadeIn(30)}fadeOut()}}));mxEvent.addListener(this.chromelessToolbar,mxClient.IS_POINTER?"pointermove":"mousemove",function(evt){mxEvent.consume(evt)});mxEvent.addListener(this.chromelessToolbar,"mouseenter",mxUtils.bind(this,function(evt){if(!mxEvent.isShiftDown(evt)){fadeIn(100)}else{fadeOut()}}));mxEvent.addListener(this.chromelessToolbar,"mousemove",mxUtils.bind(this,function(evt){if(!mxEvent.isShiftDown(evt)){fadeIn(100)}else{fadeOut()}mxEvent.consume(evt)}));mxEvent.addListener(this.chromelessToolbar,"mouseleave",mxUtils.bind(this,function(evt){if(!mxEvent.isTouchEvent(evt)){fadeIn(30)}}));var tol=graph.getTolerance();var ui=this;graph.addMouseListener({startX:0,startY:0,scrollLeft:0,scrollTop:0,mouseDown:function(sender,me){this.startX=me.getGraphX();this.startY=me.getGraphY();this.scrollLeft=graph.container.scrollLeft;this.scrollTop=graph.container.scrollTop},mouseMove:function(sender,me){},mouseUp:function(sender,me){if(mxEvent.isTouchEvent(me.getEvent())){if(Math.abs(this.scrollLeft-graph.container.scrollLeft)<tol&&Math.abs(this.scrollTop-graph.container.scrollTop)<tol&&(Math.abs(this.startX-me.getGraphX())<tol&&Math.abs(this.startY-me.getGraphY())<tol)){if(parseFloat(ui.chromelessToolbar.style.opacity||0)>0){fadeOut()}else{fadeIn(30)}}}}})}else if(this.editor.extendCanvas){var graphViewValidate=graph.view.validate;graph.view.validate=function(){if(this.graph.container!=null&&mxUtils.hasScrollbars(this.graph.container)){var pad=this.graph.getPagePadding();var size=this.graph.getPageSize();var tx=this.translate.x;var ty=this.translate.y;this.translate.x=pad.x-(this.x0||0)*size.width;this.translate.y=pad.y-(this.y0||0)*size.height}graphViewValidate.apply(this,arguments)};var graphSizeDidChange=graph.sizeDidChange;graph.sizeDidChange=function(){if(this.container!=null&&mxUtils.hasScrollbars(this.container)){var pages=this.getPageLayout();var pad=this.getPagePadding();var size=this.getPageSize();var minw=Math.ceil(2*pad.x+pages.width*size.width);var minh=Math.ceil(2*pad.y+pages.height*size.height);var min=graph.minimumGraphSize;if(min==null||min.width!=minw||min.height!=minh){graph.minimumGraphSize=new mxRectangle(0,0,minw,minh)}var dx=pad.x-pages.x*size.width;var dy=pad.y-pages.y*size.height;if(!this.autoTranslate&&(this.view.translate.x!=dx||this.view.translate.y!=dy)){this.autoTranslate=true;this.view.x0=pages.x;this.view.y0=pages.y;var tx=graph.view.translate.x;var ty=graph.view.translate.y;graph.view.setTranslate(dx,dy);graph.container.scrollLeft+=Math.round((dx-tx)*graph.view.scale);graph.container.scrollTop+=Math.round((dy-ty)*graph.view.scale);this.autoTranslate=false;return}graphSizeDidChange.apply(this,arguments)}}}graph.updateZoomTimeout=null;graph.cumulativeZoomFactor=1;var cursorPosition=null;graph.lazyZoom=function(zoomIn){if(this.updateZoomTimeout!=null){window.clearTimeout(this.updateZoomTimeout)}if(zoomIn){if(this.view.scale*this.cumulativeZoomFactor<.15){this.cumulativeZoomFactor=(this.view.scale+.01)/this.view.scale}else{this.cumulativeZoomFactor*=this.zoomFactor;this.cumulativeZoomFactor=Math.round(this.view.scale*this.cumulativeZoomFactor*20)/20/this.view.scale}}else{if(this.view.scale*this.cumulativeZoomFactor<=.15){this.cumulativeZoomFactor=(this.view.scale-.01)/this.view.scale}else{this.cumulativeZoomFactor/=this.zoomFactor;this.cumulativeZoomFactor=Math.round(this.view.scale*this.cumulativeZoomFactor*20)/20/this.view.scale}}this.cumulativeZoomFactor=Math.max(.01,Math.min(this.view.scale*this.cumulativeZoomFactor,160)/this.view.scale);this.updateZoomTimeout=window.setTimeout(mxUtils.bind(this,function(){this.zoom(this.cumulativeZoomFactor);if(resize!=null){resize(false)}if(cursorPosition!=null&&mxUtils.hasScrollbars(graph.container)){var offset=mxUtils.getOffset(graph.container);var dx=graph.container.offsetWidth/2-cursorPosition.x+offset.x;var dy=graph.container.offsetHeight/2-cursorPosition.y+offset.y;graph.container.scrollLeft-=dx*(this.cumulativeZoomFactor-1);graph.container.scrollTop-=dy*(this.cumulativeZoomFactor-1)}this.cumulativeZoomFactor=1;this.updateZoomTimeout=null}),20)};mxEvent.addMouseWheelListener(mxUtils.bind(this,function(evt,up){if((mxEvent.isAltDown(evt)||mxEvent.isControlDown(evt)&&!mxClient.IS_MAC||graph.panningHandler.isActive())&&(this.dialogs==null||this.dialogs.length==0)){var source=mxEvent.getSource(evt);while(source!=null){if(source==graph.container){cursorPosition=new mxPoint(mxEvent.getClientX(evt),mxEvent.getClientY(evt));graph.lazyZoom(up);mxEvent.consume(evt);return}source=source.parentNode}}}))};EditorUi.prototype.createTemporaryGraph=function(stylesheet){var graph=new Graph(document.createElement("div"),null,null,stylesheet);graph.resetViewOnRootChange=false;graph.setConnectable(false);graph.gridEnabled=false;graph.autoScroll=false;graph.setTooltips(false);graph.setEnabled(false);graph.container.style.visibility="hidden";graph.container.style.position="absolute";graph.container.style.overflow="hidden";graph.container.style.height="1px";graph.container.style.width="1px";return graph};EditorUi.prototype.addChromelessClickHandler=function(){var hl=urlParams["highlight"];if(hl!=null&&hl.length>0){hl="#"+hl}this.editor.graph.addClickHandler(hl)};EditorUi.prototype.toggleFormatPanel=function(forceHide){this.formatWidth=forceHide||this.formatWidth>0?0:240;this.formatContainer.style.display=forceHide||this.formatWidth>0?"":"none";this.refresh();this.format.refresh();this.fireEvent(new mxEventObject("formatWidthChanged"))};EditorUi.prototype.lightboxFit=function(){this.editor.graph.maxFitScale=2;this.editor.graph.fit(60);this.editor.graph.maxFitScale=null};EditorUi.prototype.isSelectionAllowed=function(evt){return mxEvent.getSource(evt).nodeName=="SELECT"||mxEvent.getSource(evt).nodeName=="INPUT"&&mxUtils.isAncestorNode(this.formatContainer,mxEvent.getSource(evt))};EditorUi.prototype.addBeforeUnloadListener=function(){window.onbeforeunload=mxUtils.bind(this,function(){if(!this.editor.chromeless){return this.onBeforeUnload()}})};EditorUi.prototype.onBeforeUnload=function(){if(this.editor.modified){return mxResources.get("allChangesLost")}};EditorUi.prototype.open=function(){try{if(window.opener!=null&&window.opener.openFile!=null){window.opener.openFile.setConsumer(mxUtils.bind(this,function(xml,filename){try{var doc=mxUtils.parseXml(xml);this.editor.setGraphXml(doc.documentElement);this.editor.setModified(false);this.editor.undoManager.clear();if(filename!=null){this.editor.setFilename(filename);this.updateDocumentTitle()}return}catch(e){mxUtils.alert(mxResources.get("invalidOrMissingFile")+": "+e.message)}}))}}catch(e){}this.editor.graph.view.validate();this.editor.graph.sizeDidChange();this.editor.fireEvent(new mxEventObject("resetGraphView"))};EditorUi.prototype.setCurrentMenu=function(menu,elt){this.currentMenuElt=elt;this.currentMenu=menu};EditorUi.prototype.resetCurrentMenu=function(){this.currentMenuElt=null;this.currentMenu=null};EditorUi.prototype.hideCurrentMenu=function(menu,elt){if(this.currentMenu!=null){this.currentMenu.hideMenu();this.resetCurrentMenu()}};EditorUi.prototype.updateDocumentTitle=function(){var title=this.editor.getOrCreateFilename();if(this.editor.appName!=null){title+=" - "+this.editor.appName}document.title=title};EditorUi.prototype.createHoverIcons=function(){return new HoverIcons(this.editor.graph)};EditorUi.prototype.redo=function(){try{var graph=this.editor.graph;if(graph.isEditing()){document.execCommand("redo",false,null)}else{this.editor.undoManager.redo()}}catch(e){}};EditorUi.prototype.undo=function(){try{var graph=this.editor.graph;if(graph.isEditing()){var value=graph.cellEditor.textarea.innerHTML;document.execCommand("undo",false,null);if(value==graph.cellEditor.textarea.innerHTML){graph.stopEditing(true);this.editor.undoManager.undo()}}else{this.editor.undoManager.undo()}}catch(e){}};EditorUi.prototype.canRedo=function(){return this.editor.graph.isEditing()||this.editor.undoManager.canRedo()};EditorUi.prototype.canUndo=function(){return this.editor.graph.isEditing()||this.editor.undoManager.canUndo()};EditorUi.prototype.getEditBlankXml=function(){return mxUtils.getXml(this.getGraphXml())};EditorUi.prototype.getUrl=function(pathname){var href=pathname!=null?pathname:window.location.pathname;var parms=href.indexOf("?")>0?1:0;for(var key in urlParams){if(parms==0){href+="?"}else{href+="&"}href+=key+"="+urlParams[key];parms++}return href};EditorUi.prototype.setScrollbars=function(value){var graph=this.editor.graph;var prev=graph.container.style.overflow;graph.scrollbars=value;this.editor.updateGraphComponents();if(prev!=graph.container.style.overflow){if(graph.container.style.overflow=="hidden"){var t=graph.view.translate;graph.view.setTranslate(t.x-graph.container.scrollLeft/graph.view.scale,t.y-graph.container.scrollTop/graph.view.scale);graph.container.scrollLeft=0;graph.container.scrollTop=0;graph.minimumGraphSize=null;graph.sizeDidChange()}else{var dx=graph.view.translate.x;var dy=graph.view.translate.y;graph.view.translate.x=0;graph.view.translate.y=0;graph.sizeDidChange();graph.container.scrollLeft-=Math.round(dx*graph.view.scale);graph.container.scrollTop-=Math.round(dy*graph.view.scale)}}this.fireEvent(new mxEventObject("scrollbarsChanged"))};EditorUi.prototype.hasScrollbars=function(){return this.editor.graph.scrollbars};EditorUi.prototype.resetScrollbars=function(){var graph=this.editor.graph;if(!this.editor.extendCanvas){graph.container.scrollTop=0;graph.container.scrollLeft=0;if(!mxUtils.hasScrollbars(graph.container)){graph.view.setTranslate(0,0)}}else if(!this.editor.chromeless){if(mxUtils.hasScrollbars(graph.container)){if(graph.pageVisible){var pad=graph.getPagePadding();graph.container.scrollTop=Math.floor(pad.y-this.editor.initialTopSpacing);graph.container.scrollLeft=Math.floor(Math.min(pad.x,(graph.container.scrollWidth-graph.container.clientWidth)/2));var bounds=graph.getGraphBounds();if(bounds.width>0&&bounds.height>0){if(bounds.x>graph.container.scrollLeft+graph.container.clientWidth*.9){graph.container.scrollLeft=Math.min(bounds.x+bounds.width-graph.container.clientWidth,bounds.x-10)}if(bounds.y>graph.container.scrollTop+graph.container.clientHeight*.9){graph.container.scrollTop=Math.min(bounds.y+bounds.height-graph.container.clientHeight,bounds.y-10)}}}else{var bounds=graph.getGraphBounds();var width=Math.max(bounds.width,graph.scrollTileSize.width*graph.view.scale);var height=Math.max(bounds.height,graph.scrollTileSize.height*graph.view.scale);graph.container.scrollTop=Math.floor(Math.max(0,bounds.y-Math.max(20,(graph.container.clientHeight-height)/4)));graph.container.scrollLeft=Math.floor(Math.max(0,bounds.x-Math.max(0,(graph.container.clientWidth-width)/2)))}}else{if(graph.pageVisible){var b=graph.view.getBackgroundPageBounds();graph.view.setTranslate(Math.floor(Math.max(0,(graph.container.clientWidth-b.width)/2)-b.x),Math.floor(Math.max(0,(graph.container.clientHeight-b.height)/2)-b.y))}else{var bounds=graph.getGraphBounds();graph.view.setTranslate(Math.floor(Math.max(0,Math.max(0,(graph.container.clientWidth-bounds.width)/2)-bounds.x)),Math.floor(Math.max(0,Math.max(20,(graph.container.clientHeight-bounds.height)/4))-bounds.y))}}}};EditorUi.prototype.setPageVisible=function(value){var graph=this.editor.graph;var hasScrollbars=mxUtils.hasScrollbars(graph.container);var tx=0;var ty=0;if(hasScrollbars){tx=graph.view.translate.x*graph.view.scale-graph.container.scrollLeft;ty=graph.view.translate.y*graph.view.scale-graph.container.scrollTop}graph.pageVisible=value;graph.pageBreaksVisible=value;graph.preferPageSize=value;graph.view.validateBackground();if(hasScrollbars){var cells=graph.getSelectionCells();graph.clearSelection();graph.setSelectionCells(cells)}graph.sizeDidChange();if(hasScrollbars){graph.container.scrollLeft=graph.view.translate.x*graph.view.scale-tx;graph.container.scrollTop=graph.view.translate.y*graph.view.scale-ty}this.fireEvent(new mxEventObject("pageViewChanged"))};EditorUi.prototype.setBackgroundColor=function(value){this.editor.graph.background=value;this.editor.graph.view.validateBackground();this.fireEvent(new mxEventObject("backgroundColorChanged"))};EditorUi.prototype.setFoldingEnabled=function(value){this.editor.graph.foldingEnabled=value;this.editor.graph.view.revalidate();this.fireEvent(new mxEventObject("foldingEnabledChanged"))};EditorUi.prototype.setPageFormat=function(value){this.editor.graph.pageFormat=value;if(!this.editor.graph.pageVisible){this.actions.get("pageView").funct()}else{this.editor.graph.view.validateBackground();this.editor.graph.sizeDidChange()}this.fireEvent(new mxEventObject("pageFormatChanged"))};EditorUi.prototype.setPageScale=function(value){this.editor.graph.pageScale=value;if(!this.editor.graph.pageVisible){this.actions.get("pageView").funct()}else{this.editor.graph.view.validateBackground();this.editor.graph.sizeDidChange()}this.fireEvent(new mxEventObject("pageScaleChanged"))};EditorUi.prototype.setGridColor=function(value){this.editor.graph.view.gridColor=value;this.editor.graph.view.validateBackground();this.fireEvent(new mxEventObject("gridColorChanged"))};EditorUi.prototype.addUndoListener=function(){var undo=this.actions.get("undo");var redo=this.actions.get("redo");var undoMgr=this.editor.undoManager;var undoListener=mxUtils.bind(this,function(){undo.setEnabled(this.canUndo());redo.setEnabled(this.canRedo())});undoMgr.addListener(mxEvent.ADD,undoListener);undoMgr.addListener(mxEvent.UNDO,undoListener);undoMgr.addListener(mxEvent.REDO,undoListener);undoMgr.addListener(mxEvent.CLEAR,undoListener);var cellEditorStartEditing=this.editor.graph.cellEditor.startEditing;this.editor.graph.cellEditor.startEditing=function(){cellEditorStartEditing.apply(this,arguments);undoListener()};var cellEditorStopEditing=this.editor.graph.cellEditor.stopEditing;this.editor.graph.cellEditor.stopEditing=function(cell,trigger){cellEditorStopEditing.apply(this,arguments);undoListener()};undoListener()};EditorUi.prototype.updateActionStates=function(){var graph=this.editor.graph;var selected=!graph.isSelectionEmpty();var vertexSelected=false;var edgeSelected=false;var cells=graph.getSelectionCells();if(cells!=null){for(var i=0;i<cells.length;i++){var cell=cells[i];if(graph.getModel().isEdge(cell)){edgeSelected=true}if(graph.getModel().isVertex(cell)){vertexSelected=true}if(edgeSelected&&vertexSelected){break}}}var actions=["cut","copy","bold","italic","underline","delete","duplicate","editStyle","editTooltip","editLink","backgroundColor","borderColor","edit","toFront","toBack","lockUnlock","solid","dashed","dotted","fillColor","gradientColor","shadow","fontColor","formattedText","rounded","toggleRounded","sharp","strokeColor"];for(var i=0;i<actions.length;i++){this.actions.get(actions[i]).setEnabled(selected)}this.actions.get("setAsDefaultStyle").setEnabled(graph.getSelectionCount()==1);this.actions.get("turn").setEnabled(!graph.isSelectionEmpty());this.actions.get("curved").setEnabled(edgeSelected);this.actions.get("clearWaypoints").setEnabled(edgeSelected);this.actions.get("rotation").setEnabled(vertexSelected);this.actions.get("wordWrap").setEnabled(vertexSelected);this.actions.get("autosize").setEnabled(vertexSelected);this.actions.get("collapsible").setEnabled(vertexSelected);var oneVertexSelected=vertexSelected&&graph.getSelectionCount()==1;this.actions.get("group").setEnabled(graph.getSelectionCount()>1||oneVertexSelected&&!graph.isContainer(graph.getSelectionCell()));this.actions.get("ungroup").setEnabled(graph.getSelectionCount()==1&&(graph.getModel().getChildCount(graph.getSelectionCell())>0||oneVertexSelected&&graph.isContainer(graph.getSelectionCell())));this.actions.get("removeFromGroup").setEnabled(oneVertexSelected&&graph.getModel().isVertex(graph.getModel().getParent(graph.getSelectionCell())));var state=graph.view.getState(graph.getSelectionCell());this.menus.get("navigation").setEnabled(selected||graph.view.currentRoot!=null);this.actions.get("collapsible").setEnabled(vertexSelected&&graph.getSelectionCount()==1&&(graph.isContainer(graph.getSelectionCell())||graph.model.getChildCount(graph.getSelectionCell())>0));this.actions.get("home").setEnabled(graph.view.currentRoot!=null);this.actions.get("exitGroup").setEnabled(graph.view.currentRoot!=null);this.actions.get("enterGroup").setEnabled(graph.getSelectionCount()==1&&graph.isValidRoot(graph.getSelectionCell()));var foldable=graph.getSelectionCount()==1&&graph.isCellFoldable(graph.getSelectionCell());this.actions.get("expand").setEnabled(foldable);this.actions.get("collapse").setEnabled(foldable);this.actions.get("editLink").setEnabled(graph.getSelectionCount()==1);this.actions.get("openLink").setEnabled(graph.getSelectionCount()==1&&graph.getLinkForCell(graph.getSelectionCell())!=null);this.actions.get("guides").setEnabled(graph.isEnabled());this.actions.get("grid").setEnabled(!this.editor.chromeless);var unlocked=graph.isEnabled()&&!graph.isCellLocked(graph.getDefaultParent());this.menus.get("layout").setEnabled(unlocked);this.menus.get("insert").setEnabled(unlocked);this.menus.get("direction").setEnabled(unlocked&&vertexSelected);this.menus.get("align").setEnabled(unlocked&&vertexSelected&&graph.getSelectionCount()>1);this.menus.get("distribute").setEnabled(unlocked&&vertexSelected&&graph.getSelectionCount()>1);this.actions.get("selectVertices").setEnabled(unlocked);this.actions.get("selectEdges").setEnabled(unlocked);this.actions.get("selectAll").setEnabled(unlocked);this.actions.get("selectNone").setEnabled(unlocked);this.updatePasteActionStates()};EditorUi.prototype.refresh=function(sizeDidChange){sizeDidChange=sizeDidChange!=null?sizeDidChange:true;var quirks=mxClient.IS_IE&&(document.documentMode==null||document.documentMode==5);var w=this.container.clientWidth;var h=this.container.clientHeight;if(this.container==document.body){w=document.body.clientWidth||document.documentElement.clientWidth;h=quirks?document.body.clientHeight||document.documentElement.clientHeight:document.documentElement.clientHeight}var off=0;if(mxClient.IS_IOS&&!window.navigator.standalone){if(window.innerHeight!=document.documentElement.clientHeight){off=document.documentElement.clientHeight-window.innerHeight;window.scrollTo(0,0)}}var effHsplitPosition=Math.max(0,Math.min(this.hsplitPosition,w-this.splitSize-20));var tmp=0;if(this.menubar!=null){this.menubarContainer.style.height=this.menubarHeight+"px";tmp+=this.menubarHeight}if(this.toolbar!=null){this.toolbarContainer.style.top=this.menubarHeight+"px";this.toolbarContainer.style.height=this.toolbarHeight+"px";tmp+=this.toolbarHeight}if(tmp>0&&!mxClient.IS_QUIRKS){tmp+=1}var sidebarFooterHeight=0;if(this.sidebarFooterContainer!=null){var bottom=this.footerHeight+off;sidebarFooterHeight=Math.max(0,Math.min(h-tmp-bottom,this.sidebarFooterHeight));this.sidebarFooterContainer.style.width=effHsplitPosition+"px";this.sidebarFooterContainer.style.height=sidebarFooterHeight+"px";this.sidebarFooterContainer.style.bottom=bottom+"px"}var fw=this.format!=null?this.formatWidth:0;this.sidebarContainer.style.top=tmp+"px";this.sidebarContainer.style.width=effHsplitPosition+"px";this.formatContainer.style.top=tmp+"px";this.formatContainer.style.width=fw+"px";this.formatContainer.style.display=this.format!=null?"":"none";this.diagramContainer.style.left=this.hsplit.parentNode!=null?effHsplitPosition+this.splitSize+"px":"0px";this.diagramContainer.style.top=this.sidebarContainer.style.top;this.footerContainer.style.height=this.footerHeight+"px";this.hsplit.style.top=this.sidebarContainer.style.top;this.hsplit.style.bottom=this.footerHeight+off+"px";this.hsplit.style.left=effHsplitPosition+"px";if(this.tabContainer!=null){this.tabContainer.style.left=this.diagramContainer.style.left}if(quirks){this.menubarContainer.style.width=w+"px";this.toolbarContainer.style.width=this.menubarContainer.style.width;var sidebarHeight=Math.max(0,h-this.footerHeight-this.menubarHeight-this.toolbarHeight);this.sidebarContainer.style.height=sidebarHeight-sidebarFooterHeight+"px";this.formatContainer.style.height=sidebarHeight+"px";this.diagramContainer.style.width=this.hsplit.parentNode!=null?Math.max(0,w-effHsplitPosition-this.splitSize-fw)+"px":w+"px";this.footerContainer.style.width=this.menubarContainer.style.width;var diagramHeight=Math.max(0,h-this.footerHeight-this.menubarHeight-this.toolbarHeight);if(this.tabContainer!=null){this.tabContainer.style.width=this.diagramContainer.style.width;this.tabContainer.style.bottom=this.footerHeight+off+"px";diagramHeight-=this.tabContainer.clientHeight}this.diagramContainer.style.height=diagramHeight+"px";this.hsplit.style.height=diagramHeight+"px"}else{if(this.footerHeight>0){this.footerContainer.style.bottom=off+"px"}this.diagramContainer.style.right=fw+"px";var th=0;if(this.tabContainer!=null){this.tabContainer.style.bottom=this.footerHeight+off+"px";this.tabContainer.style.right=this.diagramContainer.style.right;th=this.tabContainer.clientHeight}this.sidebarContainer.style.bottom=this.footerHeight+sidebarFooterHeight+off+"px";this.formatContainer.style.bottom=this.footerHeight+off+"px";this.diagramContainer.style.bottom=this.footerHeight+off+th+"px"}if(sizeDidChange){this.editor.graph.sizeDidChange()}};EditorUi.prototype.createTabContainer=function(){return null};EditorUi.prototype.createDivs=function(){this.menubarContainer=this.createDiv("geMenubarContainer");this.toolbarContainer=this.createDiv("geToolbarContainer");this.sidebarContainer=this.createDiv("geSidebarContainer");this.formatContainer=this.createDiv("geSidebarContainer");this.diagramContainer=this.createDiv("geDiagramContainer");this.footerContainer=this.createDiv("geFooterContainer");this.hsplit=this.createDiv("geHsplit");this.hsplit.setAttribute("title",mxResources.get("collapseExpand"));this.menubarContainer.style.top="0px";this.menubarContainer.style.left="0px";this.menubarContainer.style.right="0px";this.toolbarContainer.style.left="0px";this.toolbarContainer.style.right="0px";this.sidebarContainer.style.left="0px";this.formatContainer.style.right="0px";this.formatContainer.style.zIndex="1";this.diagramContainer.style.right=(this.format!=null?this.formatWidth:0)+"px";this.footerContainer.style.left="0px";this.footerContainer.style.right="0px";this.footerContainer.style.bottom="0px";this.footerContainer.style.zIndex=mxPopupMenu.prototype.zIndex-2;this.hsplit.style.width=this.splitSize+"px";this.formatContainer.style.backgroundColor="whiteSmoke";this.formatContainer.style.overflowX="hidden";this.formatContainer.style.overflowY="auto";this.formatContainer.style.fontSize="12px";this.sidebarFooterContainer=this.createSidebarFooterContainer();if(this.sidebarFooterContainer){this.sidebarFooterContainer.style.left="0px"}if(!this.editor.chromeless){this.tabContainer=this.createTabContainer()}};EditorUi.prototype.createSidebarFooterContainer=function(){return null};EditorUi.prototype.createUi=function(){this.menubar=this.editor.chromeless?null:this.menus.createMenubar(this.createDiv("geMenubar"));if(this.menubar!=null){this.menubarContainer.appendChild(this.menubar.container)}if(this.menubar!=null){this.statusContainer=this.createStatusContainer();this.editor.addListener("statusChanged",mxUtils.bind(this,function(){this.setStatusText(this.editor.getStatus())}));this.setStatusText(this.editor.getStatus());this.menubar.container.appendChild(this.statusContainer);this.container.appendChild(this.menubarContainer)}this.sidebar=this.editor.chromeless?null:this.createSidebar(this.sidebarContainer);if(this.sidebar!=null){this.container.appendChild(this.sidebarContainer)}this.format=this.editor.chromeless||!this.formatEnabled?null:this.createFormat(this.formatContainer);if(this.format!=null){this.container.appendChild(this.formatContainer)}var footer=this.editor.chromeless?null:this.createFooter();if(footer!=null){this.footerContainer.appendChild(footer);this.container.appendChild(this.footerContainer)}if(this.sidebar!=null&&this.sidebarFooterContainer){this.container.appendChild(this.sidebarFooterContainer)}this.container.appendChild(this.diagramContainer);if(this.container!=null&&this.tabContainer!=null){this.container.appendChild(this.tabContainer)}this.toolbar=this.editor.chromeless?null:this.createToolbar(this.createDiv("geToolbar"));if(this.toolbar!=null){this.toolbarContainer.appendChild(this.toolbar.container);this.container.appendChild(this.toolbarContainer)}if(this.sidebar!=null){this.container.appendChild(this.hsplit);this.addSplitHandler(this.hsplit,true,0,mxUtils.bind(this,function(value){this.hsplitPosition=value;this.refresh()}))}};EditorUi.prototype.createStatusContainer=function(){var container=document.createElement("a");container.className="geItem geStatus";return container};EditorUi.prototype.setStatusText=function(value){this.statusContainer.innerHTML=value};EditorUi.prototype.createToolbar=function(container){return new Toolbar(this,container)};EditorUi.prototype.createSidebar=function(container){return new Sidebar(this,container)};EditorUi.prototype.createFormat=function(container){return new Format(this,container)};EditorUi.prototype.createFooter=function(){return this.createDiv("geFooter")};EditorUi.prototype.createDiv=function(classname){var elt=document.createElement("div");elt.className=classname;return elt};EditorUi.prototype.addSplitHandler=function(elt,horizontal,dx,onChange){var start=null;var initial=null;var ignoreClick=true;var last=null;if(mxClient.IS_POINTER){elt.style.touchAction="none"}var getValue=mxUtils.bind(this,function(){var result=parseInt(horizontal?elt.style.left:elt.style.bottom);if(!horizontal){result=result+dx-this.footerHeight}return result});function moveHandler(evt){if(start!=null){var pt=new mxPoint(mxEvent.getClientX(evt),mxEvent.getClientY(evt));onChange(Math.max(0,initial+(horizontal?pt.x-start.x:start.y-pt.y)-dx));mxEvent.consume(evt);if(initial!=getValue()){ignoreClick=true;last=null}}}function dropHandler(evt){moveHandler(evt);initial=null;start=null}mxEvent.addGestureListeners(elt,function(evt){start=new mxPoint(mxEvent.getClientX(evt),mxEvent.getClientY(evt));initial=getValue();ignoreClick=false;mxEvent.consume(evt)});mxEvent.addListener(elt,"click",function(evt){if(!ignoreClick){var next=last!=null?last-dx:0;last=getValue();onChange(next);mxEvent.consume(evt)}});mxEvent.addGestureListeners(document,null,moveHandler,dropHandler);this.destroyFunctions.push(function(){mxEvent.removeGestureListeners(document,null,moveHandler,dropHandler)})};EditorUi.prototype.showDialog=function(elt,w,h,modal,closable,onClose){this.editor.graph.tooltipHandler.hideTooltip();if(this.dialogs==null){this.dialogs=[]}this.dialog=new Dialog(this,elt,w,h,modal,closable,onClose);this.dialogs.push(this.dialog)};EditorUi.prototype.hideDialog=function(cancel){if(this.dialogs!=null&&this.dialogs.length>0){var dlg=this.dialogs.pop();dlg.close(cancel);this.dialog=this.dialogs.length>0?this.dialogs[this.dialogs.length-1]:null;if(this.dialog==null&&this.editor.graph.container.style.visibility!="hidden"){this.editor.graph.container.focus()}this.editor.fireEvent(new mxEventObject("hideDialog"))}};EditorUi.prototype.pickColor=function(color,apply){var graph=this.editor.graph;var selState=graph.cellEditor.saveSelection();var dlg=new ColorDialog(this,color||"none",function(color){graph.cellEditor.restoreSelection(selState);apply(color)},function(){graph.cellEditor.restoreSelection(selState)});this.showDialog(dlg.container,220,430,true,false);dlg.init()};EditorUi.prototype.openFile=function(){window.openFile=new OpenFile(mxUtils.bind(this,function(cancel){this.hideDialog(cancel)}));this.showDialog(new OpenDialog(this).container,Editor.useLocalStorage?640:320,Editor.useLocalStorage?480:220,true,true,function(){window.openFile=null})};EditorUi.prototype.extractGraphModelFromHtml=function(data){var result=null;try{var idx=data.indexOf("&lt;mxGraphModel ");if(idx>=0){var idx2=data.lastIndexOf("&lt;/mxGraphModel&gt;");if(idx2>idx){result=data.substring(idx,idx2+21).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/\\&quot;/g,'"').replace(/\n/g,"")}}}catch(e){}return result};EditorUi.prototype.extractGraphModelFromEvent=function(evt){var result=null;var data=null;if(evt!=null){var provider=evt.dataTransfer!=null?evt.dataTransfer:evt.clipboardData;if(provider!=null){if(document.documentMode==10||document.documentMode==11){data=provider.getData("Text")}else{data=mxUtils.indexOf(provider.types,"text/html")>=0?provider.getData("text/html"):null;if(mxUtils.indexOf(provider.types,"text/plain"&&(data==null||data.length==0))){data=provider.getData("text/plain")}}if(data!=null){data=this.editor.graph.zapGremlins(mxUtils.trim(data));var xml=this.extractGraphModelFromHtml(data);if(xml!=null){data=xml}}}}if(data!=null&&this.isCompatibleString(data)){result=data}return result};EditorUi.prototype.isCompatibleString=function(data){return false};EditorUi.prototype.executeLayout=function(exec,animate,post){var graph=this.editor.graph;if(graph.isEnabled()){graph.getModel().beginUpdate();try{exec()}catch(e){throw e}finally{if(this.allowAnimation&&animate&&navigator.userAgent.indexOf("Camino")<0){var morph=new mxMorphing(graph);morph.addListener(mxEvent.DONE,mxUtils.bind(this,function(){graph.getModel().endUpdate();if(post!=null){post()}}));morph.startAnimation()}else{graph.getModel().endUpdate();if(post!=null){post()}}}}};EditorUi.prototype.showImageDialog=function(title,value,fn,ignoreExisting){var cellEditor=this.editor.graph.cellEditor;var selState=cellEditor.saveSelection();var newValue=mxUtils.prompt(title,value);cellEditor.restoreSelection(selState);if(newValue!=null&&newValue.length>0){var img=new Image;img.onload=function(){fn(newValue,img.width,img.height)};img.onerror=function(){fn(null);mxUtils.alert(mxResources.get("fileNotFound"))};img.src=newValue}else{fn(null)}};EditorUi.prototype.showLinkDialog=function(value,btnLabel,fn){var dlg=new LinkDialog(this,value,btnLabel,fn);this.showDialog(dlg.container,420,90,true,true);dlg.init()};EditorUi.prototype.showBackgroundImageDialog=function(apply){apply=apply!=null?apply:mxUtils.bind(this,function(image){this.setBackgroundImage(image)});var newValue=mxUtils.prompt(mxResources.get("backgroundImage"),"");if(newValue!=null&&newValue.length>0){var img=new Image;img.onload=function(){apply(new mxImage(newValue,img.width,img.height))};img.onerror=function(){apply(null);mxUtils.alert(mxResources.get("fileNotFound"))};img.src=newValue}else{apply(null)}};EditorUi.prototype.setBackgroundImage=function(image){this.editor.graph.setBackgroundImage(image);this.editor.graph.view.validateBackgroundImage();this.fireEvent(new mxEventObject("backgroundImageChanged"))};EditorUi.prototype.confirm=function(msg,okFn,cancelFn){if(mxUtils.confirm(msg)){if(okFn!=null){okFn()}}else if(cancelFn!=null){cancelFn()}};EditorUi.prototype.createOutline=function(wnd){var outline=new mxOutline(this.editor.graph);outline.border=20;mxEvent.addListener(window,"resize",function(){outline.update()});this.addListener("pageFormatChanged",function(){outline.update()});return outline};EditorUi.prototype.createKeyHandler=function(editor){var editorUi=this;var graph=this.editor.graph;var keyHandler=new mxKeyHandler(graph);var isEventIgnored=keyHandler.isEventIgnored;keyHandler.isEventIgnored=function(evt){return(!this.isControlDown(evt)||mxEvent.isShiftDown(evt)||evt.keyCode!=90&&evt.keyCode!=89&&evt.keyCode!=188&&evt.keyCode!=190&&evt.keyCode!=85)&&(evt.keyCode!=66&&evt.keyCode!=73||!this.isControlDown(evt)||this.graph.cellEditor.isContentEditing()&&!mxClient.IS_FF&&!mxClient.IS_SF)&&isEventIgnored.apply(this,arguments)};keyHandler.isEnabledForEvent=function(evt){return!mxEvent.isConsumed(evt)&&this.isGraphEvent(evt)&&this.isEnabled()};keyHandler.isControlDown=function(evt){return mxEvent.isControlDown(evt)||mxClient.IS_MAC&&evt.metaKey};var queue=[];var thread=null;function nudge(keyCode,stepSize,resize){queue.push(function(){if(!graph.isSelectionEmpty()&&graph.isEnabled()){stepSize=stepSize!=null?stepSize:1;if(resize){graph.getModel().beginUpdate();try{var cells=graph.getSelectionCells();for(var i=0;i<cells.length;i++){if(graph.getModel().isVertex(cells[i])&&graph.isCellResizable(cells[i])){var geo=graph.getCellGeometry(cells[i]);if(geo!=null){geo=geo.clone();if(keyCode==37){geo.width=Math.max(0,geo.width-stepSize)}else if(keyCode==38){geo.height=Math.max(0,geo.height-stepSize)}else if(keyCode==39){geo.width+=stepSize}else if(keyCode==40){geo.height+=stepSize}graph.getModel().setGeometry(cells[i],geo)}}}}finally{graph.getModel().endUpdate()}}else{var cell=graph.getSelectionCell();var parent=graph.model.getParent(cell);var layout=null;if(graph.getSelectionCount()==1&&graph.model.isVertex(cell)&&graph.layoutManager!=null&&!graph.isCellLocked(cell)){layout=graph.layoutManager.getLayout(parent)}if(layout!=null&&layout.constructor==mxStackLayout){var index=parent.getIndex(cell);if(keyCode==37||keyCode==38){graph.model.add(parent,cell,Math.max(0,index-1))}else if(keyCode==39||keyCode==40){graph.model.add(parent,cell,Math.min(graph.model.getChildCount(parent),index+1))}}else{var dx=0;var dy=0;if(keyCode==37){dx=-stepSize}else if(keyCode==38){dy=-stepSize}else if(keyCode==39){dx=stepSize}else if(keyCode==40){dy=stepSize}graph.moveCells(graph.getMovableCells(graph.getSelectionCells()),dx,dy)}}}});if(thread!=null){window.clearTimeout(thread)}thread=window.setTimeout(function(){if(queue.length>0){graph.getModel().beginUpdate();try{for(var i=0;i<queue.length;i++){queue[i]()}queue=[]}finally{graph.getModel().endUpdate()}graph.scrollCellToVisible(graph.getSelectionCell())}},200)}var directions={37:mxConstants.DIRECTION_WEST,38:mxConstants.DIRECTION_NORTH,39:mxConstants.DIRECTION_EAST,40:mxConstants.DIRECTION_SOUTH};var keyHandlerGetFunction=keyHandler.getFunction;mxKeyHandler.prototype.getFunction=function(evt){if(graph.isEnabled()){if(evt.keyCode==9&&mxEvent.isAltDown(evt)){if(mxEvent.isShiftDown(evt)){return function(){graph.selectParentCell()}}else{return function(){graph.selectChildCell()}}}else if(directions[evt.keyCode]!=null&&!graph.isSelectionEmpty()){if(mxEvent.isShiftDown(evt)&&mxEvent.isAltDown(evt)){if(graph.model.isVertex(graph.getSelectionCell())){return function(){var cells=graph.connectVertex(graph.getSelectionCell(),directions[evt.keyCode],graph.defaultEdgeLength,evt,true);if(cells!=null&&cells.length>0){if(cells.length==1&&graph.model.isEdge(cells[0])){graph.setSelectionCell(graph.model.getTerminal(cells[0],false))}else{graph.setSelectionCell(cells[cells.length-1])}if(editorUi.hoverIcons!=null){editorUi.hoverIcons.update(graph.view.getState(graph.getSelectionCell()))}}}}}else{if(this.isControlDown(evt)){return function(){nudge(evt.keyCode,mxEvent.isShiftDown(evt)?graph.gridSize:null,true)}}else{return function(){nudge(evt.keyCode,mxEvent.isShiftDown(evt)?graph.gridSize:null)}}}}}return keyHandlerGetFunction.apply(this,arguments)};keyHandler.bindAction=mxUtils.bind(this,function(code,control,key,shift){var action=this.actions.get(key);if(action!=null){var f=function(){if(action.isEnabled()){action.funct()}};if(control){if(shift){keyHandler.bindControlShiftKey(code,f)}else{keyHandler.bindControlKey(code,f)}}else{if(shift){keyHandler.bindShiftKey(code,f)}else{keyHandler.bindKey(code,f)}}}});var ui=this;var keyHandlerEscape=keyHandler.escape;keyHandler.escape=function(evt){keyHandlerEscape.apply(this,arguments)};keyHandler.enter=function(){};keyHandler.bindControlShiftKey(36,function(){graph.exitGroup()});keyHandler.bindControlShiftKey(35,function(){graph.enterGroup()});keyHandler.bindKey(36,function(){graph.home()});keyHandler.bindKey(35,function(){graph.refresh()});keyHandler.bindAction(107,true,"zoomIn");keyHandler.bindAction(109,true,"zoomOut");keyHandler.bindAction(80,true,"print");keyHandler.bindAction(79,true,"outline",true);keyHandler.bindAction(112,false,"about");if(!this.editor.chromeless){keyHandler.bindControlKey(36,function(){if(graph.isEnabled()){graph.foldCells(true)}});keyHandler.bindControlKey(35,function(){if(graph.isEnabled()){graph.foldCells(false)}});keyHandler.bindControlKey(13,function(){if(graph.isEnabled()){graph.setSelectionCells(graph.duplicateCells(graph.getSelectionCells(),false))}});keyHandler.bindAction(8,false,"delete");keyHandler.bindAction(8,true,"deleteAll");keyHandler.bindAction(46,false,"delete");keyHandler.bindAction(46,true,"deleteAll");keyHandler.bindAction(72,true,"resetView");keyHandler.bindAction(72,true,"fitWindow",true);keyHandler.bindAction(74,true,"fitPage");keyHandler.bindAction(74,true,"fitTwoPages",true);keyHandler.bindAction(48,true,"customZoom");keyHandler.bindAction(82,true,"turn");keyHandler.bindAction(82,true,"clearDefaultStyle",true);keyHandler.bindAction(83,true,"save");keyHandler.bindAction(83,true,"saveAs",true);keyHandler.bindAction(65,true,"selectAll");keyHandler.bindAction(65,true,"selectNone",true);keyHandler.bindAction(73,true,"selectVertices",true);keyHandler.bindAction(69,true,"selectEdges",true);keyHandler.bindAction(69,true,"editStyle");keyHandler.bindAction(66,true,"bold");keyHandler.bindAction(66,true,"toBack",true);keyHandler.bindAction(70,true,"toFront",true);keyHandler.bindAction(68,true,"duplicate");keyHandler.bindAction(68,true,"setAsDefaultStyle",true);keyHandler.bindAction(90,true,"undo");keyHandler.bindAction(89,true,"autosize",true);keyHandler.bindAction(88,true,"cut");keyHandler.bindAction(67,true,"copy");keyHandler.bindAction(81,true,"connectionArrows");keyHandler.bindAction(81,true,"connectionPoints",true);keyHandler.bindAction(86,true,"paste");keyHandler.bindAction(71,true,"group");keyHandler.bindAction(77,true,"editData");keyHandler.bindAction(71,true,"grid",true);keyHandler.bindAction(73,true,"italic");keyHandler.bindAction(76,true,"lockUnlock");keyHandler.bindAction(76,true,"layers",true);keyHandler.bindAction(80,true,"formatPanel",true);keyHandler.bindAction(85,true,"underline");keyHandler.bindAction(85,true,"ungroup",true);keyHandler.bindAction(190,true,"superscript");keyHandler.bindAction(188,true,"subscript");keyHandler.bindKey(13,function(){if(graph.isEnabled()){graph.startEditingAtCell()}});keyHandler.bindKey(113,function(){if(graph.isEnabled()){graph.startEditingAtCell()}})}if(!mxClient.IS_WIN){keyHandler.bindAction(90,true,"redo",true)}else{keyHandler.bindAction(89,true,"redo")}return keyHandler};EditorUi.prototype.destroy=function(){if(this.editor!=null){this.editor.destroy();this.editor=null}if(this.menubar!=null){this.menubar.destroy();this.menubar=null}if(this.toolbar!=null){this.toolbar.destroy();this.toolbar=null}if(this.sidebar!=null){this.sidebar.destroy();this.sidebar=null}if(this.keyHandler!=null){this.keyHandler.destroy();this.keyHandler=null}if(this.keydownHandler!=null){mxEvent.removeListener(document,"keydown",this.keydownHandler);this.keydownHandler=null}if(this.keyupHandler!=null){mxEvent.removeListener(document,"keyup",this.keyupHandler);this.keyupHandler=null}if(this.resizeHandler!=null){mxEvent.removeListener(window,"resize",this.resizeHandler);this.resizeHandler=null}if(this.gestureHandler!=null){mxEvent.removeGestureListeners(document,this.gestureHandler);this.gestureHandler=null}if(this.orientationChangeHandler!=null){mxEvent.removeListener(window,"orientationchange",this.orientationChangeHandler);this.orientationChangeHandler=null}if(this.scrollHandler!=null){mxEvent.removeListener(window,"scroll",this.scrollHandler);this.scrollHandler=null}if(this.destroyFunctions!=null){for(var i=0;i<this.destroyFunctions.length;i++){this.destroyFunctions[i]()}this.destroyFunctions=null}var c=[this.menubarContainer,this.toolbarContainer,this.sidebarContainer,this.formatContainer,this.diagramContainer,this.footerContainer,this.chromelessToolbar,this.hsplit,this.sidebarFooterContainer,this.layersDialog];for(var i=0;i<c.length;i++){if(c[i]!=null&&c[i].parentNode!=null){c[i].parentNode.removeChild(c[i])}}};module.exports=EditorUi},{"./Actions":1,"./Menus":4,"./Sidebar":6,"./Toolbar":7}],4:[function(require,module,exports){Menus=function(editorUi){this.editorUi=editorUi;this.menus=new Object;this.init();if(!mxClient.IS_SVG){(new Image).src=this.checkmarkImage}};Menus.prototype.defaultFont="Helvetica";Menus.prototype.defaultFontSize="12";Menus.prototype.defaultMenuItems=["file","edit","view","arrange","extras","help"];Menus.prototype.defaultFonts=["Helvetica","Verdana","Times New Roman","Garamond","Comic Sans MS","Courier New","Georgia","Lucida Console","Tahoma"];Menus.prototype.init=function(){var graph=this.editorUi.editor.graph;var isGraphEnabled=mxUtils.bind(graph,graph.isEnabled);this.customFonts=[];this.customFontSizes=[];this.put("fontFamily",new Menu(mxUtils.bind(this,function(menu,parent){var addItem=mxUtils.bind(this,function(fontname){var tr=this.styleChange(menu,fontname,[mxConstants.STYLE_FONTFAMILY],[fontname],null,parent,function(){document.execCommand("fontname",false,fontname)});tr.firstChild.nextSibling.style.fontFamily=fontname});for(var i=0;i<this.defaultFonts.length;i++){addItem(this.defaultFonts[i])}menu.addSeparator(parent);if(this.customFonts.length>0){for(var i=0;i<this.customFonts.length;i++){addItem(this.customFonts[i])}menu.addSeparator(parent);menu.addItem(mxResources.get("reset"),null,mxUtils.bind(this,function(){this.customFonts=[]}),parent);menu.addSeparator(parent)}this.promptChange(menu,mxResources.get("custom")+"...","",mxConstants.DEFAULT_FONTFAMILY,mxConstants.STYLE_FONTFAMILY,parent,true,mxUtils.bind(this,function(newValue){this.customFonts.push(newValue)}))})));this.put("formatBlock",new Menu(mxUtils.bind(this,function(menu,parent){function addItem(label,tag){return menu.addItem(label,null,mxUtils.bind(this,function(){graph.cellEditor.textarea.focus();document.execCommand("formatBlock",false,"<"+tag+">")}),parent)}addItem(mxResources.get("normal"),"p");addItem("","h1").firstChild.nextSibling.innerHTML='<h1 style="margin:0px;">'+mxResources.get("heading")+" 1</h1>";addItem("","h2").firstChild.nextSibling.innerHTML='<h2 style="margin:0px;">'+mxResources.get("heading")+" 2</h2>";addItem("","h3").firstChild.nextSibling.innerHTML='<h3 style="margin:0px;">'+mxResources.get("heading")+" 3</h3>";addItem("","h4").firstChild.nextSibling.innerHTML='<h4 style="margin:0px;">'+mxResources.get("heading")+" 4</h4>";addItem("","h5").firstChild.nextSibling.innerHTML='<h5 style="margin:0px;">'+mxResources.get("heading")+" 5</h5>";addItem("","h6").firstChild.nextSibling.innerHTML='<h6 style="margin:0px;">'+mxResources.get("heading")+" 6</h6>";addItem("","pre").firstChild.nextSibling.innerHTML='<pre style="margin:0px;">'+mxResources.get("formatted")+"</pre>";addItem("","blockquote").firstChild.nextSibling.innerHTML='<blockquote style="margin-top:0px;margin-bottom:0px;">'+mxResources.get("blockquote")+"</blockquote>"})));this.put("fontSize",new Menu(mxUtils.bind(this,function(menu,parent){var sizes=[6,8,9,10,11,12,14,18,24,36,48,72];var addItem=mxUtils.bind(this,function(fontsize){this.styleChange(menu,fontsize,[mxConstants.STYLE_FONTSIZE],[fontsize],null,parent,function(){document.execCommand("fontSize",false,"3");var elts=graph.cellEditor.textarea.getElementsByTagName("font");for(var i=0;i<elts.length;i++){if(elts[i].getAttribute("size")=="3"){elts[i].removeAttribute("size");elts[i].style.fontSize=fontsize+"px";break}}})});for(var i=0;i<sizes.length;i++){addItem(sizes[i])}menu.addSeparator(parent);if(this.customFontSizes.length>0){for(var i=0;i<this.customFontSizes.length;i++){addItem(this.customFontSizes[i])}menu.addSeparator(parent);menu.addItem(mxResources.get("reset"),null,mxUtils.bind(this,function(){this.customFontSizes=[]}),parent);menu.addSeparator(parent)}this.promptChange(menu,mxResources.get("custom")+"...","(pt)","12",mxConstants.STYLE_FONTSIZE,parent,true,mxUtils.bind(this,function(newValue){this.customFontSizes.push(newValue)}))})));this.put("direction",new Menu(mxUtils.bind(this,function(menu,parent){menu.addItem(mxResources.get("flipH"),null,function(){graph.toggleCellStyles(mxConstants.STYLE_FLIPH,false)},parent);menu.addItem(mxResources.get("flipV"),null,function(){graph.toggleCellStyles(mxConstants.STYLE_FLIPV,false)},parent);this.addMenuItems(menu,["-","rotation"],parent)})));this.put("align",new Menu(mxUtils.bind(this,function(menu,parent){menu.addItem(mxResources.get("leftAlign"),null,function(){graph.alignCells(mxConstants.ALIGN_LEFT)},parent);menu.addItem(mxResources.get("center"),null,function(){graph.alignCells(mxConstants.ALIGN_CENTER)},parent);menu.addItem(mxResources.get("rightAlign"),null,function(){graph.alignCells(mxConstants.ALIGN_RIGHT)},parent);menu.addSeparator(parent);menu.addItem(mxResources.get("topAlign"),null,function(){graph.alignCells(mxConstants.ALIGN_TOP)},parent);menu.addItem(mxResources.get("middle"),null,function(){graph.alignCells(mxConstants.ALIGN_MIDDLE)},parent);menu.addItem(mxResources.get("bottomAlign"),null,function(){graph.alignCells(mxConstants.ALIGN_BOTTOM)},parent)})));this.put("distribute",new Menu(mxUtils.bind(this,function(menu,parent){menu.addItem(mxResources.get("horizontal"),null,function(){graph.distributeCells(true)},parent);menu.addItem(mxResources.get("vertical"),null,function(){graph.distributeCells(false)},parent)})));this.put("layout",new Menu(mxUtils.bind(this,function(menu,parent){var promptSpacing=mxUtils.bind(this,function(defaultValue,fn){var dlg=new FilenameDialog(this.editorUi,defaultValue,mxResources.get("apply"),function(newValue){fn(parseFloat(newValue))},mxResources.get("spacing"));this.editorUi.showDialog(dlg.container,300,80,true,true);dlg.init()});menu.addItem(mxResources.get("horizontalFlow"),null,mxUtils.bind(this,function(){var layout=new mxHierarchicalLayout(graph,mxConstants.DIRECTION_WEST);this.editorUi.executeLayout(function(){var selectionCells=graph.getSelectionCells();layout.execute(graph.getDefaultParent(),selectionCells.length==0?null:selectionCells)},true)}),parent);menu.addItem(mxResources.get("verticalFlow"),null,mxUtils.bind(this,function(){var layout=new mxHierarchicalLayout(graph,mxConstants.DIRECTION_NORTH);this.editorUi.executeLayout(function(){var selectionCells=graph.getSelectionCells();layout.execute(graph.getDefaultParent(),selectionCells.length==0?null:selectionCells)},true)}),parent);menu.addSeparator(parent);menu.addItem(mxResources.get("horizontalTree"),null,mxUtils.bind(this,function(){var tmp=graph.getSelectionCell();var roots=null;if(tmp==null||graph.getModel().getChildCount(tmp)==0){if(graph.getModel().getEdgeCount(tmp)==0){roots=graph.findTreeRoots(graph.getDefaultParent())}}else{roots=graph.findTreeRoots(tmp)}if(roots!=null&&roots.length>0){tmp=roots[0]}if(tmp!=null){var layout=new mxCompactTreeLayout(graph,true);layout.edgeRouting=false;layout.levelDistance=30;promptSpacing(layout.levelDistance,mxUtils.bind(this,function(newValue){layout.levelDistance=newValue;this.editorUi.executeLayout(function(){layout.execute(graph.getDefaultParent(),tmp)},true)}))}}),parent);menu.addItem(mxResources.get("verticalTree"),null,mxUtils.bind(this,function(){var tmp=graph.getSelectionCell();var roots=null;if(tmp==null||graph.getModel().getChildCount(tmp)==0){if(graph.getModel().getEdgeCount(tmp)==0){roots=graph.findTreeRoots(graph.getDefaultParent())}}else{roots=graph.findTreeRoots(tmp)}if(roots!=null&&roots.length>0){tmp=roots[0]}if(tmp!=null){var layout=new mxCompactTreeLayout(graph,false);layout.edgeRouting=false;layout.levelDistance=30;promptSpacing(layout.levelDistance,mxUtils.bind(this,function(newValue){layout.levelDistance=newValue;this.editorUi.executeLayout(function(){layout.execute(graph.getDefaultParent(),tmp)},true)}))}}),parent);menu.addItem(mxResources.get("radialTree"),null,mxUtils.bind(this,function(){var tmp=graph.getSelectionCell();var roots=null;if(tmp==null||graph.getModel().getChildCount(tmp)==0){if(graph.getModel().getEdgeCount(tmp)==0){roots=graph.findTreeRoots(graph.getDefaultParent())}}else{roots=graph.findTreeRoots(tmp)}if(roots!=null&&roots.length>0){tmp=roots[0]}if(tmp!=null){var layout=new mxRadialTreeLayout(graph,false);layout.levelDistance=80;layout.autoRadius=true;promptSpacing(layout.levelDistance,mxUtils.bind(this,function(newValue){layout.levelDistance=newValue;this.editorUi.executeLayout(function(){layout.execute(graph.getDefaultParent(),tmp);if(!graph.isSelectionEmpty()){tmp=graph.getModel().getParent(tmp);if(graph.getModel().isVertex(tmp)){graph.updateGroupBounds([tmp],graph.gridSize*2,true)}}},true)}))}}),parent);menu.addSeparator(parent);menu.addItem(mxResources.get("organic"),null,mxUtils.bind(this,function(){var layout=new mxFastOrganicLayout(graph);promptSpacing(layout.forceConstant,mxUtils.bind(this,function(newValue){layout.forceConstant=newValue;this.editorUi.executeLayout(function(){var tmp=graph.getSelectionCell();if(tmp==null||graph.getModel().getChildCount(tmp)==0){tmp=graph.getDefaultParent()}layout.execute(tmp);if(graph.getModel().isVertex(tmp)){graph.updateGroupBounds([tmp],graph.gridSize*2,true)}},true)}))}),parent);menu.addItem(mxResources.get("circle"),null,mxUtils.bind(this,function(){var layout=new mxCircleLayout(graph);this.editorUi.executeLayout(function(){var tmp=graph.getSelectionCell();if(tmp==null||graph.getModel().getChildCount(tmp)==0){tmp=graph.getDefaultParent()}layout.execute(tmp);if(graph.getModel().isVertex(tmp)){graph.updateGroupBounds([tmp],graph.gridSize*2,true)}},true)}),parent)})));this.put("navigation",new Menu(mxUtils.bind(this,function(menu,parent){this.addMenuItems(menu,["home","-","exitGroup","enterGroup","-","expand","collapse","-","collapsible"],parent)})));this.put("arrange",new Menu(mxUtils.bind(this,function(menu,parent){this.addMenuItems(menu,["toFront","toBack","-"],parent);this.addSubmenu("direction",menu,parent);this.addMenuItems(menu,["turn","-"],parent);this.addSubmenu("align",menu,parent);this.addSubmenu("distribute",menu,parent);menu.addSeparator(parent);this.addSubmenu("navigation",menu,parent);this.addSubmenu("insert",menu,parent);this.addSubmenu("layout",menu,parent);this.addMenuItems(menu,["-","group","ungroup","removeFromGroup","-","clearWaypoints","autosize"],parent)}))).isEnabled=isGraphEnabled;this.put("insert",new Menu(mxUtils.bind(this,function(menu,parent){this.addMenuItems(menu,["insertLink","insertImage"],parent)})));this.put("view",new Menu(mxUtils.bind(this,function(menu,parent){this.addMenuItems(menu,(this.editorUi.format!=null?["formatPanel"]:[]).concat(["outline","layers","-","pageView","pageScale","-","scrollbars","tooltips","-","grid","guides","-","connectionArrows","connectionPoints","-","resetView","zoomIn","zoomOut"],parent))})));this.put("viewPanels",new Menu(mxUtils.bind(this,function(menu,parent){if(this.editorUi.format!=null){this.addMenuItems(menu,["formatPanel"],parent)}this.addMenuItems(menu,["outline","layers"],parent)})));this.put("viewZoom",new Menu(mxUtils.bind(this,function(menu,parent){this.addMenuItems(menu,["resetView","-"],parent);var scales=[.25,.5,.75,1,1.25,1.5,2,3,4];for(var i=0;i<scales.length;i++){(function(scale){menu.addItem(scale*100+"%",null,function(){graph.zoomTo(scale)},parent)})(scales[i])}this.addMenuItems(menu,["-","fitWindow","fitPageWidth","fitPage","fitTwoPages","-","customZoom"],parent)})));this.put("file",new Menu(mxUtils.bind(this,function(menu,parent){this.addMenuItems(menu,["new","open","-","save","saveAs","-","import","export","-","generateCode","-","pageSetup","print"],parent)})));this.put("edit",new Menu(mxUtils.bind(this,function(menu,parent){this.addMenuItems(menu,["undo","redo","-","cut","copy","paste","delete","-","duplicate","-","editData","editTooltip","editStyle","-","edit","-","editLink","openLink","-","selectVertices","selectEdges","selectAll","selectNone","-","lockUnlock"])})));this.put("extras",new Menu(mxUtils.bind(this,function(menu,parent){this.addMenuItems(menu,["copyConnect","collapseExpand","-","editDiagram"])})));this.put("help",new Menu(mxUtils.bind(this,function(menu,parent){this.addMenuItems(menu,["help","-","about"])})))};Menus.prototype.put=function(name,menu){this.menus[name]=menu;return menu};Menus.prototype.get=function(name){return this.menus[name]};Menus.prototype.addSubmenu=function(name,menu,parent){var enabled=this.get(name).isEnabled();if(menu.showDisabled||enabled){var submenu=menu.addItem(mxResources.get(name),null,null,parent,null,enabled);this.addMenu(name,menu,submenu)}};Menus.prototype.addMenu=function(name,popupMenu,parent){var menu=this.get(name);if(menu!=null&&(popupMenu.showDisabled||menu.isEnabled())){this.get(name).execute(popupMenu,parent)}};Menus.prototype.addInsertTableItem=function(menu){var graph=this.editorUi.editor.graph;function createTable(rows,cols){var html=["<table>"];for(var i=0;i<rows;i++){html.push("<tr>");for(var j=0;j<cols;j++){html.push("<td><br></td>")}html.push("</tr>")}html.push("</table>");return html.join("")}var elt2=menu.addItem("",null,mxUtils.bind(this,function(evt){var td=graph.getParentByName(mxEvent.getSource(evt),"TD");if(td!=null){var row2=graph.getParentByName(td,"TR");var tmp=graph.cellEditor.textarea.getElementsByTagName("table");var oldTables=[];for(var i=0;i<tmp.length;i++){oldTables.push(tmp[i])}graph.container.focus();graph.pasteHtmlAtCaret(createTable(row2.sectionRowIndex+1,td.cellIndex+1));var newTables=graph.cellEditor.textarea.getElementsByTagName("table");if(newTables.length==oldTables.length+1){for(var i=newTables.length-1;i>=0;i--){if(i==0||newTables[i]!=oldTables[i-1]){graph.selectNode(newTables[i].rows[0].cells[0]);break}}}}}));var quirksCellHtml='<img src="'+mxClient.imageBasePath+"/transparent.gif"+'" width="16" height="16"/>';function createPicker(rows,cols){var table2=document.createElement("table");table2.setAttribute("border","1");table2.style.borderCollapse="collapse";if(!mxClient.IS_QUIRKS){table2.setAttribute("cellPadding","8")}for(var i=0;i<rows;i++){var row=table2.insertRow(i);for(var j=0;j<cols;j++){var cell=row.insertCell(-1);if(mxClient.IS_QUIRKS){cell.innerHTML=quirksCellHtml}}}return table2}function extendPicker(picker,rows,cols){for(var i=picker.rows.length;i<rows;i++){var row=picker.insertRow(i);for(var j=0;j<picker.rows[0].cells.length;j++){var cell=row.insertCell(-1);if(mxClient.IS_QUIRKS){cell.innerHTML=quirksCellHtml}}}for(var i=0;i<picker.rows.length;i++){var row=picker.rows[i];for(var j=row.cells.length;j<cols;j++){var cell=row.insertCell(-1);if(mxClient.IS_QUIRKS){cell.innerHTML=quirksCellHtml}}}}elt2.firstChild.innerHTML="";var picker=createPicker(5,5);elt2.firstChild.appendChild(picker);var label=document.createElement("div");label.style.padding="4px";label.style.fontSize=Menus.prototype.defaultFontSize+"px";label.innerHTML="1x1";elt2.firstChild.appendChild(label);mxEvent.addListener(picker,"mouseover",function(e){var td=graph.getParentByName(mxEvent.getSource(e),"TD");if(td!=null){var row2=graph.getParentByName(td,"TR");extendPicker(picker,Math.min(20,row2.sectionRowIndex+2),Math.min(20,td.cellIndex+2));label.innerHTML=td.cellIndex+1+"x"+(row2.sectionRowIndex+1);for(var i=0;i<picker.rows.length;i++){var r=picker.rows[i];for(var j=0;j<r.cells.length;j++){var cell=r.cells[j];if(i<=row2.sectionRowIndex&&j<=td.cellIndex){cell.style.backgroundColor="blue"}else{cell.style.backgroundColor="white"}}}mxEvent.consume(e)}})};Menus.prototype.edgeStyleChange=function(menu,label,keys,values,sprite,parent,reset){return menu.addItem(label,null,mxUtils.bind(this,function(){var graph=this.editorUi.editor.graph;graph.stopEditing(false);graph.getModel().beginUpdate();try{var cells=graph.getSelectionCells();var edges=[];for(var i=0;i<cells.length;i++){var cell=cells[i];if(graph.getModel().isEdge(cell)){if(reset){var geo=graph.getCellGeometry(cell);if(geo!=null){geo=geo.clone();geo.points=null;graph.getModel().setGeometry(cell,geo)}}for(var j=0;j<keys.length;j++){graph.setCellStyles(keys[j],values[j],[cell])}edges.push(cell)}}this.editorUi.fireEvent(new mxEventObject("styleChanged","keys",keys,"values",values,"cells",edges))}finally{graph.getModel().endUpdate()}}),parent,sprite)};Menus.prototype.styleChange=function(menu,label,keys,values,sprite,parent,fn){var apply=this.createStyleChangeFunction(keys,values);return menu.addItem(label,null,mxUtils.bind(this,function(){var graph=this.editorUi.editor.graph;if(fn!=null&&graph.cellEditor.isContentEditing()){fn()}else{apply()}}),parent,sprite)};Menus.prototype.createStyleChangeFunction=function(keys,values){return mxUtils.bind(this,function(){var graph=this.editorUi.editor.graph;graph.stopEditing(false);graph.getModel().beginUpdate();try{for(var i=0;i<keys.length;i++){graph.setCellStyles(keys[i],values[i])}this.editorUi.fireEvent(new mxEventObject("styleChanged","keys",keys,"values",values,"cells",graph.getSelectionCells()))}finally{graph.getModel().endUpdate()}})};Menus.prototype.promptChange=function(menu,label,hint,defaultValue,key,parent,enabled,fn,sprite){return menu.addItem(label,null,mxUtils.bind(this,function(){var graph=this.editorUi.editor.graph;var value=defaultValue;var state=graph.getView().getState(graph.getSelectionCell());if(state!=null){value=state.style[key]||value}var dlg=new FilenameDialog(this.editorUi,value,mxResources.get("apply"),mxUtils.bind(this,function(newValue){if(newValue!=null&&newValue.length>0){graph.getModel().beginUpdate();try{graph.stopEditing(false);graph.setCellStyles(key,newValue)}finally{graph.getModel().endUpdate()}if(fn!=null){fn(newValue)}}}),mxResources.get("enterValue")+(hint.length>0?" "+hint:""));this.editorUi.showDialog(dlg.container,300,80,true,true);dlg.init()}),parent,sprite,enabled)};Menus.prototype.pickColor=function(key,cmd,defaultValue){var graph=this.editorUi.editor.graph;if(cmd!=null&&graph.cellEditor.isContentEditing()){var selState=graph.cellEditor.saveSelection();var dlg=new ColorDialog(this.editorUi,defaultValue||"000000",mxUtils.bind(this,function(color){graph.cellEditor.restoreSelection(selState);document.execCommand(cmd,false,color!=mxConstants.NONE?color:"transparent")}),function(){graph.cellEditor.restoreSelection(selState)});this.editorUi.showDialog(dlg.container,220,430,true,true);dlg.init()}else{if(this.colorDialog==null){this.colorDialog=new ColorDialog(this.editorUi)}this.colorDialog.currentColorKey=key;var state=graph.getView().getState(graph.getSelectionCell());var color="none";if(state!=null){color=state.style[key]||color}if(color=="none"){color="ffffff";this.colorDialog.picker.fromString("ffffff");this.colorDialog.colorInput.value="none"}else{this.colorDialog.picker.fromString(color)}this.editorUi.showDialog(this.colorDialog.container,220,430,true,true);this.colorDialog.init()}};Menus.prototype.toggleStyle=function(key,defaultValue){var graph=this.editorUi.editor.graph;var value=graph.toggleCellStyles(key,defaultValue);this.editorUi.fireEvent(new mxEventObject("styleChanged","keys",[key],"values",[value],"cells",graph.getSelectionCells()))};Menus.prototype.addMenuItem=function(menu,key,parent,trigger,sprite){var action=this.editorUi.actions.get(key);if(action!=null&&(menu.showDisabled||action.isEnabled())&&action.visible){var item=menu.addItem(action.label,null,function(){action.funct(trigger)},parent,sprite,action.isEnabled());if(action.toggleAction&&action.isSelected()){menu.addCheckmark(item,Editor.checkmarkImage)}this.addShortcut(item,action);return item}return null};Menus.prototype.addShortcut=function(item,action){if(action.shortcut!=null){var td=item.firstChild.nextSibling.nextSibling;var span=document.createElement("span");span.style.color="gray";mxUtils.write(span,action.shortcut);td.appendChild(span)}};Menus.prototype.addMenuItems=function(menu,keys,parent,trigger,sprites){for(var i=0;i<keys.length;i++){if(keys[i]=="-"){menu.addSeparator(parent)}else{this.addMenuItem(menu,keys[i],parent,trigger,sprites!=null?sprites[i]:null)}}};Menus.prototype.createPopupMenu=function(menu,cell,evt){var graph=this.editorUi.editor.graph;menu.smartSeparators=true;if(graph.isSelectionEmpty()){this.addMenuItems(menu,["undo","redo","-","pasteHere"],null,evt)}else{this.addMenuItems(menu,["delete","-","cut","copy","-","duplicate"],null,evt)}if(graph.getSelectionCount()>0){if(graph.getSelectionCount()==1){this.addMenuItems(menu,["setAsDefaultStyle"],null,evt)}menu.addSeparator();cell=graph.getSelectionCell();var state=graph.view.getState(cell);if(state!=null){if(graph.getSelectionCount()==1){this.addMenuItems(menu,["toFront","toBack","-"],null,evt)}if(graph.getModel().isEdge(cell)&&mxUtils.getValue(state.style,mxConstants.STYLE_EDGE,null)!="entityRelationEdgeStyle"&&mxUtils.getValue(state.style,mxConstants.STYLE_SHAPE,null)!="arrow"){var handler=graph.selectionCellsHandler.getHandler(cell);var isWaypoint=false;if(handler instanceof mxEdgeHandler&&handler.bends!=null&&handler.bends.length>2){var index=handler.getHandleForEvent(graph.updateMouseEvent(new mxMouseEvent(evt)));var rmWaypointAction=this.editorUi.actions.get("removeWaypoint");rmWaypointAction.handler=handler;rmWaypointAction.index=index;isWaypoint=index>0&&index<handler.bends.length-1}this.addMenuItems(menu,["-",isWaypoint?"removeWaypoint":"addWaypoint"],null,evt);var geo=graph.getModel().getGeometry(cell);if(geo!=null&&geo.points!=null&&geo.points.length>0){this.addMenuItems(menu,["clearWaypoints"],null,evt)}}if(graph.getSelectionCount()>1){menu.addSeparator();this.addMenuItems(menu,["group"],null,evt)}else if(graph.getSelectionCount()==1&&!graph.getModel().isEdge(cell)&&!graph.isSwimlane(cell)&&graph.getModel().getChildCount(cell)>0){menu.addSeparator();this.addMenuItems(menu,["ungroup"],null,evt)}if(graph.getSelectionCount()==1){menu.addSeparator();this.addMenuItems(menu,["edit","-","editData","editLink"],null,evt);if(graph.getModel().isVertex(cell)&&mxUtils.getValue(state.style,mxConstants.STYLE_IMAGE,null)!=null){menu.addSeparator();this.addMenuItem(menu,"image",null,evt).firstChild.nextSibling.innerHTML=mxResources.get("editImage")+"..."}}}}else{this.addMenuItems(menu,["-","selectVertices","selectEdges","-","selectAll"],null,evt)}};Menus.prototype.createMenubar=function(container){var menubar=new Menubar(this.editorUi,container);var menus=this.defaultMenuItems;for(var i=0;i<menus.length;i++){mxUtils.bind(this,function(menu){var elt=menubar.addMenu(mxResources.get(menus[i]),mxUtils.bind(this,function(){menu.funct.apply(this,arguments)}));if(elt!=null){menu.addListener("stateChanged",function(){elt.enabled=menu.enabled;if(!menu.enabled){elt.className="geItem mxDisabled";if(document.documentMode==8){elt.style.color="#c3c3c3"}}else{elt.className="geItem";if(document.documentMode==8){elt.style.color=""}}})}})(this.get(menus[i]))}return menubar};function Menubar(editorUi,container){this.editorUi=editorUi;this.container=container}Menubar.prototype.hideMenu=function(){this.editorUi.hideCurrentMenu()};Menubar.prototype.addMenu=function(label,funct){var elt=document.createElement("a");elt.setAttribute("href","javascript:void(0);");elt.className="geItem";mxUtils.write(elt,label);this.addMenuHandler(elt,funct);this.container.appendChild(elt);return elt};Menubar.prototype.addMenuHandler=function(elt,funct){if(funct!=null){var show=true;var clickHandler=mxUtils.bind(this,function(evt){if(show&&elt.enabled==null||elt.enabled){this.editorUi.editor.graph.popupMenuHandler.hideMenu();var menu=new mxPopupMenu(funct);menu.div.className+=" geMenubarMenu";menu.smartSeparators=true;menu.showDisabled=true;menu.autoExpand=true;menu.hideMenu=mxUtils.bind(this,function(){mxPopupMenu.prototype.hideMenu.apply(menu,arguments);this.editorUi.resetCurrentMenu();menu.destroy()});var offset=mxUtils.getOffset(elt);menu.popup(offset.x,offset.y+elt.offsetHeight,null,evt);this.editorUi.setCurrentMenu(menu,elt)}mxEvent.consume(evt)});mxEvent.addListener(elt,"mousemove",mxUtils.bind(this,function(evt){if(this.editorUi.currentMenu!=null&&this.editorUi.currentMenuElt!=elt){this.editorUi.hideCurrentMenu();clickHandler(evt)}}));mxEvent.addListener(elt,"mousedown",mxUtils.bind(this,function(){show=this.currentElt!=elt}));mxEvent.addListener(elt,"click",mxUtils.bind(this,function(evt){clickHandler(evt);show=true}))}};Menubar.prototype.destroy=function(){};function Menu(funct,enabled){mxEventSource.call(this);this.funct=funct;this.enabled=enabled!=null?enabled:true}mxUtils.extend(Menu,mxEventSource);Menu.prototype.isEnabled=function(){return this.enabled};Menu.prototype.setEnabled=function(value){if(this.enabled!=value){this.enabled=value;this.fireEvent(new mxEventObject("stateChanged"))}};Menu.prototype.execute=function(menu,parent){this.funct(menu,parent)};module.exports=Menus},{}],5:[function(require,module,exports){var saveFile=function(ui,forceDialog){if(!forceDialog&&ui.editor.filename!=null){ui.save(ui.editor.getOrCreateFilename())}else{var dlg=new FilenameDialog(ui,ui.editor.getOrCreateFilename(),mxResources.get("save"),mxUtils.bind(ui,function(name){save(ui,name)}),null,mxUtils.bind(ui,function(name){if(name!=null&&name.length>0){return true}mxUtils.confirm(mxResources.get("invalidName"));return false}));ui.showDialog(dlg.container,300,100,true,true);dlg.init()}};var save=function(ui,name){if(name!=null){if(ui.editor.graph.isEditing()){ui.editor.graph.stopEditing()}var xml=mxUtils.getXml(ui.editor.getGraphXml());var textFile=null;try{if(Editor.useFileSystemSave){var data=new Blob([xml],{type:"text/plain"});if(textFile!==null){window.URL.revokeObjectURL(textFile)}textFile=window.URL.createObjectURL(data);var link=document.createElement("a");if(typeof link.download==="string"){document.body.appendChild(link);link.download=name;link.href=textFile;link.click();document.body.removeChild(link)}else{location.replace(uri)}return}else if(Editor.useLocalStorage){if(localStorage.getItem(name)!=null&&!mxUtils.confirm(mxResources.get("replaceIt",[name]))){return}localStorage.setItem(name,xml);ui.editor.setStatus(mxResources.get("saved")+" "+new Date)}else{if(xml.length<MAX_REQUEST_SIZE){new mxXmlRequest(SAVE_URL,"filename="+encodeURIComponent(name)+"&xml="+encodeURIComponent(xml)).simulate(document,"_blank")}else{mxUtils.alert(mxResources.get("drawingTooLarge"));mxUtils.popup(xml);return}}ui.editor.setModified(false);ui.editor.setFilename(name);ui.updateDocumentTitle()}catch(e){ui.editor.setStatus("Error saving file")}}};module.exports=saveFile},{}],6:[function(require,module,exports){var addClassDiagramPalette=require("./Diagrams/ClassDiagram.js");function Sidebar(editorUi,container){this.editorUi=editorUi;this.container=container;this.palettes=new Object;this.taglist=new Object;this.showTooltips=true;this.graph=editorUi.createTemporaryGraph(this.editorUi.editor.graph.getStylesheet());this.graph.cellRenderer.antiAlias=false;this.graph.foldingEnabled=false;if(!mxClient.IS_IE&&!mxClient.IS_IE11){this.graph.container.style.display="none"}document.body.appendChild(this.graph.container);this.pointerUpHandler=mxUtils.bind(this,function(){this.showTooltips=true});mxEvent.addListener(document,mxClient.IS_POINTER?"pointerup":"mouseup",this.pointerUpHandler);this.pointerDownHandler=mxUtils.bind(this,function(){this.showTooltips=false;this.hideTooltip()});mxEvent.addListener(document,mxClient.IS_POINTER?"pointerdown":"mousedown",this.pointerDownHandler);this.pointerMoveHandler=mxUtils.bind(this,function(evt){var src=mxEvent.getSource(evt);while(src!=null){if(src==this.currentElt){return}src=src.parentNode}this.hideTooltip()});mxEvent.addListener(document,mxClient.IS_POINTER?"pointermove":"mousemove",this.pointerMoveHandler);this.pointerOutHandler=mxUtils.bind(this,function(evt){if(evt.toElement==null&&evt.relatedTarget==null){this.hideTooltip()}});mxEvent.addListener(document,mxClient.IS_POINTER?"pointerout":"mouseout",this.pointerOutHandler);mxEvent.addListener(container,"scroll",mxUtils.bind(this,function(){this.showTooltips=true}));this.init();if(!mxClient.IS_SVG){(new Image).src=IMAGE_PATH+"/tooltip.png"}}Sidebar.prototype.init=function(){var dir=STENCIL_PATH;addClassDiagramPalette(this,true)};Sidebar.prototype.collapsedImage=!mxClient.IS_SVG?IMAGE_PATH+"/collapsed.gif":"data:image/gif;base64,R0lGODlhDQANAIABAJmZmf///yH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS4wLWMwNjAgNjEuMTM0Nzc3LCAyMDEwLzAyLzEyLTE3OjMyOjAwICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozNUQyRTJFNjZGNUYxMUU1QjZEOThCNDYxMDQ2MzNCQiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozNUQyRTJFNzZGNUYxMUU1QjZEOThCNDYxMDQ2MzNCQiI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjFERjc3MEUxNkY1RjExRTVCNkQ5OEI0NjEwNDYzM0JCIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjFERjc3MEUyNkY1RjExRTVCNkQ5OEI0NjEwNDYzM0JCIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Af/+/fz7+vn49/b19PPy8fDv7u3s6+rp6Ofm5eTj4uHg397d3Nva2djX1tXU09LR0M/OzczLysnIx8bFxMPCwcC/vr28u7q5uLe2tbSzsrGwr66trKuqqainpqWko6KhoJ+enZybmpmYl5aVlJOSkZCPjo2Mi4qJiIeGhYSDgoGAf359fHt6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYWBfXl1cW1pZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBQD8+PTw7Ojk4NzY1NDMyMTAvLi0sKyopKCcmJSQjIiEgHx4dHBsaGRgXFhUUExIREA8ODQwLCgkIBwYFBAMCAQAAIfkEAQAAAQAsAAAAAA0ADQAAAhSMj6lrwAjcC1GyahV+dcZJgeIIFgA7";Sidebar.prototype.expandedImage=!mxClient.IS_SVG?IMAGE_PATH+"/expanded.gif":"data:image/gif;base64,R0lGODlhDQANAIABAJmZmf///yH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS4wLWMwNjAgNjEuMTM0Nzc3LCAyMDEwLzAyLzEyLTE3OjMyOjAwICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoxREY3NzBERjZGNUYxMUU1QjZEOThCNDYxMDQ2MzNCQiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDoxREY3NzBFMDZGNUYxMUU1QjZEOThCNDYxMDQ2MzNCQiI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjFERjc3MERENkY1RjExRTVCNkQ5OEI0NjEwNDYzM0JCIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjFERjc3MERFNkY1RjExRTVCNkQ5OEI0NjEwNDYzM0JCIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Af/+/fz7+vn49/b19PPy8fDv7u3s6+rp6Ofm5eTj4uHg397d3Nva2djX1tXU09LR0M/OzczLysnIx8bFxMPCwcC/vr28u7q5uLe2tbSzsrGwr66trKuqqainpqWko6KhoJ+enZybmpmYl5aVlJOSkZCPjo2Mi4qJiIeGhYSDgoGAf359fHt6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYWBfXl1cW1pZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBQD8+PTw7Ojk4NzY1NDMyMTAvLi0sKyopKCcmJSQjIiEgHx4dHBsaGRgXFhUUExIREA8ODQwLCgkIBwYFBAMCAQAAIfkEAQAAAQAsAAAAAA0ADQAAAhGMj6nL3QAjVHIu6azbvPtWAAA7";Sidebar.prototype.tooltipImage=!mxClient.IS_SVG?IMAGE_PATH+"/tooltip.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAbCAMAAAB7jU7LAAAACVBMVEX///+ZmZn///9Y2COLAAAAA3RSTlP//wDXyg1BAAAAOElEQVR42mXQMQ4AMAgDsWv//+iutcJmIQSk+9dJpVKpVCqVSqVSqZTdncWzF8/NeP7FkxWenPEDOnUBiL3jWx0AAAAASUVORK5CYII=";Sidebar.prototype.searchImage=!mxClient.IS_SVG?IMAGE_PATH+"/search.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAEaSURBVHjabNGxS5VxFIfxz71XaWuQUJCG/gCHhgTD9VpEETg4aMOlQRp0EoezObgcd220KQiXmpretTAHQRBdojlQEJyukPdt+b1ywfvAGc7wnHP4nlZd1yKijQW8xzNc4Su+ZOYfQ3T6/f4YNvEJYzjELXp4VVXVz263+7cR2niBxAFeZ2YPi3iHR/gYERPDwhpOsd6sz8x/mfkNG3iOlWFhFj8y89J9KvzGXER0GuEaD42mgwHqUtoljbcRsTBCeINpfM/MgZLKPpaxFxGbOCqDXmILN7hoJrTKH+axhxmcYRxP0MIDnOBDZv5q1XUNIuJxifJp+UNV7t7BFM6xeic0RMQ4Bpl5W/ol7GISx/eEUUTECrbx+f8A8xhiZht9zsgAAAAASUVORK5CYII=";Sidebar.prototype.enableTooltips=true;Sidebar.prototype.tooltipBorder=16;Sidebar.prototype.tooltipDelay=300;Sidebar.prototype.dropTargetDelay=200;Sidebar.prototype.gearImage=STENCIL_PATH+"/clipart/Gear_128x128.png";Sidebar.prototype.thumbWidth=36;Sidebar.prototype.thumbHeight=36;Sidebar.prototype.thumbPadding=document.documentMode>=5?0:1;Sidebar.prototype.thumbBorder=2;Sidebar.prototype.sidebarTitleSize=9;Sidebar.prototype.sidebarTitles=false;Sidebar.prototype.tooltipTitles=true;Sidebar.prototype.maxTooltipWidth=400;Sidebar.prototype.maxTooltipHeight=400;Sidebar.prototype.addStencilsToIndex=true;Sidebar.prototype.defaultImageWidth=80;Sidebar.prototype.defaultImageHeight=80;Sidebar.prototype.showTooltip=function(elt,cells,w,h,title,showLabel){if(this.enableTooltips&&this.showTooltips){if(this.currentElt!=elt){if(this.thread!=null){window.clearTimeout(this.thread);this.thread=null}var show=mxUtils.bind(this,function(){if(this.tooltip==null){this.tooltip=document.createElement("div");this.tooltip.className="geSidebarTooltip";this.tooltip.style.zIndex=mxPopupMenu.prototype.zIndex-1;document.body.appendChild(this.tooltip);this.graph2=new Graph(this.tooltip,null,null,this.editorUi.editor.graph.getStylesheet());this.graph2.resetViewOnRootChange=false;this.graph2.foldingEnabled=false;this.graph2.gridEnabled=false;this.graph2.autoScroll=false;this.graph2.setTooltips(false);this.graph2.setConnectable(false);this.graph2.setEnabled(false);if(!mxClient.IS_SVG){this.graph2.view.canvas.style.position="relative"}this.tooltipImage=mxUtils.createImage(this.tooltipImage);this.tooltipImage.className="geSidebarTooltipImage";this.tooltipImage.style.zIndex=mxPopupMenu.prototype.zIndex-1;this.tooltipImage.style.position="absolute";this.tooltipImage.style.width="14px";this.tooltipImage.style.height="27px";document.body.appendChild(this.tooltipImage)}this.graph2.model.clear();this.graph2.view.setTranslate(this.tooltipBorder,this.tooltipBorder);if(w>this.maxTooltipWidth||h>this.maxTooltipHeight){this.graph2.view.scale=Math.round(Math.min(this.maxTooltipWidth/w,this.maxTooltipHeight/h)*100)/100}else{this.graph2.view.scale=1}this.tooltip.style.display="block";this.graph2.labelsVisible=showLabel==null||showLabel;this.graph2.addCells(cells);var bounds=this.graph2.getGraphBounds();var width=bounds.width+2*this.tooltipBorder+4;var height=bounds.height+2*this.tooltipBorder;if(mxClient.IS_QUIRKS){height+=4;this.tooltip.style.overflow="hidden"}else{this.tooltip.style.overflow="visible"}this.tooltipImage.style.visibility="visible";this.tooltip.style.width=width+"px";if(this.tooltipTitles&&title!=null&&title.length>0){if(this.tooltipTitle==null){this.tooltipTitle=document.createElement("div");this.tooltipTitle.style.borderTop="1px solid gray";this.tooltipTitle.style.textAlign="center";this.tooltipTitle.style.width="100%";this.tooltipTitle.style.overflow="hidden";if(mxClient.IS_SVG){this.tooltipTitle.style.paddingTop="6px"}else{this.tooltipTitle.style.position="absolute";this.tooltipTitle.style.paddingTop="6px"}this.tooltip.appendChild(this.tooltipTitle)}else{this.tooltipTitle.innerHTML=""}this.tooltipTitle.style.display="";mxUtils.write(this.tooltipTitle,title);var ddy=this.tooltipTitle.offsetHeight+10;height+=ddy;if(mxClient.IS_SVG){this.tooltipTitle.style.marginTop=2-ddy+"px"}else{height-=6;this.tooltipTitle.style.top=height-ddy+"px"}}else if(this.tooltipTitle!=null&&this.tooltipTitle.parentNode!=null){this.tooltipTitle.style.display="none"}this.tooltip.style.height=height+"px";var x0=-Math.round(bounds.x-this.tooltipBorder);var y0=-Math.round(bounds.y-this.tooltipBorder);var b=document.body;var d=document.documentElement;var bottom=Math.max(b.clientHeight||0,d.clientHeight);var left=this.container.clientWidth+this.editorUi.splitSize+3+this.editorUi.container.offsetLeft;var top=Math.min(bottom-height-20,Math.max(0,this.editorUi.container.offsetTop+this.container.offsetTop+elt.offsetTop-this.container.scrollTop-height/2+16));if(mxClient.IS_SVG){if(x0!=0||y0!=0){this.graph2.view.canvas.setAttribute("transform","translate("+x0+","+y0+")")}else{this.graph2.view.canvas.removeAttribute("transform")}}else{this.graph2.view.drawPane.style.left=x0+"px";this.graph2.view.drawPane.style.top=y0+"px"}this.tooltip.style.position="absolute";this.tooltip.style.left=left+"px";this.tooltip.style.top=top+"px";this.tooltipImage.style.left=left-13+"px";this.tooltipImage.style.top=top+height/2-13+"px"});if(this.tooltip!=null&&this.tooltip.style.display!="none"){show()}else{this.thread=window.setTimeout(show,this.tooltipDelay)}this.currentElt=elt}}};Sidebar.prototype.hideTooltip=function(){if(this.thread!=null){window.clearTimeout(this.thread);this.thread=null}if(this.tooltip!=null){this.tooltip.style.display="none";this.tooltipImage.style.visibility="hidden";this.currentElt=null}};Sidebar.prototype.addEntry=function(tags,fn){if(this.taglist!=null&&tags!=null&&tags.length>0){var tmp=tags.toLowerCase().replace(/[\/\,\(\)]/g," ").split(" ");var doAddEntry=mxUtils.bind(this,function(tag){if(tag.length>1){var entry=this.taglist[tag];if(entry==null){entry={entries:[],dict:new mxDictionary};this.taglist[tag]=entry}if(entry.dict.get(fn)==null){entry.dict.put(fn,fn);entry.entries.push(fn)}}});for(var i=0;i<tmp.length;i++){doAddEntry(tmp[i]);var normalized=tmp[i].replace(/\.*\d*$/,"");if(normalized!=tmp[i]){doAddEntry(normalized)}}}return fn};Sidebar.prototype.searchEntries=function(searchTerms,count,page,success,error){if(this.taglist!=null&&searchTerms!=null){var tmp=searchTerms.toLowerCase().split(" ");var dict=new mxDictionary;var max=(page+1)*count;var results=[];var index=0;for(var i=0;i<tmp.length;i++){if(tmp[i].length>0){var entry=this.taglist[tmp[i]];var tmpDict=new mxDictionary;if(entry!=null){var arr=entry.entries;results=[];for(var j=0;j<arr.length;j++){var entry=arr[j];if(index==0==(dict.get(entry)==null)){tmpDict.put(entry,entry);results.push(entry);if(i==tmp.length-1&&results.length==max){success(results.slice(page*count,max),max,true,tmp);return}}}}else{results=[]}dict=tmpDict;index++}}var len=results.length;success(results.slice(page*count,(page+1)*count),len,false,tmp)}else{success([],null,null,tmp)}};Sidebar.prototype.filterTags=function(tags){if(tags!=null){var arr=tags.split(" ");var result=[];var hash={};for(var i=0;i<arr.length;i++){if(hash[arr[i]]==null){hash[arr[i]]="1";result.push(arr[i])}}return result.join(" ")}return null};Sidebar.prototype.cloneCell=function(cell,value){var clone=cell.clone();if(value!=null){clone.value=value}return clone};Sidebar.prototype.addSearchPalette=function(expand){var elt=document.createElement("div");elt.style.visibility="hidden";this.container.appendChild(elt);var div=document.createElement("div");div.className="geSidebar";div.style.boxSizing="border-box";div.style.overflow="hidden";div.style.width="100%";div.style.padding="8px";div.style.paddingTop="14px";div.style.paddingBottom="0px";if(!expand){div.style.display="none"}var inner=document.createElement("div");inner.style.whiteSpace="nowrap";inner.style.textOverflow="clip";inner.style.paddingBottom="8px";inner.style.cursor="default";var input=document.createElement("input");input.setAttribute("placeholder",mxResources.get("searchShapes"));input.setAttribute("type","text");input.style.fontSize="12px";input.style.overflow="hidden";input.style.boxSizing="border-box";input.style.border="solid 1px #d5d5d5";input.style.borderRadius="4px";input.style.width="100%";input.style.outline="none";input.style.padding="6px";inner.appendChild(input);var cross=document.createElement("img");cross.setAttribute("src",Sidebar.prototype.searchImage);cross.setAttribute("title",mxResources.get("search"));cross.style.position="relative";cross.style.left="-18px";if(mxClient.IS_QUIRKS){input.style.height="28px";cross.style.top="-4px"}else{cross.style.top="1px"}cross.style.background="url('"+this.editorUi.editor.transparentImage+"')";var find;inner.appendChild(cross);div.appendChild(inner);var center=document.createElement("center");var button=mxUtils.button(mxResources.get("moreResults"),function(){find()});button.style.display="none";button.style.lineHeight="normal";button.style.marginTop="4px";button.style.marginBottom="8px";center.style.paddingTop="4px";center.style.paddingBottom="8px";center.appendChild(button);div.appendChild(center);var searchTerm="";var active=false;var complete=false;var page=0;var hash=new Object;var count=12;var clearDiv=mxUtils.bind(this,function(){active=false;this.currentSearch=null;var child=div.firstChild;while(child!=null){var next=child.nextSibling;if(child!=inner&&child!=center){child.parentNode.removeChild(child)}child=next}});mxEvent.addListener(cross,"click",function(){if(cross.getAttribute("src")==Dialog.prototype.closeImage){cross.setAttribute("src",Sidebar.prototype.searchImage);cross.setAttribute("title",mxResources.get("search"));button.style.display="none";input.value="";searchTerm="";clearDiv()}input.focus()});find=mxUtils.bind(this,function(){count=4*Math.max(1,Math.floor(this.container.clientWidth/(this.thumbWidth+10)));this.hideTooltip();if(input.value!=""){if(center.parentNode!=null){if(searchTerm!=input.value){clearDiv();searchTerm=input.value;hash=new Object;complete=false;page=0}if(!active&&!complete){button.setAttribute("disabled","true");button.style.display="";button.style.cursor="wait";button.innerHTML=mxResources.get("loading")+"...";active=true;var current=new Object;this.currentSearch=current;this.searchEntries(searchTerm,count,page,mxUtils.bind(this,function(results,len,more,terms){if(this.currentSearch==current){results=results!=null?results:[];active=false;page++;center.parentNode.removeChild(center);this.insertSearchHint(div,searchTerm,count,page,results,len,more,terms);for(var i=0;i<results.length;i++){var elt=results[i]();if(hash[elt.innerHTML]==null){hash[elt.innerHTML]="1";div.appendChild(results[i]())}}if(more){button.removeAttribute("disabled");button.innerHTML=mxResources.get("moreResults")}else{button.innerHTML=mxResources.get("reset");button.style.display="none";complete=true}button.style.cursor="";div.appendChild(center)}}),mxUtils.bind(this,function(){button.style.cursor=""}))}}}else{clearDiv();input.value="";searchTerm="";hash=new Object;button.style.display="none";complete=false;input.focus()}});mxEvent.addListener(input,"keydown",mxUtils.bind(this,function(evt){if(evt.keyCode==13){find()}}));mxEvent.addListener(input,"focus",function(){input.style.paddingRight=""});mxEvent.addListener(input,"blur",function(){input.style.paddingRight="20px"});input.style.paddingRight="20px";mxEvent.addListener(input,"keyup",mxUtils.bind(this,function(evt){if(input.value==""){cross.setAttribute("src",Sidebar.prototype.searchImage);cross.setAttribute("title",mxResources.get("search"))}else{cross.setAttribute("src",Dialog.prototype.closeImage);cross.setAttribute("title",mxResources.get("reset"))}if(input.value==""){complete=true;button.style.display="none"}else if(input.value!=searchTerm){button.style.display="none";complete=false}else if(!active){if(complete){button.style.display="none"}else{button.style.display=""}}}));mxEvent.addListener(input,"mousedown",function(evt){if(evt.stopPropagation){evt.stopPropagation()}evt.cancelBubble=true});mxEvent.addListener(input,"selectstart",function(evt){if(evt.stopPropagation){evt.stopPropagation()}evt.cancelBubble=true});var outer=document.createElement("div");outer.appendChild(div);this.container.appendChild(outer);this.palettes["search"]=[elt,outer]};Sidebar.prototype.insertSearchHint=function(div,searchTerm,count,page,results,len,more,terms){if(results.length==0&&page==1){var err=document.createElement("div");err.className="geTitle";err.style.cssText="background-color:transparent;border-color:transparent;"+"color:gray;padding:6px 0px 0px 0px !important;margin:4px 8px 4px 8px;"+"text-align:center;cursor:default !important";mxUtils.write(err,mxResources.get("noResultsFor",[searchTerm]));div.appendChild(err)}};Sidebar.prototype.createTitle=function(label){var elt=document.createElement("a");elt.setAttribute("href","javascript:void(0);");elt.setAttribute("title",mxResources.get("sidebarTooltip"));elt.className="geTitle";mxUtils.write(elt,label);return elt};Sidebar.prototype.createThumb=function(cells,width,height,parent,title,showLabel,showTitle,realWidth,realHeight){this.graph.labelsVisible=showLabel==null||showLabel;var fo=mxClient.NO_FO;mxClient.NO_FO=Editor.prototype.originalNoForeignObject;this.graph.view.scaleAndTranslate(1,0,0);this.graph.addCells(cells);var bounds=this.graph.getGraphBounds();var s=Math.floor(Math.min((width-2*this.thumbBorder)/bounds.width,(height-2*this.thumbBorder)/bounds.height)*100)/100;this.graph.view.scaleAndTranslate(s,Math.floor((width-bounds.width*s)/2/s-bounds.x),Math.floor((height-bounds.height*s)/2/s-bounds.y));var node=null;if(this.graph.dialect==mxConstants.DIALECT_SVG&&!mxClient.NO_FO){node=this.graph.view.getCanvas().ownerSVGElement.cloneNode(true)}else{node=this.graph.container.cloneNode(false);node.innerHTML=this.graph.container.innerHTML}this.graph.getModel().clear();mxClient.NO_FO=fo;if(mxClient.IS_IE6){parent.style.backgroundImage="url("+this.editorUi.editor.transparentImage+")"}node.style.position="relative";node.style.overflow="hidden";node.style.cursor="move";node.style.left=this.thumbBorder+"px";node.style.top=this.thumbBorder+"px";node.style.width=width+"px";node.style.height=height+"px";node.style.visibility="";node.style.minWidth="";node.style.minHeight="";parent.appendChild(node);if(this.sidebarTitles&&title!=null&&showTitle!=false){var border=mxClient.IS_QUIRKS?2*this.thumbPadding+2:0;parent.style.height=this.thumbHeight+border+this.sidebarTitleSize+8+"px";var div=document.createElement("div");div.style.fontSize=this.sidebarTitleSize+"px";div.style.color="#303030";div.style.textAlign="center";div.style.whiteSpace="nowrap";if(mxClient.IS_IE){div.style.height=this.sidebarTitleSize+12+"px"}div.style.paddingTop="4px";mxUtils.write(div,title);parent.appendChild(div)}return bounds};Sidebar.prototype.createItem=function(cells,title,showLabel,showTitle,width,height,allowCellsInserted){var elt=document.createElement("a");elt.setAttribute("href","javascript:void(0);");elt.className="geItem";elt.style.overflow="hidden";var border=mxClient.IS_QUIRKS?8+2*this.thumbPadding:2*this.thumbBorder;elt.style.width=this.thumbWidth+border+"px";elt.style.height=this.thumbHeight+border+"px";elt.style.padding=this.thumbPadding+"px";if(mxClient.IS_IE6){elt.style.border="none"}mxEvent.addListener(elt,"click",function(evt){mxEvent.consume(evt)});this.createThumb(cells,this.thumbWidth,this.thumbHeight,elt,title,showLabel,showTitle,width,height);var bounds=new mxRectangle(0,0,width,height);if(cells.length>1||cells[0].vertex){var ds=this.createDragSource(elt,this.createDropHandler(cells,true,allowCellsInserted,bounds),this.createDragPreview(width,height),cells,bounds);this.addClickHandler(elt,ds,cells);ds.isGuidesEnabled=mxUtils.bind(this,function(){return this.editorUi.editor.graph.graphHandler.guidesEnabled})}else if(cells[0]!=null&&cells[0].edge){var ds=this.createDragSource(elt,this.createDropHandler(cells,false,allowCellsInserted,bounds),this.createDragPreview(width,height),cells,bounds);this.addClickHandler(elt,ds,cells)}if(!mxClient.IS_IOS){mxEvent.addGestureListeners(elt,null,mxUtils.bind(this,function(evt){if(mxEvent.isMouseEvent(evt)){this.showTooltip(elt,cells,bounds.width,bounds.height,title,showLabel)}}))}return elt};Sidebar.prototype.updateShapes=function(source,targets){var graph=this.editorUi.editor.graph;var sourceCellStyle=graph.getCellStyle(source);var result=[];graph.model.beginUpdate();try{var cellStyle=graph.getModel().getStyle(source);var styles=["shadow","dashed","dashPattern","fontFamily","fontSize","fontColor","align","startFill","startSize","endFill","endSize","strokeColor","strokeWidth","fillColor","gradientColor","html","part","noEdgeStyle","edgeStyle","elbow","childLayout"];for(var i=0;i<targets.length;i++){var targetCell=targets[i];if(graph.getModel().isVertex(targetCell)==graph.getModel().isVertex(source)||graph.getModel().isEdge(targetCell)==graph.getModel().isEdge(source)){var state=graph.view.getState(targetCell);var style=state!=null?state.style:graph.getCellStyle(targets[i]);graph.getModel().setStyle(targetCell,cellStyle);if(state!=null&&mxUtils.getValue(state.style,"composite","0")=="1"){var childCount=graph.model.getChildCount(targetCell);for(var j=childCount;j>=0;j--){graph.model.remove(graph.model.getChildAt(targetCell,j))}}if(style!=null){if(style[mxConstants.STYLE_SHAPE]=="umlLifeline"&&sourceCellStyle[mxConstants.STYLE_SHAPE]!="umlLifeline"){graph.setCellStyles(mxConstants.STYLE_SHAPE,"umlLifeline",[targetCell]);graph.setCellStyles("participant",sourceCellStyle[mxConstants.STYLE_SHAPE],[targetCell])}for(var j=0;j<styles.length;j++){var value=style[styles[j]];if(value!=null){graph.setCellStyles(styles[j],value,[targetCell])}}}result.push(targetCell)}}}finally{graph.model.endUpdate()}return result};Sidebar.prototype.createDropHandler=function(cells,allowSplit,allowCellsInserted,bounds){allowCellsInserted=allowCellsInserted!=null?allowCellsInserted:true;return mxUtils.bind(this,function(graph,evt,target,x,y){if(graph.isEnabled()){cells=graph.getImportableCells(cells);if(cells.length>0){graph.stopEditing();var validDropTarget=target!=null&&!mxEvent.isAltDown(evt)?graph.isValidDropTarget(target,cells,evt):false;var select=null;if(target!=null&&!validDropTarget){target=null}if(!graph.isCellLocked(target||graph.getDefaultParent())){graph.model.beginUpdate();try{x=Math.round(x);y=Math.round(y);if(allowSplit&&graph.isSplitTarget(target,cells,evt)){var clones=graph.cloneCells(cells);graph.splitEdge(target,clones,null,x-bounds.width/2,y-bounds.height/2);select=clones}else if(cells.length>0){select=graph.importCells(cells,x,y,target)}if(graph.layoutManager!=null){var layout=graph.layoutManager.getLayout(target);if(layout!=null){var s=graph.view.scale;var tr=graph.view.translate;var tx=(x+tr.x)*s;var ty=(y+tr.y)*s;for(var i=0;i<select.length;i++){layout.moveCell(select[i],tx,ty)}}}if(allowCellsInserted){graph.fireEvent(new mxEventObject("cellsInserted","cells",select))}}finally{graph.model.endUpdate()}if(select!=null&&select.length>0){graph.scrollCellToVisible(select[0]);graph.setSelectionCells(select)}}}mxEvent.consume(evt)}})};Sidebar.prototype.createDragPreview=function(width,height){var elt=document.createElement("div");elt.style.border="1px dashed black";elt.style.width=width+"px";elt.style.height=height+"px";return elt};Sidebar.prototype.dropAndConnect=function(source,targets,direction,dropCellIndex){var geo=this.getDropAndConnectGeometry(source,targets[dropCellIndex],direction,targets);if(geo!=null){var graph=this.editorUi.editor.graph;var tmp=[];graph.model.beginUpdate();try{var sourceGeo=graph.getCellGeometry(source);var geo2=graph.getCellGeometry(targets[dropCellIndex]);var targetParent=graph.model.getParent(source);var validLayout=true;if(graph.layoutManager!=null){var layout=graph.layoutManager.getLayout(targetParent);if(layout!=null&&layout.constructor==mxStackLayout){validLayout=false;var tmp=graph.view.getState(targetParent);if(tmp!=null){var offset=new mxPoint(tmp.x/graph.view.scale-graph.view.translate.x,tmp.y/graph.view.scale-graph.view.translate.y);geo.x+=offset.x;geo.y+=offset.y;var pt=geo.getTerminalPoint(false);if(pt!=null){pt.x+=offset.x;pt.y+=offset.y}}}}var dx=geo2.x;var dy=geo2.y;if(graph.model.isEdge(targets[dropCellIndex])){dx=0;dy=0}var useParent=graph.model.isEdge(source)||sourceGeo!=null&&!sourceGeo.relative&&validLayout;targets=graph.importCells(targets,geo.x-(useParent?dx:0),geo.y-(useParent?dy:0),useParent?targetParent:null);tmp=targets;if(graph.model.isEdge(source)){graph.model.setTerminal(source,targets[dropCellIndex],direction==mxConstants.DIRECTION_NORTH)}else if(graph.model.isEdge(targets[dropCellIndex])){graph.model.setTerminal(targets[dropCellIndex],source,true);var geo3=graph.getCellGeometry(targets[dropCellIndex]);geo3.points=null;if(geo3.getTerminalPoint(false)!=null){geo3.setTerminalPoint(geo.getTerminalPoint(false),false)}else if(useParent&&graph.model.isVertex(targetParent)){var tmpState=graph.view.getState(targetParent);var offset=new mxPoint(tmpState.x/graph.view.scale-graph.view.translate.x,tmpState.y/graph.view.scale-graph.view.translate.y);graph.cellsMoved(targets,offset.x,offset.y,null,null,true)}}else{geo2=graph.getCellGeometry(targets[dropCellIndex]);dx=geo.x-Math.round(geo2.x);dy=geo.y-Math.round(geo2.y);geo.x=Math.round(geo2.x);geo.y=Math.round(geo2.y);graph.model.setGeometry(targets[dropCellIndex],geo);graph.cellsMoved(targets,dx,dy,null,null,true);tmp=targets.slice();targets.push(graph.insertEdge(null,null,"",source,targets[dropCellIndex],graph.createCurrentEdgeStyle()))}graph.fireEvent(new mxEventObject("cellsInserted","cells",targets))}finally{graph.model.endUpdate()}graph.setSelectionCells(tmp)}};Sidebar.prototype.getDropAndConnectGeometry=function(source,target,direction,targets){var graph=this.editorUi.editor.graph;var view=graph.view;var keepSize=targets.length>1;var geo=graph.getCellGeometry(source);var geo2=graph.getCellGeometry(target);if(geo!=null&&geo2!=null){geo2=geo2.clone();if(graph.model.isEdge(source)){var state=graph.view.getState(source);var pts=state.absolutePoints;var p0=pts[0];var pe=pts[pts.length-1];if(direction==mxConstants.DIRECTION_NORTH){geo2.x=p0.x/view.scale-view.translate.x-geo2.width/2;geo2.y=p0.y/view.scale-view.translate.y-geo2.height/2}else{geo2.x=pe.x/view.scale-view.translate.x-geo2.width/2;geo2.y=pe.y/view.scale-view.translate.y-geo2.height/2}}else{if(geo.relative){var state=graph.view.getState(source);geo=geo.clone();geo.x=(state.x-view.translate.x)/view.scale;geo.y=(state.y-view.translate.y)/view.scale}var length=graph.defaultEdgeLength;if(graph.model.isEdge(target)&&geo2.getTerminalPoint(true)!=null&&geo2.getTerminalPoint(false)!=null){var p0=geo2.getTerminalPoint(true);var pe=geo2.getTerminalPoint(false);var dx=pe.x-p0.x;var dy=pe.y-p0.y;length=Math.sqrt(dx*dx+dy*dy);geo2.x=geo.getCenterX();geo2.y=geo.getCenterY();geo2.width=1;geo2.height=1;if(direction==mxConstants.DIRECTION_NORTH){geo2.height=length;geo2.y=geo.y-length;geo2.setTerminalPoint(new mxPoint(geo2.x,geo2.y),false)}else if(direction==mxConstants.DIRECTION_EAST){geo2.width=length;geo2.x=geo.x+geo.width;geo2.setTerminalPoint(new mxPoint(geo2.x+geo2.width,geo2.y),false)}else if(direction==mxConstants.DIRECTION_SOUTH){geo2.height=length;geo2.y=geo.y+geo.height;geo2.setTerminalPoint(new mxPoint(geo2.x,geo2.y+geo2.height),false)}else if(direction==mxConstants.DIRECTION_WEST){geo2.width=length;geo2.x=geo.x-length;geo2.setTerminalPoint(new mxPoint(geo2.x,geo2.y),false)}}else{if(!keepSize&&geo2.width>45&&geo2.height>45&&geo.width>45&&geo.height>45){geo2.width=geo2.width*(geo.height/geo2.height);geo2.height=geo.height}geo2.x=geo.x+geo.width/2-geo2.width/2;geo2.y=geo.y+geo.height/2-geo2.height/2;if(direction==mxConstants.DIRECTION_NORTH){geo2.y=geo2.y-geo.height/2-geo2.height/2-length}else if(direction==mxConstants.DIRECTION_EAST){geo2.x=geo2.x+geo.width/2+geo2.width/2+length}else if(direction==mxConstants.DIRECTION_SOUTH){geo2.y=geo2.y+geo.height/2+geo2.height/2+length}else if(direction==mxConstants.DIRECTION_WEST){geo2.x=geo2.x-geo.width/2-geo2.width/2-length}if(graph.model.isEdge(target)&&geo2.getTerminalPoint(true)!=null&&target.getTerminal(false)!=null){var targetGeo=graph.getCellGeometry(target.getTerminal(false));if(targetGeo!=null){if(direction==mxConstants.DIRECTION_NORTH){geo2.x-=targetGeo.getCenterX();geo2.y-=targetGeo.getCenterY()+targetGeo.height/2}else if(direction==mxConstants.DIRECTION_EAST){geo2.x-=targetGeo.getCenterX()-targetGeo.width/2;geo2.y-=targetGeo.getCenterY()}else if(direction==mxConstants.DIRECTION_SOUTH){geo2.x-=targetGeo.getCenterX();geo2.y-=targetGeo.getCenterY()-targetGeo.height/2}else if(direction==mxConstants.DIRECTION_WEST){geo2.x-=targetGeo.getCenterX()+targetGeo.width/2;geo2.y-=targetGeo.getCenterY()}}}}}}return geo2};Sidebar.prototype.createDragSource=function(elt,dropHandler,preview,cells,bounds){var ui=this.editorUi;var graph=ui.editor.graph;var freeSourceEdge=null;var firstVertex=null;var sidebar=this;for(var i=0;i<cells.length;i++){if(firstVertex==null&&this.editorUi.editor.graph.model.isVertex(cells[i])){firstVertex=i}else if(freeSourceEdge==null&&this.editorUi.editor.graph.model.isEdge(cells[i])&&this.editorUi.editor.graph.model.getTerminal(cells[i],true)==null){freeSourceEdge=i}if(firstVertex!=null&&freeSourceEdge!=null){break}}var dragSource=mxUtils.makeDraggable(elt,this.editorUi.editor.graph,mxUtils.bind(this,function(graph,evt,target,x,y){if(this.updateThread!=null){window.clearTimeout(this.updateThread)}if(cells!=null&&currentStyleTarget!=null&&activeArrow==styleTarget){var tmp=graph.isCellSelected(currentStyleTarget.cell)?graph.getSelectionCells():[currentStyleTarget.cell];var updatedCells=this.updateShapes(graph.model.isEdge(currentStyleTarget.cell)?cells[0]:cells[firstVertex],tmp);graph.setSelectionCells(updatedCells)}else if(cells!=null&&activeArrow!=null&&currentTargetState!=null&&activeArrow!=styleTarget){var index=graph.model.isEdge(currentTargetState.cell)||freeSourceEdge==null?firstVertex:freeSourceEdge;this.dropAndConnect(currentTargetState.cell,cells,direction,index)}else{dropHandler.apply(this,arguments)}if(this.editorUi.hoverIcons!=null){this.editorUi.hoverIcons.update(graph.view.getState(graph.getSelectionCell()))}}),preview,0,0,this.editorUi.editor.graph.autoscroll,true,true);this.editorUi.editor.graph.addListener(mxEvent.ESCAPE,function(sender,evt){if(dragSource.isActive()){dragSource.reset()}});var mouseDown=dragSource.mouseDown;dragSource.mouseDown=function(evt){if(!mxEvent.isPopupTrigger(evt)&&!mxEvent.isMultiTouchEvent(evt)){graph.stopEditing();mouseDown.apply(this,arguments)}};function createArrow(img,tooltip){var arrow=null;if(mxClient.IS_IE&&!mxClient.IS_SVG){if(mxClient.IS_IE6&&document.compatMode!="CSS1Compat"){arrow=document.createElement(mxClient.VML_PREFIX+":image");arrow.setAttribute("src",img.src);arrow.style.borderStyle="none"}else{arrow=document.createElement("div");arrow.style.backgroundImage="url("+img.src+")";arrow.style.backgroundPosition="center";arrow.style.backgroundRepeat="no-repeat"}arrow.style.width=img.width+4+"px";arrow.style.height=img.height+4+"px";arrow.style.display=mxClient.IS_QUIRKS?"inline":"inline-block"}else{arrow=mxUtils.createImage(img.src);arrow.style.width=img.width+"px";arrow.style.height=img.height+"px"}if(tooltip!=null){arrow.setAttribute("title",tooltip)}mxUtils.setOpacity(arrow,img==this.refreshTarget?30:20);arrow.style.position="absolute";arrow.style.cursor="crosshair";return arrow}var currentTargetState=null;var currentStateHandle=null;var currentStyleTarget=null;var activeTarget=false;var arrowUp=createArrow(this.triangleUp,mxResources.get("connect"));var arrowRight=createArrow(this.triangleRight,mxResources.get("connect"));var arrowDown=createArrow(this.triangleDown,mxResources.get("connect"));var arrowLeft=createArrow(this.triangleLeft,mxResources.get("connect"));var styleTarget=createArrow(this.refreshTarget,mxResources.get("replace"));var styleTargetParent=null;var roundSource=createArrow(this.roundDrop);var roundTarget=createArrow(this.roundDrop);var direction=mxConstants.DIRECTION_NORTH;var activeArrow=null;function checkArrow(x,y,bounds,arrow){if(arrow.parentNode!=null){if(mxUtils.contains(bounds,x,y)){mxUtils.setOpacity(arrow,100);activeArrow=arrow}else{mxUtils.setOpacity(arrow,arrow==styleTarget?30:20)}}return bounds}var dsCreatePreviewElement=dragSource.createPreviewElement;dragSource.createPreviewElement=function(graph){var elt=dsCreatePreviewElement.apply(this,arguments);if(mxClient.IS_SVG){elt.style.pointerEvents="none"}this.previewElementWidth=elt.style.width;this.previewElementHeight=elt.style.height;return elt};var dragEnter=dragSource.dragEnter;dragSource.dragEnter=function(graph,evt){if(ui.hoverIcons!=null){ui.hoverIcons.setDisplay("none")}dragEnter.apply(this,arguments)};var dragExit=dragSource.dragExit;dragSource.dragExit=function(graph,evt){if(ui.hoverIcons!=null){ui.hoverIcons.setDisplay("")}dragExit.apply(this,arguments)};dragSource.dragOver=function(graph,evt){mxDragSource.prototype.dragOver.apply(this,arguments);if(this.currentGuide!=null&&activeArrow!=null){this.currentGuide.hide()}if(this.previewElement!=null){var view=graph.view;if(currentStyleTarget!=null&&activeArrow==styleTarget){this.previewElement.style.display=graph.model.isEdge(currentStyleTarget.cell)?"none":"";this.previewElement.style.left=currentStyleTarget.x+"px";this.previewElement.style.top=currentStyleTarget.y+"px";this.previewElement.style.width=currentStyleTarget.width+"px";this.previewElement.style.height=currentStyleTarget.height+"px"}else if(currentTargetState!=null&&activeArrow!=null){var index=graph.model.isEdge(currentTargetState.cell)||freeSourceEdge==null?firstVertex:freeSourceEdge;var geo=sidebar.getDropAndConnectGeometry(currentTargetState.cell,cells[index],direction,cells);var geo2=!graph.model.isEdge(currentTargetState.cell)?graph.getCellGeometry(currentTargetState.cell):null;var geo3=graph.getCellGeometry(cells[index]);var parent=graph.model.getParent(currentTargetState.cell);var dx=view.translate.x*view.scale;var dy=view.translate.y*view.scale;if(geo2!=null&&!geo2.relative&&graph.model.isVertex(parent)){var pState=view.getState(parent);dx=pState.x;dy=pState.y}var dx2=geo3.x;var dy2=geo3.y;if(graph.model.isEdge(cells[index])){dx2=0;dy2=0}this.previewElement.style.left=(geo.x-dx2)*view.scale+dx+"px";this.previewElement.style.top=(geo.y-dy2)*view.scale+dy+"px";if(cells.length==1){this.previewElement.style.width=geo.width*view.scale+"px";this.previewElement.style.height=geo.height*view.scale+"px"}this.previewElement.style.display=""}else if(dragSource.currentHighlight.state!=null&&graph.model.isEdge(dragSource.currentHighlight.state.cell)){this.previewElement.style.left=Math.round(parseInt(this.previewElement.style.left)-bounds.width*view.scale/2)+"px";this.previewElement.style.top=Math.round(parseInt(this.previewElement.style.top)-bounds.height*view.scale/2)+"px"}else{this.previewElement.style.width=this.previewElementWidth;this.previewElement.style.height=this.previewElementHeight;this.previewElement.style.display=""}}};var startTime=(new Date).getTime();var timeOnTarget=0;var prev=null;var sourceCellStyle=this.editorUi.editor.graph.getCellStyle(cells[0]);dragSource.getDropTarget=mxUtils.bind(this,function(graph,x,y,evt){var cell=!mxEvent.isAltDown(evt)&&cells!=null?graph.getCellAt(x,y):null;if(cell!=null&&!this.graph.isCellConnectable(cell)){var parent=this.graph.getModel().getParent(cell);if(this.graph.getModel().isVertex(parent)&&this.graph.isCellConnectable(parent)){cell=parent}}if(graph.isCellLocked(cell)){cell=null}var state=graph.view.getState(cell);activeArrow=null;var bbox=null;if(prev!=state){prev=state;startTime=(new Date).getTime();timeOnTarget=0;if(this.updateThread!=null){window.clearTimeout(this.updateThread)}if(state!=null){this.updateThread=window.setTimeout(function(){if(activeArrow==null){prev=state;dragSource.getDropTarget(graph,x,y,evt)}},this.dropTargetDelay+10)}}else{timeOnTarget=(new Date).getTime()-startTime}if(timeOnTarget<2500&&state!=null&&!mxEvent.isShiftDown(evt)&&(mxUtils.getValue(state.style,mxConstants.STYLE_SHAPE)!=mxUtils.getValue(sourceCellStyle,mxConstants.STYLE_SHAPE)&&mxUtils.getValue(state.style,mxConstants.STYLE_STROKECOLOR,mxConstants.NONE)!=mxConstants.NONE||mxUtils.getValue(sourceCellStyle,mxConstants.STYLE_SHAPE)=="image"||timeOnTarget>1500||graph.model.isEdge(state.cell))&&timeOnTarget>this.dropTargetDelay&&(graph.model.isVertex(state.cell)&&firstVertex!=null||graph.model.isEdge(state.cell)&&graph.model.isEdge(cells[0]))){currentStyleTarget=state;var tmp=graph.model.isEdge(state.cell)?graph.view.getPoint(state):new mxPoint(state.getCenterX(),state.getCenterY());tmp=new mxRectangle(tmp.x-this.refreshTarget.width/2,tmp.y-this.refreshTarget.height/2,this.refreshTarget.width,this.refreshTarget.height);styleTarget.style.left=Math.floor(tmp.x)+"px";styleTarget.style.top=Math.floor(tmp.y)+"px";if(styleTargetParent==null){graph.container.appendChild(styleTarget);styleTargetParent=styleTarget.parentNode}checkArrow(x,y,tmp,styleTarget)}else if(currentStyleTarget==null||!mxUtils.contains(currentStyleTarget,x,y)||timeOnTarget>1500&&!mxEvent.isShiftDown(evt)){currentStyleTarget=null;if(styleTargetParent!=null){styleTarget.parentNode.removeChild(styleTarget);styleTargetParent=null}}else if(currentStyleTarget!=null&&styleTargetParent!=null){var tmp=graph.model.isEdge(currentStyleTarget.cell)?graph.view.getPoint(currentStyleTarget):new mxPoint(currentStyleTarget.getCenterX(),currentStyleTarget.getCenterY());tmp=new mxRectangle(tmp.x-this.refreshTarget.width/2,tmp.y-this.refreshTarget.height/2,this.refreshTarget.width,this.refreshTarget.height);checkArrow(x,y,tmp,styleTarget)}if(activeTarget&&currentTargetState!=null&&!mxEvent.isAltDown(evt)&&activeArrow==null){bbox=mxRectangle.fromRectangle(currentTargetState);if(graph.model.isEdge(currentTargetState.cell)){var pts=currentTargetState.absolutePoints;if(roundSource.parentNode!=null){var p0=pts[0];bbox.add(checkArrow(x,y,new mxRectangle(p0.x-this.roundDrop.width/2,p0.y-this.roundDrop.height/2,this.roundDrop.width,this.roundDrop.height),roundSource))}if(roundTarget.parentNode!=null){var pe=pts[pts.length-1];bbox.add(checkArrow(x,y,new mxRectangle(pe.x-this.roundDrop.width/2,pe.y-this.roundDrop.height/2,this.roundDrop.width,this.roundDrop.height),roundTarget))}}else{var bds=mxRectangle.fromRectangle(currentTargetState);if(currentTargetState.shape!=null&&currentTargetState.shape.boundingBox!=null){bds=mxRectangle.fromRectangle(currentTargetState.shape.boundingBox)}bds.grow(this.graph.tolerance);bds.grow(HoverIcons.prototype.arrowSpacing);var handler=this.graph.selectionCellsHandler.getHandler(currentTargetState.cell);if(handler!=null){bds.x-=handler.horizontalOffset/2;bds.y-=handler.verticalOffset/2;bds.width+=handler.horizontalOffset;bds.height+=handler.verticalOffset;if(handler.rotationShape!=null&&handler.rotationShape.node!=null&&handler.rotationShape.node.style.visibility!="hidden"&&handler.rotationShape.node.style.display!="none"&&handler.rotationShape.boundingBox!=null){bds.add(handler.rotationShape.boundingBox)}}bbox.add(checkArrow(x,y,new mxRectangle(currentTargetState.getCenterX()-this.triangleUp.width/2,bds.y-this.triangleUp.height,this.triangleUp.width,this.triangleUp.height),arrowUp));bbox.add(checkArrow(x,y,new mxRectangle(bds.x+bds.width,currentTargetState.getCenterY()-this.triangleRight.height/2,this.triangleRight.width,this.triangleRight.height),arrowRight));bbox.add(checkArrow(x,y,new mxRectangle(currentTargetState.getCenterX()-this.triangleDown.width/2,bds.y+bds.height,this.triangleDown.width,this.triangleDown.height),arrowDown));bbox.add(checkArrow(x,y,new mxRectangle(bds.x-this.triangleLeft.width,currentTargetState.getCenterY()-this.triangleLeft.height/2,this.triangleLeft.width,this.triangleLeft.height),arrowLeft))}if(bbox!=null){bbox.grow(10)}}direction=mxConstants.DIRECTION_NORTH;if(activeArrow==arrowRight){direction=mxConstants.DIRECTION_EAST}else if(activeArrow==arrowDown||activeArrow==roundTarget){direction=mxConstants.DIRECTION_SOUTH}else if(activeArrow==arrowLeft){direction=mxConstants.DIRECTION_WEST}if(currentStyleTarget!=null&&activeArrow==styleTarget){state=currentStyleTarget}var validTarget=(firstVertex==null||graph.isCellConnectable(cells[firstVertex]))&&(graph.model.isEdge(cell)&&firstVertex!=null||graph.model.isVertex(cell)&&graph.isCellConnectable(cell));if(currentTargetState!=null&&timeOnTarget>=5e3||currentTargetState!=state&&(bbox==null||!mxUtils.contains(bbox,x,y)||timeOnTarget>500&&activeArrow==null&&validTarget)){activeTarget=false;currentTargetState=timeOnTarget<5e3&&timeOnTarget>this.dropTargetDelay||graph.model.isEdge(cell)?state:null;if(currentTargetState!=null&&validTarget){var elts=[roundSource,roundTarget,arrowUp,arrowRight,arrowDown,arrowLeft];for(var i=0;i<elts.length;i++){if(elts[i].parentNode!=null){elts[i].parentNode.removeChild(elts[i])}}if(graph.model.isEdge(cell)){var pts=state.absolutePoints;if(pts!=null){var p0=pts[0];var pe=pts[pts.length-1];var tol=graph.tolerance;var box=new mxRectangle(x-tol,y-tol,2*tol,2*tol);roundSource.style.left=Math.floor(p0.x-this.roundDrop.width/2)+"px";roundSource.style.top=Math.floor(p0.y-this.roundDrop.height/2)+"px";roundTarget.style.left=Math.floor(pe.x-this.roundDrop.width/2)+"px";roundTarget.style.top=Math.floor(pe.y-this.roundDrop.height/2)+"px";if(graph.model.getTerminal(cell,true)==null){graph.container.appendChild(roundSource)}if(graph.model.getTerminal(cell,false)==null){graph.container.appendChild(roundTarget)}}}else{var bds=mxRectangle.fromRectangle(state);if(state.shape!=null&&state.shape.boundingBox!=null){bds=mxRectangle.fromRectangle(state.shape.boundingBox)}bds.grow(this.graph.tolerance);bds.grow(HoverIcons.prototype.arrowSpacing);var handler=this.graph.selectionCellsHandler.getHandler(state.cell);if(handler!=null){bds.x-=handler.horizontalOffset/2;bds.y-=handler.verticalOffset/2;bds.width+=handler.horizontalOffset;bds.height+=handler.verticalOffset;if(handler.rotationShape!=null&&handler.rotationShape.node!=null&&handler.rotationShape.node.style.visibility!="hidden"&&handler.rotationShape.node.style.display!="none"&&handler.rotationShape.boundingBox!=null){bds.add(handler.rotationShape.boundingBox)}}arrowUp.style.left=Math.floor(state.getCenterX()-this.triangleUp.width/2)+"px";arrowUp.style.top=Math.floor(bds.y-this.triangleUp.height)+"px";arrowRight.style.left=Math.floor(bds.x+bds.width)+"px";arrowRight.style.top=Math.floor(state.getCenterY()-this.triangleRight.height/2)+"px";arrowDown.style.left=arrowUp.style.left;arrowDown.style.top=Math.floor(bds.y+bds.height)+"px";arrowLeft.style.left=Math.floor(bds.x-this.triangleLeft.width)+"px";arrowLeft.style.top=arrowRight.style.top;if(state.style["portConstraint"]!="eastwest"){graph.container.appendChild(arrowUp);graph.container.appendChild(arrowDown)}graph.container.appendChild(arrowRight);graph.container.appendChild(arrowLeft)}if(state!=null){currentStateHandle=graph.selectionCellsHandler.getHandler(state.cell);if(currentStateHandle!=null&&currentStateHandle.setHandlesVisible!=null){currentStateHandle.setHandlesVisible(false)}}activeTarget=true}else{var elts=[roundSource,roundTarget,arrowUp,arrowRight,arrowDown,arrowLeft];for(var i=0;i<elts.length;i++){if(elts[i].parentNode!=null){elts[i].parentNode.removeChild(elts[i])}}}}if(!activeTarget&&currentStateHandle!=null){currentStateHandle.setHandlesVisible(true)}var target=(!mxEvent.isAltDown(evt)||mxEvent.isShiftDown(evt))&&!(currentStyleTarget!=null&&activeArrow==styleTarget)?mxDragSource.prototype.getDropTarget.apply(this,arguments):null;var model=graph.getModel();if(target!=null){if(activeArrow!=null||!graph.isSplitTarget(target,cells,evt)){while(target!=null&&!graph.isValidDropTarget(target,cells,evt)&&model.isVertex(model.getParent(target))){target=model.getParent(target)}if(graph.view.currentRoot==target||!graph.isValidRoot(target)&&graph.getModel().getChildCount(target)==0||graph.isCellLocked(target)||model.isEdge(target)){target=null}}}return target});dragSource.stopDrag=function(){mxDragSource.prototype.stopDrag.apply(this,arguments);var elts=[roundSource,roundTarget,styleTarget,arrowUp,arrowRight,arrowDown,arrowLeft];for(var i=0;i<elts.length;i++){if(elts[i].parentNode!=null){elts[i].parentNode.removeChild(elts[i])}}if(currentTargetState!=null&&currentStateHandle!=null){currentStateHandle.reset()}currentStateHandle=null;currentTargetState=null;currentStyleTarget=null;styleTargetParent=null;activeArrow=null};return dragSource};Sidebar.prototype.itemClicked=function(cells,ds,evt,elt){var graph=this.editorUi.editor.graph;if(mxEvent.isAltDown(evt)){if(graph.getSelectionCount()==1&&graph.model.isVertex(graph.getSelectionCell())){var firstVertex=null;for(var i=0;i<cells.length&&firstVertex==null;i++){if(graph.model.isVertex(cells[i])){firstVertex=i}}if(firstVertex!=null){this.dropAndConnect(graph.getSelectionCell(),cells,mxEvent.isMetaDown(evt)||mxEvent.isControlDown(evt)?mxEvent.isShiftDown(evt)?mxConstants.DIRECTION_WEST:mxConstants.DIRECTION_NORTH:mxEvent.isShiftDown(evt)?mxConstants.DIRECTION_EAST:mxConstants.DIRECTION_SOUTH,firstVertex);graph.scrollCellToVisible(graph.getSelectionCell())}}}else if(mxEvent.isShiftDown(evt)){if(!graph.isSelectionEmpty()){this.updateShapes(cells[0],graph.getSelectionCells());graph.scrollCellToVisible(graph.getSelectionCell())}}else{var pt=graph.getFreeInsertPoint();ds.drop(graph,evt,null,pt.x,pt.y);if(this.editorUi.hoverIcons!=null&&mxEvent.isTouchEvent(evt)){this.editorUi.hoverIcons.update(graph.view.getState(graph.getSelectionCell()))}}};Sidebar.prototype.addClickHandler=function(elt,ds,cells){var graph=this.editorUi.editor.graph;var oldMouseUp=ds.mouseUp;var first=null;mxEvent.addGestureListeners(elt,function(evt){first=new mxPoint(mxEvent.getClientX(evt),mxEvent.getClientY(evt))});ds.mouseUp=mxUtils.bind(this,function(evt){if(!mxEvent.isPopupTrigger(evt)&&this.currentGraph==null&&first!=null){var tol=graph.tolerance;if(Math.abs(first.x-mxEvent.getClientX(evt))<=tol&&Math.abs(first.y-mxEvent.getClientY(evt))<=tol){this.itemClicked(cells,ds,evt,elt)}}oldMouseUp.apply(ds,arguments);first=null;this.currentElt=elt})};Sidebar.prototype.createVertexTemplateEntry=function(style,width,height,value,title,showLabel,showTitle,tags){tags=tags!=null&&tags.length>0?tags:title.toLowerCase();return this.addEntry(tags,mxUtils.bind(this,function(){return this.createVertexTemplate(style,width,height,value,title,showLabel,showTitle)}))};Sidebar.prototype.createVertexTemplate=function(style,width,height,value,title,showLabel,showTitle,allowCellsInserted){var cells=[new mxCell(value!=null?value:"",new mxGeometry(0,0,width,height),style)];cells[0].vertex=true;return this.createVertexTemplateFromCells(cells,width,height,title,showLabel,showTitle,allowCellsInserted)};Sidebar.prototype.createVertexTemplateFromCells=function(cells,width,height,title,showLabel,showTitle,allowCellsInserted){return this.createItem(cells,title,showLabel,showTitle,width,height,allowCellsInserted)};Sidebar.prototype.createEdgeTemplateEntry=function(style,width,height,value,title,showLabel,tags,allowCellsInserted){tags=tags!=null&&tags.length>0?tags:title.toLowerCase();return this.addEntry(tags,mxUtils.bind(this,function(){return this.createEdgeTemplate(style,width,height,value,title,showLabel,allowCellsInserted)}))};Sidebar.prototype.createEdgeTemplate=function(style,width,height,value,title,showLabel,allowCellsInserted){var cell=new mxCell(value!=null?value:"",new mxGeometry(0,0,width,height),style);cell.geometry.setTerminalPoint(new mxPoint(0,height),true);cell.geometry.setTerminalPoint(new mxPoint(width,0),false);cell.geometry.relative=true;cell.edge=true;return this.createEdgeTemplateFromCells([cell],width,height,title,showLabel,allowCellsInserted)};Sidebar.prototype.createEdgeTemplateFromCells=function(cells,width,height,title,showLabel,allowCellsInserted){return this.createItem(cells,title,showLabel,true,width,height,allowCellsInserted)};Sidebar.prototype.addPaletteFunctions=function(id,title,expanded,fns){this.addPalette(id,title,expanded,mxUtils.bind(this,function(content){for(var i=0;i<fns.length;i++){content.appendChild(fns[i](content))}}))};Sidebar.prototype.addPalette=function(id,title,expanded,onInit){var elt=this.createTitle(title);this.container.appendChild(elt);var div=document.createElement("div");div.className="geSidebar";if(mxClient.IS_POINTER){div.style.touchAction="none"}mxEvent.addListener(div,"mousemove",mxUtils.bind(this,function(evt){if(mxEvent.getSource(evt)==div){div.setAttribute("title",mxResources.get("sidebarTooltip"))}else{div.removeAttribute("title")}}));if(expanded){onInit(div);onInit=null}else{div.style.display="none"}this.addFoldingHandler(elt,div,onInit);var outer=document.createElement("div");outer.appendChild(div);this.container.appendChild(outer);if(id!=null){this.palettes[id]=[elt,outer]}return div};Sidebar.prototype.addFoldingHandler=function(title,content,funct){var initialized=false;if(!mxClient.IS_IE||document.documentMode>=8){title.style.backgroundImage=content.style.display=="none"?"url('"+this.collapsedImage+"')":"url('"+this.expandedImage+"')"}title.style.backgroundRepeat="no-repeat";title.style.backgroundPosition="0% 50%";mxEvent.addListener(title,"click",mxUtils.bind(this,function(evt){if(content.style.display=="none"){if(!initialized){initialized=true;if(funct!=null){title.style.cursor="wait";var prev=title.innerHTML;title.innerHTML=mxResources.get("loading")+"...";window.setTimeout(function(){var fo=mxClient.NO_FO;mxClient.NO_FO=Editor.prototype.originalNoForeignObject;funct(content);mxClient.NO_FO=fo;content.style.display="block";title.style.cursor="";title.innerHTML=prev},0)}else{content.style.display="block"}}else{content.style.display="block"}title.style.backgroundImage="url('"+this.expandedImage+"')"}else{title.style.backgroundImage="url('"+this.collapsedImage+"')";content.style.display="none"}mxEvent.consume(evt)}))};Sidebar.prototype.removePalette=function(id){var elts=this.palettes[id];if(elts!=null){this.palettes[id]=null;for(var i=0;i<elts.length;i++){this.container.removeChild(elts[i])}return true}return false};Sidebar.prototype.addImagePalette=function(id,title,prefix,postfix,items,titles,tags){var showTitles=titles!=null;var fns=[];for(var i=0;i<items.length;i++){mxUtils.bind(this,function(item,title,tmpTags){if(tmpTags==null){var slash=item.lastIndexOf("/");var dot=item.lastIndexOf(".");tmpTags=item.substring(slash>=0?slash+1:0,dot>=0?dot:item.length).replace(/[-_]/g," ")}fns.push(this.createVertexTemplateEntry("image;html=1;labelBackgroundColor=#ffffff;image="+prefix+item+postfix,this.defaultImageWidth,this.defaultImageHeight,"",title,title!=null,null,this.filterTags(tmpTags)))})(items[i],titles!=null?titles[i]:null,tags!=null?tags[items[i]]:null)}this.addPaletteFunctions(id,title,false,fns)};Sidebar.prototype.getTagsForStencil=function(packageName,stencilName,moreTags){var tags=packageName.split(".");for(var i=1;i<tags.length;i++){tags[i]=tags[i].replace(/_/g," ")}tags.push(stencilName.replace(/_/g," "));if(moreTags!=null){tags.push(moreTags)}return tags.slice(1,tags.length)};Sidebar.prototype.addStencilPalette=function(id,title,stencilFile,style,ignore,onInit,scale,tags,customFns){scale=scale!=null?scale:1;if(this.addStencilsToIndex){var fns=[];if(customFns!=null){for(var i=0;i<customFns.length;i++){fns.push(customFns[i])}}mxStencilRegistry.loadStencilSet(stencilFile,mxUtils.bind(this,function(packageName,stencilName,displayName,w,h){if(ignore==null||mxUtils.indexOf(ignore,stencilName)<0){var tmp=this.getTagsForStencil(packageName,stencilName);var tmpTags=tags!=null?tags[stencilName]:null;if(tmpTags!=null){tmp.push(tmpTags)}fns.push(this.createVertexTemplateEntry("shape="+packageName+stencilName.toLowerCase()+style,Math.round(w*scale),Math.round(h*scale),"",stencilName.replace(/_/g," "),null,null,this.filterTags(tmp.join(" "))))}}),true,true);this.addPaletteFunctions(id,title,false,fns)}else{this.addPalette(id,title,false,mxUtils.bind(this,function(content){if(style==null){style=""}if(onInit!=null){onInit.call(this,content)}if(customFns!=null){for(var i=0;i<customFns.length;i++){customFns[i](content)}}mxStencilRegistry.loadStencilSet(stencilFile,mxUtils.bind(this,function(packageName,stencilName,displayName,w,h){if(ignore==null||mxUtils.indexOf(ignore,stencilName)<0){content.appendChild(this.createVertexTemplate("shape="+packageName+stencilName.toLowerCase()+style,Math.round(w*scale),Math.round(h*scale),"",stencilName.replace(/_/g," "),true))}}),true)}))}};Sidebar.prototype.destroy=function(){if(this.graph!=null){if(this.graph.container!=null&&this.graph.container.parentNode!=null){this.graph.container.parentNode.removeChild(this.graph.container)}this.graph.destroy();this.graph=null}if(this.pointerUpHandler!=null){mxEvent.removeListener(document,mxClient.IS_POINTER?"pointerup":"mouseup",this.pointerUpHandler);this.pointerUpHandler=null}if(this.pointerDownHandler!=null){mxEvent.removeListener(document,mxClient.IS_POINTER?"pointerdown":"mousedown",this.pointerDownHandler);this.pointerDownHandler=null}if(this.pointerMoveHandler!=null){mxEvent.removeListener(document,mxClient.IS_POINTER?"pointermove":"mousemove",this.pointerMoveHandler);this.pointerMoveHandler=null}if(this.pointerOutHandler!=null){mxEvent.removeListener(document,mxClient.IS_POINTER?"pointerout":"mouseout",this.pointerOutHandler);this.pointerOutHandler=null}};Sidebar.prototype.triangleUp=HoverIcons.prototype.triangleUp;Sidebar.prototype.triangleRight=HoverIcons.prototype.triangleRight;Sidebar.prototype.triangleDown=HoverIcons.prototype.triangleDown;Sidebar.prototype.triangleLeft=HoverIcons.prototype.triangleLeft;Sidebar.prototype.refreshTarget=HoverIcons.prototype.refreshTarget;Sidebar.prototype.roundDrop=HoverIcons.prototype.roundDrop;module.exports=Sidebar},{"./Diagrams/ClassDiagram.js":2}],7:[function(require,module,exports){var EditorUi=require("./EditorUi");function Toolbar(editorUi,container){this.editorUi=editorUi;this.container=container;this.staticElements=[];this.init();this.gestureHandler=mxUtils.bind(this,function(evt){if(this.editorUi.currentMenu!=null&&mxEvent.getSource(evt)!=this.editorUi.currentMenu.div){this.hideMenu()}});mxEvent.addGestureListeners(document,this.gestureHandler)}Toolbar.prototype.dropdownImage=!mxClient.IS_SVG?IMAGE_PATH+"/dropdown.gif":"data:image/gif;base64,R0lGODlhDQANAIABAHt7e////yH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS4wLWMwNjAgNjEuMTM0Nzc3LCAyMDEwLzAyLzEyLTE3OjMyOjAwICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpCREM1NkJFMjE0NEMxMUU1ODk1Q0M5MjQ0MTA4QjNDMSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpCREM1NkJFMzE0NEMxMUU1ODk1Q0M5MjQ0MTA4QjNDMSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkQzOUMzMjZCMTQ0QjExRTU4OTVDQzkyNDQxMDhCM0MxIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkQzOUMzMjZDMTQ0QjExRTU4OTVDQzkyNDQxMDhCM0MxIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Af/+/fz7+vn49/b19PPy8fDv7u3s6+rp6Ofm5eTj4uHg397d3Nva2djX1tXU09LR0M/OzczLysnIx8bFxMPCwcC/vr28u7q5uLe2tbSzsrGwr66trKuqqainpqWko6KhoJ+enZybmpmYl5aVlJOSkZCPjo2Mi4qJiIeGhYSDgoGAf359fHt6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYWBfXl1cW1pZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBQD8+PTw7Ojk4NzY1NDMyMTAvLi0sKyopKCcmJSQjIiEgHx4dHBsaGRgXFhUUExIREA8ODQwLCgkIBwYFBAMCAQAAIfkEAQAAAQAsAAAAAA0ADQAAAhGMj6nL3QAjVHIu6azbvPtWAAA7";Toolbar.prototype.dropdownImageHtml='<img border="0" style="position:absolute;right:4px;top:'+(!EditorUi.compactUi?8:6)+'px;" src="'+Toolbar.prototype.dropdownImage+'" valign="middle"/>';Toolbar.prototype.selectedBackground="#d0d0d0";Toolbar.prototype.unselectedBackground="none";Toolbar.prototype.staticElements=null;Toolbar.prototype.init=function(){var sw=screen.width;sw-=screen.height>740?56:0;if(sw>=700){var formatMenu=this.addMenu("",mxResources.get("view")+" ("+mxResources.get("panTooltip")+")",true,"viewPanels",null,true);this.addDropDownArrow(formatMenu,"geSprite-formatpanel",38,50,-4,-3,36,-8);this.addSeparator()}var viewMenu=this.addMenu("",mxResources.get("zoom")+" (Alt+Mousewheel)",true,"viewZoom",null,true);viewMenu.showDisabled=true;viewMenu.style.whiteSpace="nowrap";viewMenu.style.position="relative";viewMenu.style.overflow="hidden";if(EditorUi.compactUi){viewMenu.style.width=mxClient.IS_QUIRKS?"58px":"50px"}else{viewMenu.style.width=mxClient.IS_QUIRKS?"62px":"36px"}if(sw>=420){this.addSeparator();var elts=this.addItems(["zoomIn","zoomOut"]);elts[0].setAttribute("title",mxResources.get("zoomIn")+" ("+this.editorUi.actions.get("zoomIn").shortcut+")");elts[1].setAttribute("title",mxResources.get("zoomOut")+" ("+this.editorUi.actions.get("zoomOut").shortcut+")")}this.updateZoom=mxUtils.bind(this,function(){viewMenu.innerHTML=Math.round(this.editorUi.editor.graph.view.scale*100)+"%"+this.dropdownImageHtml;if(EditorUi.compactUi){viewMenu.getElementsByTagName("img")[0].style.right="1px";viewMenu.getElementsByTagName("img")[0].style.top="5px"}});this.editorUi.editor.graph.view.addListener(mxEvent.EVENT_SCALE,this.updateZoom);this.editorUi.editor.addListener("resetGraphView",this.updateZoom);var elts=this.addItems(["-","undo","redo"]);elts[1].setAttribute("title",mxResources.get("undo")+" ("+this.editorUi.actions.get("undo").shortcut+")");elts[2].setAttribute("title",mxResources.get("redo")+" ("+this.editorUi.actions.get("redo").shortcut+")");if(sw>=470){var elts=this.addItems(["-","delete"]);elts[1].setAttribute("title",mxResources.get("delete")+" ("+this.editorUi.actions.get("delete").shortcut+")")}if(sw>=550){this.addItems(["-","toFront","toBack"])}if(sw>=640){this.addItems(["-","fillColor","strokeColor","shadow"])}if(sw>=320){this.addSeparator();this.edgeShapeMenu=this.addMenuFunction("",mxResources.get("connection"),false,mxUtils.bind(this,function(menu){this.editorUi.menus.edgeStyleChange(menu,"",[mxConstants.STYLE_SHAPE,"width"],[null,null],"geIcon geSprite geSprite-connection",null,true).setAttribute("title",mxResources.get("line"));this.editorUi.menus.edgeStyleChange(menu,"",[mxConstants.STYLE_SHAPE,"width"],["link",null],"geIcon geSprite geSprite-linkedge",null,true).setAttribute("title",mxResources.get("link"));this.editorUi.menus.edgeStyleChange(menu,"",[mxConstants.STYLE_SHAPE,"width"],["flexArrow",null],"geIcon geSprite geSprite-arrow",null,true).setAttribute("title",mxResources.get("arrow"));this.editorUi.menus.edgeStyleChange(menu,"",[mxConstants.STYLE_SHAPE,"width"],["arrow",null],"geIcon geSprite geSprite-simplearrow",null,true).setAttribute("title",mxResources.get("simpleArrow"))}));this.addDropDownArrow(this.edgeShapeMenu,"geSprite-connection",44,50,0,0,22,-4);this.edgeStyleMenu=this.addMenuFunction("geSprite-orthogonal",mxResources.get("waypoints"),false,mxUtils.bind(this,function(menu){this.editorUi.menus.edgeStyleChange(menu,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],[null,null,null],"geIcon geSprite geSprite-straight",null,true).setAttribute("title",mxResources.get("straight"));this.editorUi.menus.edgeStyleChange(menu,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["orthogonalEdgeStyle",null,null],"geIcon geSprite geSprite-orthogonal",null,true).setAttribute("title",mxResources.get("orthogonal"));this.editorUi.menus.edgeStyleChange(menu,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_ELBOW,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["elbowEdgeStyle",null,null,null],"geIcon geSprite geSprite-horizontalelbow",null,true).setAttribute("title",mxResources.get("simple"));this.editorUi.menus.edgeStyleChange(menu,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_ELBOW,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["elbowEdgeStyle","vertical",null,null],"geIcon geSprite geSprite-verticalelbow",null,true).setAttribute("title",mxResources.get("simple"));this.editorUi.menus.edgeStyleChange(menu,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_ELBOW,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["isometricEdgeStyle",null,null,null],"geIcon geSprite geSprite-horizontalisometric",null,true).setAttribute("title",mxResources.get("isometric"));this.editorUi.menus.edgeStyleChange(menu,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_ELBOW,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["isometricEdgeStyle","vertical",null,null],"geIcon geSprite geSprite-verticalisometric",null,true).setAttribute("title",mxResources.get("isometric"));this.editorUi.menus.edgeStyleChange(menu,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["orthogonalEdgeStyle","1",null],"geIcon geSprite geSprite-curved",null,true).setAttribute("title",mxResources.get("curved"));this.editorUi.menus.edgeStyleChange(menu,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["entityRelationEdgeStyle",null,null],"geIcon geSprite geSprite-entity",null,true).setAttribute("title",mxResources.get("entityRelation"))}));this.addDropDownArrow(this.edgeStyleMenu,"geSprite-orthogonal",44,50,0,0,22,-4)}this.addSeparator();var insertMenu=this.addMenu("",mxResources.get("insert")+" ("+mxResources.get("doubleClickTooltip")+")",true,"insert",null,true);this.addDropDownArrow(insertMenu,"geSprite-plus",38,48,-4,-3,36,-8)};Toolbar.prototype.addDropDownArrow=function(menu,sprite,width,atlasWidth,left,top,atlasDelta,atlasLeft){atlasDelta=atlasDelta!=null?atlasDelta:32;left=EditorUi.compactUi?left:atlasLeft;menu.style.whiteSpace="nowrap";menu.style.overflow="hidden";menu.style.position="relative";menu.innerHTML='<div class="geSprite '+sprite+'" style="margin-left:'+left+"px;margin-top:"+top+'px;"></div>'+this.dropdownImageHtml;menu.style.width=mxClient.IS_QUIRKS?atlasWidth+"px":atlasWidth-atlasDelta+"px";if(mxClient.IS_QUIRKS){menu.style.height=EditorUi.compactUi?"24px":"26px"}if(EditorUi.compactUi){menu.getElementsByTagName("img")[0].style.left="24px";menu.getElementsByTagName("img")[0].style.top="5px";menu.style.width=mxClient.IS_QUIRKS?width+"px":width-10+"px"}};Toolbar.prototype.setFontName=function(value){if(this.fontMenu!=null){this.fontMenu.innerHTML='<div style="width:60px;overflow:hidden;display:inline-block;">'+mxUtils.htmlEntities(value)+"</div>"+this.dropdownImageHtml}};Toolbar.prototype.setFontSize=function(value){if(this.sizeMenu!=null){this.sizeMenu.innerHTML='<div style="width:24px;overflow:hidden;display:inline-block;">'+value+"</div>"+this.dropdownImageHtml}};Toolbar.prototype.createTextToolbar=function(){var graph=this.editorUi.editor.graph;var styleElt=this.addMenu("",mxResources.get("style"),true,"formatBlock");styleElt.style.position="relative";styleElt.style.whiteSpace="nowrap";styleElt.style.overflow="hidden";styleElt.innerHTML=mxResources.get("style")+this.dropdownImageHtml;if(EditorUi.compactUi){styleElt.style.paddingRight="18px";styleElt.getElementsByTagName("img")[0].style.right="1px";styleElt.getElementsByTagName("img")[0].style.top="5px"}this.addSeparator();this.fontMenu=this.addMenu("",mxResources.get("fontFamily"),true,"fontFamily");this.fontMenu.style.position="relative";this.fontMenu.style.whiteSpace="nowrap";this.fontMenu.style.overflow="hidden";this.fontMenu.style.width=mxClient.IS_QUIRKS?"80px":"60px";this.setFontName(Menus.prototype.defaultFont);if(EditorUi.compactUi){this.fontMenu.style.paddingRight="18px";this.fontMenu.getElementsByTagName("img")[0].style.right="1px";this.fontMenu.getElementsByTagName("img")[0].style.top="5px"}this.addSeparator();this.sizeMenu=this.addMenu(Menus.prototype.defaultFontSize,mxResources.get("fontSize"),true,"fontSize");this.sizeMenu.style.position="relative";this.sizeMenu.style.whiteSpace="nowrap";this.sizeMenu.style.overflow="hidden";this.sizeMenu.style.width=mxClient.IS_QUIRKS?"44px":"24px";this.setFontSize(Menus.prototype.defaultFontSize);if(EditorUi.compactUi){this.sizeMenu.style.paddingRight="18px";this.sizeMenu.getElementsByTagName("img")[0].style.right="1px";this.sizeMenu.getElementsByTagName("img")[0].style.top="5px"}var elts=this.addItems(["-","undo","redo","-","bold","italic","underline"]);elts[1].setAttribute("title",mxResources.get("undo")+" ("+this.editorUi.actions.get("undo").shortcut+")");elts[2].setAttribute("title",mxResources.get("redo")+" ("+this.editorUi.actions.get("redo").shortcut+")");elts[4].setAttribute("title",mxResources.get("bold")+" ("+this.editorUi.actions.get("bold").shortcut+")");elts[5].setAttribute("title",mxResources.get("italic")+" ("+this.editorUi.actions.get("italic").shortcut+")");elts[6].setAttribute("title",mxResources.get("underline")+" ("+this.editorUi.actions.get("underline").shortcut+")");var alignMenu=this.addMenuFunction("",mxResources.get("align"),false,mxUtils.bind(this,function(menu){elt=menu.addItem("",null,mxUtils.bind(this,function(){document.execCommand("justifyleft",false,null)}),null,"geIcon geSprite geSprite-left");elt.setAttribute("title",mxResources.get("left"));elt=menu.addItem("",null,mxUtils.bind(this,function(){document.execCommand("justifycenter",false,null)}),null,"geIcon geSprite geSprite-center");elt.setAttribute("title",mxResources.get("center"));elt=menu.addItem("",null,mxUtils.bind(this,function(){document.execCommand("justifyright",false,null)}),null,"geIcon geSprite geSprite-right");elt.setAttribute("title",mxResources.get("right"));elt=menu.addItem("",null,mxUtils.bind(this,function(){document.execCommand("justifyfull",false,null)}),null,"geIcon geSprite geSprite-justifyfull");elt.setAttribute("title",mxResources.get("justifyfull"));elt=menu.addItem("",null,mxUtils.bind(this,function(){document.execCommand("insertorderedlist",false,null)}),null,"geIcon geSprite geSprite-orderedlist");elt.setAttribute("title",mxResources.get("numberedList"));elt=menu.addItem("",null,mxUtils.bind(this,function(){document.execCommand("insertunorderedlist",false,null)}),null,"geIcon geSprite geSprite-unorderedlist");elt.setAttribute("title",mxResources.get("bulletedList"));elt=menu.addItem("",null,mxUtils.bind(this,function(){document.execCommand("outdent",false,null)}),null,"geIcon geSprite geSprite-outdent");elt.setAttribute("title",mxResources.get("decreaseIndent"));elt=menu.addItem("",null,mxUtils.bind(this,function(){document.execCommand("indent",false,null)}),null,"geIcon geSprite geSprite-indent");elt.setAttribute("title",mxResources.get("increaseIndent"))}));alignMenu.style.position="relative";alignMenu.style.whiteSpace="nowrap";alignMenu.style.overflow="hidden";alignMenu.innerHTML='<div class="geSprite geSprite-left" style="margin-left:-2px;"></div>'+this.dropdownImageHtml;alignMenu.style.width=mxClient.IS_QUIRKS?"50px":"30px";if(EditorUi.compactUi){alignMenu.getElementsByTagName("img")[0].style.left="22px";alignMenu.getElementsByTagName("img")[0].style.top="5px"}var formatMenu=this.addMenuFunction("",mxResources.get("format"),false,mxUtils.bind(this,function(menu){elt=menu.addItem("",null,this.editorUi.actions.get("subscript").funct,null,"geIcon geSprite geSprite-subscript");elt.setAttribute("title",mxResources.get("subscript")+" (Ctrl+,)");elt=menu.addItem("",null,this.editorUi.actions.get("superscript").funct,null,"geIcon geSprite geSprite-superscript");elt.setAttribute("title",mxResources.get("superscript")+" (Ctrl+.)");elt=menu.addItem("",null,this.editorUi.actions.get("fontColor").funct,null,"geIcon geSprite geSprite-fontcolor");elt.setAttribute("title",mxResources.get("fontColor"));elt=menu.addItem("",null,this.editorUi.actions.get("backgroundColor").funct,null,"geIcon geSprite geSprite-fontbackground");elt.setAttribute("title",mxResources.get("backgroundColor"));elt=menu.addItem("",null,mxUtils.bind(this,function(){document.execCommand("removeformat",false,null)}),null,"geIcon geSprite geSprite-removeformat");elt.setAttribute("title",mxResources.get("removeFormat"))}));formatMenu.style.position="relative";formatMenu.style.whiteSpace="nowrap";formatMenu.style.overflow="hidden";formatMenu.innerHTML='<div class="geSprite geSprite-dots" style="margin-left:-2px;"></div>'+this.dropdownImageHtml;formatMenu.style.width=mxClient.IS_QUIRKS?"50px":"30px";if(EditorUi.compactUi){formatMenu.getElementsByTagName("img")[0].style.left="22px";formatMenu.getElementsByTagName("img")[0].style.top="5px"}this.addSeparator();this.addButton("geIcon geSprite geSprite-code",mxResources.get("html"),function(){graph.cellEditor.toggleViewMode();if(graph.cellEditor.textarea.innerHTML.length>0&&(graph.cellEditor.textarea.innerHTML!="&nbsp;"||!graph.cellEditor.clearOnChange)){window.setTimeout(function(){document.execCommand("selectAll",false,null)})}});this.addSeparator();var insertMenu=this.addMenuFunction("",mxResources.get("insert"),true,mxUtils.bind(this,function(menu){menu.addItem(mxResources.get("insertLink"),null,mxUtils.bind(this,function(){this.editorUi.actions.get("link").funct()}));menu.addItem(mxResources.get("insertImage"),null,mxUtils.bind(this,function(){this.editorUi.actions.get("image").funct()}));menu.addItem(mxResources.get("insertHorizontalRule"),null,mxUtils.bind(this,function(){document.execCommand("inserthorizontalrule",false,null)}))}));insertMenu.style.whiteSpace="nowrap";insertMenu.style.overflow="hidden";insertMenu.style.position="relative";insertMenu.innerHTML='<div class="geSprite geSprite-plus" style="margin-left:-4px;margin-top:-3px;"></div>'+this.dropdownImageHtml;insertMenu.style.width=mxClient.IS_QUIRKS?"36px":"16px";if(EditorUi.compactUi){insertMenu.getElementsByTagName("img")[0].style.left="24px";insertMenu.getElementsByTagName("img")[0].style.top="5px";insertMenu.style.width=mxClient.IS_QUIRKS?"50px":"30px"}this.addSeparator();var elt=this.addMenuFunction("geIcon geSprite geSprite-table",mxResources.get("table"),false,mxUtils.bind(this,function(menu){var elt=graph.getSelectedElement();var cell=graph.getParentByName(elt,"TD",graph.cellEditor.text2);var row=graph.getParentByName(elt,"TR",graph.cellEditor.text2);if(row==null){this.editorUi.menus.addInsertTableItem(menu)}else{var table=graph.getParentByName(row,"TABLE",graph.cellEditor.text2);elt=menu.addItem("",null,mxUtils.bind(this,function(){try{graph.selectNode(graph.insertColumn(table,cell!=null?cell.cellIndex:0))}catch(e){mxUtils.alert(mxResources.get("error")+": "+e.message)}}),null,"geIcon geSprite geSprite-insertcolumnbefore");elt.setAttribute("title",mxResources.get("insertColumnBefore"));elt=menu.addItem("",null,mxUtils.bind(this,function(){try{graph.selectNode(graph.insertColumn(table,cell!=null?cell.cellIndex+1:-1))}catch(e){mxUtils.alert(mxResources.get("error")+": "+e.message)}}),null,"geIcon geSprite geSprite-insertcolumnafter");elt.setAttribute("title",mxResources.get("insertColumnAfter"));elt=menu.addItem("Delete column",null,mxUtils.bind(this,function(){if(cell!=null){try{graph.deleteColumn(table,cell.cellIndex)}catch(e){mxUtils.alert(mxResources.get("error")+": "+e.message)}}}),null,"geIcon geSprite geSprite-deletecolumn");elt.setAttribute("title",mxResources.get("deleteColumn"));elt=menu.addItem("",null,mxUtils.bind(this,function(){try{graph.selectNode(graph.insertRow(table,row.sectionRowIndex))}catch(e){mxUtils.alert(mxResources.get("error")+": "+e.message)}}),null,"geIcon geSprite geSprite-insertrowbefore");elt.setAttribute("title",mxResources.get("insertRowBefore"));elt=menu.addItem("",null,mxUtils.bind(this,function(){try{graph.selectNode(graph.insertRow(table,row.sectionRowIndex+1))}catch(e){mxUtils.alert(mxResources.get("error")+": "+e.message)}}),null,"geIcon geSprite geSprite-insertrowafter");elt.setAttribute("title",mxResources.get("insertRowAfter"));elt=menu.addItem("",null,mxUtils.bind(this,function(){try{graph.deleteRow(table,row.sectionRowIndex)}catch(e){mxUtils.alert(mxResources.get("error")+": "+e.message)}}),null,"geIcon geSprite geSprite-deleterow");elt.setAttribute("title",mxResources.get("deleteRow"));elt=menu.addItem("",null,mxUtils.bind(this,function(){var color=table.style.borderColor.replace(/\brgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/g,function($0,$1,$2,$3){return"#"+("0"+Number($1).toString(16)).substr(-2)+("0"+Number($2).toString(16)).substr(-2)+("0"+Number($3).toString(16)).substr(-2)});this.editorUi.pickColor(color,function(newColor){if(newColor==null||newColor==mxConstants.NONE){table.removeAttribute("border");table.style.border="";table.style.borderCollapse=""}else{table.setAttribute("border","1");table.style.border="1px solid "+newColor;table.style.borderCollapse="collapse"}})}),null,"geIcon geSprite geSprite-strokecolor");elt.setAttribute("title",mxResources.get("borderColor"));elt=menu.addItem("",null,mxUtils.bind(this,function(){var color=table.style.backgroundColor.replace(/\brgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/g,function($0,$1,$2,$3){return"#"+("0"+Number($1).toString(16)).substr(-2)+("0"+Number($2).toString(16)).substr(-2)+("0"+Number($3).toString(16)).substr(-2)});this.editorUi.pickColor(color,function(newColor){if(newColor==null||newColor==mxConstants.NONE){table.style.backgroundColor=""}else{table.style.backgroundColor=newColor}})}),null,"geIcon geSprite geSprite-fillcolor");elt.setAttribute("title",mxResources.get("backgroundColor"));elt=menu.addItem("",null,mxUtils.bind(this,function(){var value=table.getAttribute("cellPadding")||0;var dlg=new FilenameDialog(this.editorUi,value,mxResources.get("apply"),mxUtils.bind(this,function(newValue){if(newValue!=null&&newValue.length>0){table.setAttribute("cellPadding",newValue)}else{table.removeAttribute("cellPadding")}}),mxResources.get("spacing"));this.editorUi.showDialog(dlg.container,300,80,true,true);dlg.init()}),null,"geIcon geSprite geSprite-fit");elt.setAttribute("title",mxResources.get("spacing"));elt=menu.addItem("",null,mxUtils.bind(this,function(){table.setAttribute("align","left")}),null,"geIcon geSprite geSprite-left");elt.setAttribute("title",mxResources.get("left"));elt=menu.addItem("",null,mxUtils.bind(this,function(){table.setAttribute("align","center")}),null,"geIcon geSprite geSprite-center");elt.setAttribute("title",mxResources.get("center"));elt=menu.addItem("",null,mxUtils.bind(this,function(){table.setAttribute("align","right")}),null,"geIcon geSprite geSprite-right");elt.setAttribute("title",mxResources.get("right"))}}));elt.style.position="relative";elt.style.whiteSpace="nowrap";elt.style.overflow="hidden";elt.innerHTML='<div class="geSprite geSprite-table" style="margin-left:-2px;"></div>'+this.dropdownImageHtml;elt.style.width=mxClient.IS_QUIRKS?"50px":"30px";if(EditorUi.compactUi){elt.getElementsByTagName("img")[0].style.left="22px";elt.getElementsByTagName("img")[0].style.top="5px"}};Toolbar.prototype.hideMenu=function(){this.editorUi.hideCurrentMenu()};Toolbar.prototype.addMenu=function(label,tooltip,showLabels,name,c,showAll){var menu=this.editorUi.menus.get(name);var elt=this.addMenuFunction(label,tooltip,showLabels,function(){menu.funct.apply(menu,arguments)},c,showAll);menu.addListener("stateChanged",function(){elt.setEnabled(menu.enabled)});return elt};Toolbar.prototype.addMenuFunction=function(label,tooltip,showLabels,funct,c,showAll){return this.addMenuFunctionInContainer(c!=null?c:this.container,label,tooltip,showLabels,funct,showAll)};Toolbar.prototype.addMenuFunctionInContainer=function(container,label,tooltip,showLabels,funct,showAll){var elt=showLabels?this.createLabel(label):this.createButton(label);this.initElement(elt,tooltip);this.addMenuHandler(elt,showLabels,funct,showAll);container.appendChild(elt);return elt};Toolbar.prototype.addSeparator=function(c){c=c!=null?c:this.container;var elt=document.createElement("div");elt.className="geSeparator";c.appendChild(elt);return elt};Toolbar.prototype.addItems=function(keys,c,ignoreDisabled){var items=[];for(var i=0;i<keys.length;i++){var key=keys[i];if(key=="-"){items.push(this.addSeparator(c))}else{items.push(this.addItem("geSprite-"+key.toLowerCase(),key,c,ignoreDisabled))}}return items};Toolbar.prototype.addItem=function(sprite,key,c,ignoreDisabled){var action=this.editorUi.actions.get(key);var elt=null;if(action!=null){var tooltip=action.label;if(action.shortcut!=null){tooltip+=" ("+action.shortcut+")"}elt=this.addButton(sprite,tooltip,action.funct,c);if(!ignoreDisabled){elt.setEnabled(action.enabled);action.addListener("stateChanged",function(){elt.setEnabled(action.enabled)})}}return elt};Toolbar.prototype.addButton=function(classname,tooltip,funct,c){var elt=this.createButton(classname);c=c!=null?c:this.container;this.initElement(elt,tooltip);this.addClickHandler(elt,funct);c.appendChild(elt);return elt};Toolbar.prototype.initElement=function(elt,tooltip){if(tooltip!=null){elt.setAttribute("title",tooltip)}this.addEnabledState(elt)};Toolbar.prototype.addEnabledState=function(elt){var classname=elt.className;elt.setEnabled=function(value){elt.enabled=value;if(value){elt.className=classname}else{elt.className=classname+" mxDisabled"}};elt.setEnabled(true)};Toolbar.prototype.addClickHandler=function(elt,funct){if(funct!=null){mxEvent.addListener(elt,"click",function(evt){if(elt.enabled){funct(evt)}mxEvent.consume(evt)});if(document.documentMode!=null&&document.documentMode>=9){mxEvent.addListener(elt,"mousedown",function(evt){evt.preventDefault()})}}};Toolbar.prototype.createButton=function(classname){var elt=document.createElement("a");elt.setAttribute("href","javascript:void(0);");elt.className="geButton";var inner=document.createElement("div");if(classname!=null){inner.className="geSprite "+classname}elt.appendChild(inner);return elt};Toolbar.prototype.createLabel=function(label,tooltip){var elt=document.createElement("a");elt.setAttribute("href","javascript:void(0);");elt.className="geLabel";mxUtils.write(elt,label);return elt};Toolbar.prototype.addMenuHandler=function(elt,showLabels,funct,showAll){if(funct!=null){var graph=this.editorUi.editor.graph;var menu=null;var show=true;mxEvent.addListener(elt,"click",mxUtils.bind(this,function(evt){if(show&&(elt.enabled==null||elt.enabled)){graph.popupMenuHandler.hideMenu();menu=new mxPopupMenu(funct);menu.div.className+=" geToolbarMenu";menu.showDisabled=showAll;menu.labels=showLabels;menu.autoExpand=true;var offset=mxUtils.getOffset(elt);menu.popup(offset.x,offset.y+elt.offsetHeight,null,evt);this.editorUi.setCurrentMenu(menu,elt);if(!showLabels&&menu.div.scrollHeight>menu.div.clientHeight){menu.div.style.width="40px"}menu.addListener(mxEvent.EVENT_HIDE,mxUtils.bind(this,function(){this.currentElt=null}))}show=true;mxEvent.consume(evt)}));mxEvent.addListener(elt,"mousedown",mxUtils.bind(this,function(evt){show=this.currentElt!=elt;if(document.documentMode!=null&&document.documentMode>=9){evt.preventDefault()}}))}};Toolbar.prototype.destroy=function(){if(this.gestureHandler!=null){mxEvent.removeGestureListeners(document,this.gestureHandler);this.gestureHandler=null}};module.exports=Toolbar},{"./EditorUi":3}],8:[function(require,module,exports){require("./EditorUi.js")},{"./EditorUi.js":3}]},{},[8]);
